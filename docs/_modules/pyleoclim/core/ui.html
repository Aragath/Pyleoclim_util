

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pyleoclim.core.ui &mdash; Pyleoclim 0.5.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> Pyleoclim
          

          
          </a>

          
            
            
              <div class="version">
                0.5.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Pyleoclim</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>pyleoclim.core.ui</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyleoclim.core.ui</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39; The application interface for the users</span>

<span class="sd">@author: fengzhu</span>

<span class="sd">Created on Jan 31, 2020</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">tsutils</span><span class="p">,</span> <span class="n">plotting</span><span class="p">,</span> <span class="n">mapping</span><span class="p">,</span> <span class="n">lipdutils</span><span class="p">,</span> <span class="n">tsmodel</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">wavelet</span> <span class="k">as</span> <span class="n">waveutils</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">spectral</span> <span class="k">as</span> <span class="n">specutils</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">correlation</span> <span class="k">as</span> <span class="n">corrutils</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">causality</span> <span class="k">as</span> <span class="n">causalutils</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">decomposition</span>

<span class="c1">#from textwrap import dedent</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1">#import pandas as pd</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>

<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">ScalarFormatter</span><span class="p">,</span> <span class="n">FormatStrFormatter</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="k">as</span> <span class="nn">pl</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">gridspec</span>
<span class="c1">#from matplotlib.colors import BoundaryNorm, Normalize</span>

<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">scipy.stats.mstats</span> <span class="kn">import</span> <span class="n">mquantiles</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">lipd</span> <span class="k">as</span> <span class="nn">lpd</span>


<span class="k">def</span> <span class="nf">dict2namedtuple</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="n">tupletype</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;tupletype&#39;</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">tupletype</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>

<div class="viewcode-block" id="Series"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series">[docs]</a><span class="k">class</span> <span class="nc">Series</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39; Create a pyleoSeries object</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    time : list or numpy.array</span>
<span class="sd">        Time values for the time series</span>

<span class="sd">    value : list of numpy.array</span>
<span class="sd">        ordinate values for the time series</span>

<span class="sd">    time_name : string</span>
<span class="sd">        Name of the time vector (e.g., &#39;Age&#39;).</span>
<span class="sd">        Default is None. This is used to label the time axis on plots</span>

<span class="sd">    time_unit : string</span>
<span class="sd">        Units for the time vector (e.g., &#39;yr B.P.&#39;).</span>
<span class="sd">        Default is None</span>

<span class="sd">    value_name : string</span>
<span class="sd">        Name of the value vector (e.g., &#39;temperature&#39;)</span>
<span class="sd">        Default is None</span>

<span class="sd">    value_unit : string</span>
<span class="sd">        Units for the value vector (e.g., &#39;deg C&#39;)</span>

<span class="sd">    label : string</span>
<span class="sd">        Name of the time series (e.g., &#39;Nino 3.4&#39;)</span>

<span class="sd">    clean_ts : bool</span>
<span class="sd">        remove the NaNs and let the time axis to be increasing if True</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    </span>
<span class="sd">    In this example, we import the Southern Oscillation Index (SOI) into a pandas dataframe and create a PyleoSeries object. </span>

<span class="sd">    .. ipython:: python</span>
<span class="sd">        :okwarning:</span>
<span class="sd">        </span>
<span class="sd">        import pyleoclim as pyleo</span>
<span class="sd">        import pandas as pd</span>
<span class="sd">        data=pd.read_csv(</span>
<span class="sd">            &#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/soi_data.csv&#39;,</span>
<span class="sd">            skiprows=0, header=1</span>
<span class="sd">        )</span>
<span class="sd">        time=data.iloc[:,1]</span>
<span class="sd">        value=data.iloc[:,2]</span>
<span class="sd">        ts=pyleo.Series(</span>
<span class="sd">            time=time, value=value,</span>
<span class="sd">            time_name=&#39;Year (CE)&#39;, value_name=&#39;SOI&#39;, label=&#39;SOI&#39;</span>
<span class="sd">        )</span>
<span class="sd">        ts</span>
<span class="sd">        ts.__dict__.keys()</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">time_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clean_ts</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">clean_ts</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">clean_ts</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_name</span> <span class="o">=</span> <span class="n">time_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span> <span class="o">=</span> <span class="n">time_unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_name</span> <span class="o">=</span> <span class="n">value_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_unit</span> <span class="o">=</span> <span class="n">value_unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>

    <span class="k">def</span> <span class="nf">make_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialization of labels</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        time_header : str</span>
<span class="sd">            Label for the time axis</span>
<span class="sd">        value_header : str</span>
<span class="sd">            Label for the value axis</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time_name_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_name_str</span> <span class="o">=</span> <span class="s1">&#39;time&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value_name_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value_name_str</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value_name_str</span><span class="si">}</span><span class="s1"> [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value_unit</span><span class="si">}</span><span class="s1">]&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value_name_str</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">time_name_str</span><span class="si">}</span><span class="s1"> [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span><span class="si">}</span><span class="s1">]&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">time_name_str</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">return</span> <span class="n">time_header</span><span class="p">,</span> <span class="n">value_header</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Prints out the series in a table format and length of the series</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            length of the timeseries.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">time_label</span><span class="p">,</span> <span class="n">value_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_labels</span><span class="p">()</span>

        <span class="n">table</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">time_label</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">value_label</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s1">&#39;keys&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Length: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">def</span> <span class="nf">stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Compute basic statistics for the time series</span>
<span class="sd">        </span>
<span class="sd">        Computes the mean, median, min, max, standard deviation, and interquartile range of a numpy array y, ignoring NaNs.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        res : dictionary</span>
<span class="sd">            Contains the mean, median, minimum value, maximum value, standard</span>
<span class="sd">            deviation, and interquartile range for the Series.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        Compute basic statistics for the SOI series</span>
<span class="sd">        </span>
<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>
<span class="sd">        </span>
<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            import pandas as pd</span>
<span class="sd">            data=pd.read_csv(&#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/soi_data.csv&#39;,skiprows=0,header=1)</span>
<span class="sd">            time=data.iloc[:,1]</span>
<span class="sd">            value=data.iloc[:,2]</span>
<span class="sd">            ts=pyleo.Series(time=time,value=value,time_name=&#39;Year C.E&#39;, value_name=&#39;SOI&#39;, label=&#39;SOI&#39;)</span>
<span class="sd">            ts.stats()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mean</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span> <span class="n">min_</span><span class="p">,</span> <span class="n">max_</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">IQR</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">simple_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">res</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span><span class="n">mean</span><span class="p">,</span>
             <span class="s1">&#39;median&#39;</span><span class="p">:</span><span class="n">median</span><span class="p">,</span>
             <span class="s1">&#39;min&#39;</span><span class="p">:</span><span class="n">min_</span><span class="p">,</span>
             <span class="s1">&#39;max&#39;</span><span class="p">:</span><span class="n">max_</span><span class="p">,</span>
             <span class="s1">&#39;std&#39;</span><span class="p">:</span><span class="n">std</span><span class="p">,</span>
             <span class="s1">&#39;IQR&#39;</span><span class="p">:</span> <span class="n">IQR</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
             <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">linestyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lgd_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Plot the timeseries</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        figsize : list</span>
<span class="sd">            a list of two integers indicating the figure size</span>

<span class="sd">        marker : str</span>
<span class="sd">            e.g., &#39;o&#39; for dots</span>
<span class="sd">            See [matplotlib.markers](https://matplotlib.org/3.1.3/api/markers_api.html) for details</span>

<span class="sd">        markersize : float</span>
<span class="sd">            the size of the marker</span>
<span class="sd">        </span>
<span class="sd">        color : str, list</span>
<span class="sd">            the color for the line plot</span>
<span class="sd">            e.g., &#39;r&#39; for red</span>
<span class="sd">            See [matplotlib colors] (https://matplotlib.org/3.2.1/tutorials/colors/colors.html) for details</span>

<span class="sd">        linestyle : str</span>
<span class="sd">            e.g., &#39;--&#39; for dashed line</span>
<span class="sd">            See [matplotlib.linestyles](https://matplotlib.org/3.1.0/gallery/lines_bars_and_markers/linestyles.html) for details</span>

<span class="sd">        linewidth : float</span>
<span class="sd">            the width of the line</span>

<span class="sd">        label : str</span>
<span class="sd">            the label for the line</span>

<span class="sd">        xlabel : str</span>
<span class="sd">            the label for the x-axis</span>

<span class="sd">        ylabel : str</span>
<span class="sd">            the label for the y-axis</span>

<span class="sd">        title : str</span>
<span class="sd">            the title for the figure</span>
<span class="sd">        </span>
<span class="sd">        zorder : int</span>
<span class="sd">            The default drawing order for all lines on the plot</span>

<span class="sd">        legend : {True, False}</span>
<span class="sd">            plot legend or not</span>

<span class="sd">        plot_kwargs : dict</span>
<span class="sd">            the dictionary of keyword arguments for ax.plot()</span>
<span class="sd">            See [matplotlib.pyplot.plot](https://matplotlib.org/3.1.3/api/_as_gen/matplotlib.pyplot.plot.html) for details</span>

<span class="sd">        lgd_kwargs : dict</span>
<span class="sd">            the dictionary of keyword arguments for ax.legend()</span>
<span class="sd">            See [matplotlib.pyplot.legend](https://matplotlib.org/3.1.3/api/_as_gen/matplotlib.pyplot.legend.html) for details</span>
<span class="sd">            </span>
<span class="sd">        alpha : float</span>
<span class="sd">            Transparency setting</span>

<span class="sd">        savefig_settings : dict</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">            - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">              with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">            - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;}</span>

<span class="sd">        ax : matplotlib.axis, optional</span>
<span class="sd">            the axis object from matplotlib</span>
<span class="sd">            See [matplotlib.axes](https://matplotlib.org/api/axes_api.html) for details.</span>
<span class="sd">        </span>
<span class="sd">        mute : {True,False}</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        fig : matplotlib.figure</span>
<span class="sd">            the figure object from matplotlib</span>
<span class="sd">            See [matplotlib.pyplot.figure](https://matplotlib.org/3.1.1/api/_as_gen/matplotlib.pyplot.figure.html) for details.</span>

<span class="sd">        ax : matplotlib.axis</span>
<span class="sd">            the axis object from matplotlib</span>
<span class="sd">            See [matplotlib.axes](https://matplotlib.org/api/axes_api.html) for details.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        When `ax` is passed, the return will be `ax` only; otherwise, both `fig` and `ax` will be returned.</span>
<span class="sd">        </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.plotting.savefig : saving figure in Pyleoclim</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        Plot the SOI record</span>
<span class="sd">        </span>
<span class="sd">            .. ipython:: python</span>
<span class="sd">                :okwarning:</span>
<span class="sd">                    </span>
<span class="sd">                import pyleoclim as pyleo</span>
<span class="sd">                import pandas as pd</span>
<span class="sd">                from matplotlib import pyplot as plt</span>
<span class="sd">                data=pd.read_csv(&#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/soi_data.csv&#39;,skiprows=0,header=1)</span>
<span class="sd">                time=data.iloc[:,1]</span>
<span class="sd">                value=data.iloc[:,2]</span>
<span class="sd">                ts=pyleo.Series(time=time,value=value,time_name=&#39;Year C.E&#39;, value_name=&#39;SOI&#39;, label=&#39;SOI&#39;)</span>
<span class="sd">                @savefig ts_plot.png</span>
<span class="sd">                fig,ax = ts.plot()</span>
<span class="sd">                plt.close(fig)</span>
<span class="sd">        </span>
<span class="sd">        Change the line color</span>
<span class="sd">        </span>
<span class="sd">            .. ipython:: python</span>
<span class="sd">                :okwarning:</span>
<span class="sd">            </span>
<span class="sd">                @savefig ts_plot2.png</span>
<span class="sd">                fig, ax = ts.plot(color=&#39;r&#39;)</span>
<span class="sd">                plt.close(fig)</span>
<span class="sd">        </span>
<span class="sd">        Save the figure. Two options available:</span>
<span class="sd">            * Within the plotting command</span>
<span class="sd">            * After the figure has been generated</span>
<span class="sd">        </span>
<span class="sd">            .. ipython:: python</span>
<span class="sd">                :okwarning:</span>
<span class="sd">            </span>
<span class="sd">                #@savefig ts_plot3.png </span>
<span class="sd">                fig,ax = ts.plot(color=&#39;k&#39;,savefig_settings={&#39;path&#39;:&#39;ts_plot3.png&#39;})</span>
<span class="sd">                pyleo.savefig(fig,path=&#39;ts_plot3.png&#39;)</span>
<span class="sd">                plt.close(fig)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># generate default axis labels</span>
        <span class="n">time_label</span><span class="p">,</span> <span class="n">value_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_labels</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">time_label</span>

        <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">value_label</span>

        <span class="n">plot_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">plot_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>

        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">label</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">marker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="n">marker</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">markersize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;markersize&#39;</span><span class="p">:</span> <span class="n">markersize</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">linestyle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="n">linestyle</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">linewidth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="n">linewidth</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">alpha</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">zorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;zorder&#39;</span><span class="p">:</span> <span class="n">zorder</span><span class="p">})</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_xy</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span>
            <span class="n">plot_kwargs</span><span class="o">=</span><span class="n">plot_kwargs</span><span class="p">,</span> <span class="n">lgd_kwargs</span><span class="o">=</span><span class="n">lgd_kwargs</span><span class="p">,</span>
            <span class="n">mute</span><span class="o">=</span><span class="n">mute</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">ssa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nMC</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Singular Spectrum Analysis</span>
<span class="sd">        </span>
<span class="sd">        Nonparametric, orthogonal decomposition of timeseries into constituent oscillations.</span>
<span class="sd">        This implementation  uses the method of [1], with applications presented in [2].</span>
<span class="sd">        Optionally (MC&gt;0), the significance of eigenvalues is assessed by Monte-Carlo simulations of an AR(1) model fit to X, using [3].</span>
<span class="sd">        The method expects regular spacing, but is tolerant to missing values, up to a fraction 0&lt;f&lt;1 (see [4]).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        M : int, optional</span>
<span class="sd">            window size. The default is None (10% of the length of the series).</span>
<span class="sd">        MC : int, optional</span>
<span class="sd">            Number of iteration in the Monte-Carlo process. The default is 0.</span>
<span class="sd">        f : float, optional</span>
<span class="sd">            maximum allowable fraction of missing values. The default is 0.5.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        res : dict</span>
<span class="sd">            Containing:</span>

<span class="sd">            - eig_val : (M, 1) array of eigenvalue spectrum of length r, the number of SSA modes. As in Principal Component Analysis, eigenvaluesare closely related to the fraction of variance accounted for (&quot;explained&quot;, a common but not-so-helpful term) by each mode.</span>
<span class="sd">            </span>
<span class="sd">            - eig_vec : is a matrix of the temporal eigenvectors (T-EOFs), i.e. the temporal patterns that explain most of the variations in the original series.</span>
<span class="sd">                </span>
<span class="sd">            - PC : (N - M + 1, M) array of principal components, i.e. the loadings that, convolved with the T-EOFs, produce the reconstructed components, or RCs</span>

<span class="sd">            - RC : (N,  M) array of reconstructed components, One can think of each RC as the contribution of each mode to the timeseries, weighted by their eigenvalue (loosely speaking, their &quot;amplitude&quot;). Summing over all columns of RC recovers the original series. (synthesis, the reciprocal operation of analysis).</span>

<span class="sd">            - eig_val_q : (M, 2) array containing the 5% and 95% quantiles of the Monte-Carlo eigenvalue spectrum [ if MC &gt;0 ]</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        SSA with SOI</span>
<span class="sd">        </span>
<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>
<span class="sd">            </span>
<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            import pandas as pd</span>
<span class="sd">            from matplotlib import pyplot as plt</span>
<span class="sd">            data=pd.read_csv(&#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/soi_data.csv&#39;,skiprows=0,header=1)</span>
<span class="sd">            time=data.iloc[:,1]</span>
<span class="sd">            value=data.iloc[:,2]</span>
<span class="sd">            ts=pyleo.Series(time=time,value=value,time_name=&#39;Year C.E&#39;, value_name=&#39;SOI&#39;, label=&#39;SOI&#39;)</span>
<span class="sd">            #plot</span>
<span class="sd">            @savefig ts_plot.png</span>
<span class="sd">            fig,ax = ts.plot()</span>
<span class="sd">            plt.close(fig)</span>
<span class="sd">            #SSA</span>
<span class="sd">            nino_ssa = ts.ssa(M=60)</span>
<span class="sd">        </span>
<span class="sd">        Let us now see how to make use of all these arrays. The first step is too inspect the eigenvalue spectrum (&quot;scree plot&quot;) to identify remarkable modes. Let us restrict ourselves to the first 40, so we can see something:</span>
<span class="sd">            </span>
<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>
<span class="sd">        </span>
<span class="sd">            import matplotlib.pyplot as plt</span>
<span class="sd">            import matplotlib.gridspec as gridspec</span>
<span class="sd">            import numpy as np</span>
<span class="sd">            </span>
<span class="sd">            d  = nino_ssa[&#39;eig_val&#39;] # extract eigenvalue vector</span>
<span class="sd">            M  = len(d)  # infer window size</span>
<span class="sd">            de = d*np.sqrt(2/(M-1))</span>
<span class="sd">            var_pct = d**2/np.sum(d**2)*100  # extract the fraction of variance attributable to each mode</span>

<span class="sd">            # plot eigenvalues</span>
<span class="sd">            r = 20</span>
<span class="sd">            rk = np.arange(0,r)+1</span>
<span class="sd">            fig,ax = plt.subplots()</span>
<span class="sd">            ax.errorbar(rk,d[:r],yerr=de[:r],label=&#39;SSA eigenvalues w/ 95% CI&#39;)</span>
<span class="sd">            ax.set_title(&#39;Scree plot of SSA eigenvalues&#39;)</span>
<span class="sd">            ax.set_xlabel(&#39;Rank $i$&#39;); plt.ylabel(r&#39;$\lambda_i$&#39;)</span>
<span class="sd">            ax.legend(loc=&#39;upper right&#39;)   </span>
<span class="sd">            @savefig scree_plot.png</span>
<span class="sd">            pyleo.showfig(fig)</span>
<span class="sd">            plt.close(fig)</span>
<span class="sd">        </span>
<span class="sd">        This highlights a few common phenomena with SSA:</span>
<span class="sd">            * the eigenvalues are in descending order</span>
<span class="sd">            * their uncertainties are proportional to the eigenvalues themselves</span>
<span class="sd">            * the eigenvalues tend to come in pairs : (1,2) (3,4), are all clustered within uncertainties . (5,6) looks like another doublet </span>
<span class="sd">            * around i=15, the eigenvalues appear to reach a floor, and all subsequent eigenvalues explain a very small amount of variance.</span>
<span class="sd">        </span>
<span class="sd">        So, summing the variance of all modes higher than 19, we get:</span>
<span class="sd">            </span>
<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>
<span class="sd">            </span>
<span class="sd">            print(var_pct[15:].sum()*100)</span>
<span class="sd">        </span>
<span class="sd">        That is, over 95% of the variance is in the first 15 modes. That is a typical result for a &quot;warm-colored&quot; timeseries, which is most geophysical timeseries; a few modes do the vast majority of the work. That means we can focus our attention on these modes and capture most of the interesting behavior. To see this, let&#39;s use the reconstructed components (RCs), and sum the RC matrix over the first 15 columns:</span>
<span class="sd">        </span>
<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>
<span class="sd">        </span>
<span class="sd">            RCk = nino_ssa[&#39;RC&#39;][:,:14].sum(axis=1)</span>
<span class="sd">            fig, ax = ts.plot(title=&#39;ONI&#39;,mute=True) # we mute the first call to only get the plot with 2 lines</span>
<span class="sd">            ax.plot(time,RCk,label=&#39;SSA reconstruction, 14 modes&#39;,color=&#39;orange&#39;)</span>
<span class="sd">            ax.legend()</span>
<span class="sd">            @savefig ssa_recon.png</span>
<span class="sd">            pyleo.showfig(fig) </span>
<span class="sd">            plt.close(fig)</span>
<span class="sd">        </span>
<span class="sd">        Indeed, these first few modes capture the vast majority of the low-frequency behavior, including all the El Niño/La Niña events. What is left (the blue wiggles not captured in the orange curve) are high-frequency oscillations that might be considered &quot;noise&quot; from the standpoint of ENSO dynamics. This illustrates how SSA might be used for filtering a timeseries. One must be careful however:</span>
<span class="sd">            * there was not much rhyme or reason for picking 15 modes. Why not 5, or 39? All we have seen so far is that they gather &gt;95% of the variance, which is by no means a magic number.</span>
<span class="sd">            * there is no guarantee that the first few modes will filter out high-frequency behavior, or at what frequency cutoff they will do so. If you need to cut out specific frequencies, you are better off doing it with a classical filter, like the butterworth filter implemented in Pyleoclim. However, in many instances the choice of a cutoff frequency is itself rather arbitrary. In such cases, SSA provides a principled alternative for generating a version of a timeseries that preserves features and excludes others (i.e, a filter).</span>
<span class="sd">            * as with all orthgonal decompositions, summing over all RCs will recover the original signal within numerical precision.</span>
<span class="sd">        </span>
<span class="sd">        Monte-Carlo SSA</span>
<span class="sd">        </span>
<span class="sd">        Selecting meaningful modes in eigenproblems (e.g. EOF analysis) is more art than science. However, one technique stands out: Monte Carlo SSA, introduced by Allen &amp; Smith, (1996) to identiy SSA modes that rise above what one would expect from &quot;red noise&quot;, specifically an AR(1) process_process). To run it, simply provide the parameter MC, ideally with a number of iterations sufficient to get decent statistics. Here&#39;s let&#39;s use MC = 1000. The result will be stored in the eig_val_q array, which has the same length as eig_val, and its two columns contain the 5% and 95% quantiles of the ensemble of MC-SSA eigenvalues.</span>
<span class="sd">        </span>
<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>
<span class="sd">        </span>
<span class="sd">            nino_mcssa = ts.ssa(M = 60, nMC=1000)</span>
<span class="sd">        </span>
<span class="sd">        Now let&#39;s look at the result:</span>
<span class="sd">            </span>
<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>
<span class="sd">        </span>
<span class="sd">            d  = nino_mcssa[&#39;eig_val&#39;] # extract eigenvalue vector</span>
<span class="sd">            de = d*np.sqrt(2/(M-1))</span>
<span class="sd">            du = nino_mcssa[&#39;eig_val_q&#39;][:,0]  # extract upper quantile of MC-SSA eigenvalues</span>
<span class="sd">            dl = nino_mcssa[&#39;eig_val_q&#39;][:,1]  # extract lower quantile of MC-SSA eigenvalues</span>

<span class="sd">            # plot eigenvalues</span>
<span class="sd">            rk = np.arange(0,20)+1</span>
<span class="sd">            fig=plt.figure()</span>
<span class="sd">            plt.fill_between(rk,dl[:20],du[:20],color=&#39;silver&#39;,alpha=0.5,label=&#39;MC-SSA 95% CI&#39;)</span>
<span class="sd">            plt.errorbar(rk,d[:20],yerr=de[:20],label=&#39;SSA eigenvalues w/ 95% CI&#39;)</span>
<span class="sd">            plt.title(&#39;Scree plot of SSA eigenvalues, w/ MC-SSA bounds&#39;)</span>
<span class="sd">            plt.xlabel(&#39;Rank $i$&#39;); plt.ylabel(r&#39;$\lambda_i$&#39;)</span>
<span class="sd">            plt.legend(loc=&#39;upper right&#39;)</span>
<span class="sd">            @savefig scree_nmc.png</span>
<span class="sd">            pyleo.showfig(fig)</span>
<span class="sd">            plt.close(fig)</span>
<span class="sd">    </span>
<span class="sd">        This suggests that modes 1-5 fall above the red noise benchmark.</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">decomposition</span><span class="o">.</span><span class="n">ssa</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="n">M</span><span class="p">,</span> <span class="n">nMC</span><span class="o">=</span><span class="n">nMC</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">distplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;KDE&#39;</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Plot the distribution of the timeseries values</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        figsize : list</span>
<span class="sd">            a list of two integers indicating the figure size</span>

<span class="sd">        title : str</span>
<span class="sd">            the title for the figure</span>

<span class="sd">        savefig_settings : dict</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">              - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">                with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">              - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;}</span>
<span class="sd">        </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.plotting.savefig : saving figure in Pyleoclim</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        Distribution of the SOI record</span>
<span class="sd">        </span>
<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>
<span class="sd">            </span>
<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            import pandas as pd</span>
<span class="sd">            from matplotlib import pyplot as plt</span>
<span class="sd">            data=pd.read_csv(&#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/soi_data.csv&#39;,skiprows=0,header=1)</span>
<span class="sd">            time=data.iloc[:,1]</span>
<span class="sd">            value=data.iloc[:,2]</span>
<span class="sd">            ts=pyleo.Series(time=time,value=value,time_name=&#39;Year C.E&#39;, value_name=&#39;SOI&#39;, label=&#39;SOI&#39;)</span>
<span class="sd">            @savefig ts_plot.png</span>
<span class="sd">            fig,ax = ts.plot()</span>
<span class="sd">            @savefig ts_dist.png</span>
<span class="sd">            fig,ax = ts.distplot()</span>
<span class="sd">            plt.close(fig)</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">savefig_settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">savefig_settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">savefig_settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>

        <span class="n">time_label</span><span class="p">,</span> <span class="n">value_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_labels</span><span class="p">()</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">value_label</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;fig&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">savefig_settings</span><span class="p">:</span>
                <span class="n">plotting</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mute</span><span class="p">:</span>
                    <span class="n">plotting</span><span class="o">.</span><span class="n">showfig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">summary_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scalogram</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">time_lim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value_lim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">period_lim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">psd_lim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_signif_test</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                    <span class="n">time_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">period_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">psd_label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Generate a plot of the timeseries and its frequency content through spectral and wavelet analyses. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        psd : PSD</span>
<span class="sd">            the PSD object of a Series. If None, will be calculated. This process can be slow as it will be using the WWZ method.</span>

<span class="sd">        scalogram : Scalogram</span>
<span class="sd">            the Scalogram object of a Series. If None, will be calculated. This process can be slow as it will be using the WWZ method.</span>

<span class="sd">        figsize : list</span>
<span class="sd">            a list of two integers indicating the figure size</span>

<span class="sd">        title : str</span>
<span class="sd">            the title for the figure</span>

<span class="sd">        time_lim : list or tuple</span>
<span class="sd">            the limitation of the time axis</span>

<span class="sd">        value_lim : list or tuple</span>
<span class="sd">            the limitation of the value axis of the timeseries</span>

<span class="sd">        period_lim : list or tuple</span>
<span class="sd">            the limitation of the period axis</span>

<span class="sd">        psd_lim : list or tuple</span>
<span class="sd">            the limitation of the psd axis</span>
<span class="sd">        </span>
<span class="sd">        n_signif_test=100 : int</span>
<span class="sd">            Number of Monte-Carlo simulations to perform for significance testing. Used when psd=None or scalogram=None</span>

<span class="sd">        time_label : str</span>
<span class="sd">            the label for the time axis</span>

<span class="sd">        value_label : str</span>
<span class="sd">            the label for the value axis of the timeseries</span>

<span class="sd">        period_label : str</span>
<span class="sd">            the label for the period axis</span>

<span class="sd">        psd_label : str</span>
<span class="sd">            the label for the amplitude axis of PDS</span>

<span class="sd">        savefig_settings : dict</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">            - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">              with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">            - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;}</span>
<span class="sd">        </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.core.ui.Series.spectral : Spectral analysis for a timeseries</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.core.ui.Series.wavelet : Wavelet analysis for a timeseries</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.plotting.savefig : saving figure in Pyleoclim </span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.core.ui.PSD : PSD object</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.core.ui.MultiplePSD : Multiple PSD object</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        Create a summary plot for the SOI dataset. Note: because the wwz method can be slow, only 10 AR1 models are generated in this example. For normal applications, we recommend at least 200. </span>
<span class="sd">        </span>
<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>
<span class="sd">            </span>
<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            import pandas as pd</span>
<span class="sd">            from matplotlib import pyplot as plt</span>
<span class="sd">            data=pd.read_csv(&#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/soi_data.csv&#39;,skiprows=0,header=1)</span>
<span class="sd">            time=data.iloc[:,1]</span>
<span class="sd">            value=data.iloc[:,2]</span>
<span class="sd">            ts=pyleo.Series(time=time,value=value,time_name=&#39;Year C.E&#39;, value_name=&#39;SOI&#39;, label=&#39;SOI&#39;)</span>
<span class="sd">            #Perform spectral analysis</span>
<span class="sd">            psd=ts.spectral()</span>
<span class="sd">            # Significance testing</span>
<span class="sd">            psd_signif=psd.signif_test(number=10)</span>
<span class="sd">            # Perform wavelet analysis</span>
<span class="sd">            scal=ts.wavelet()</span>
<span class="sd">            # Significance testing</span>
<span class="sd">            scal_signif = scal.signif_test(number=10)</span>
<span class="sd">            @savefig ts_summary_plot.png</span>
<span class="sd">            fig, ax = ts.summary_plot(</span>
<span class="sd">                        scalogram=scal_signif, psd=psd_signif,</span>
<span class="sd">                        psd_lim=[1e-2, 1e2],</span>
<span class="sd">                        period_lim=[0.2, 50],</span>
<span class="sd">                        value_label=&#39;SOI [K]&#39;,</span>
<span class="sd">                        period_label=&#39;Period [yrs]&#39;,</span>
<span class="sd">                        time_label=&#39;Year (CE)&#39;,</span>
<span class="sd">                        psd_label=&#39;PSD&#39;,</span>
<span class="sd">                        title=&#39;Summary of SOI timeseries&#39;</span>
<span class="sd">                        )</span>
<span class="sd">            plt.close(fig)</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">savefig_settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">savefig_settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">savefig_settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">gs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">time_lim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">time_lim</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value_lim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">value_lim</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;scal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">scalogram</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scalogram</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelet</span><span class="p">()</span><span class="o">.</span><span class="n">signif_test</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">n_signif_test</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;scal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scalogram</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;scal&#39;</span><span class="p">],</span> <span class="n">cbar_style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="s1">&#39;pad&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">})</span>

        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">:],</span> <span class="n">sharey</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;scal&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">psd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">psd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectral</span><span class="p">()</span><span class="o">.</span><span class="n">signif_test</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">n_signif_test</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">psd</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">],</span> <span class="n">transpose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">period_lim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">period_lim</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">psd_lim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">psd_lim</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">value_label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">value_label</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">time_label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;scal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">time_label</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">period_label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;scal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">period_label</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">psd_label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">psd_label</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">savefig_settings</span><span class="p">:</span>
            <span class="n">plotting</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Make a copy of the Series object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Series</span>
<span class="sd">            A copy of the Series object</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Clean up the timeseries by removing NaNs and sort with increasing time points</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Series</span>
<span class="sd">            Series object with removed NaNs and sorting</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">v_mod</span><span class="p">,</span> <span class="n">t_mod</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">clean_ts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">t_mod</span>
        <span class="n">new</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">v_mod</span>
        <span class="k">return</span> <span class="n">new</span>

    <span class="k">def</span> <span class="nf">gaussianize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Gaussianizes the timeseries</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : pyleoclim.Series</span>
<span class="sd">            The Gaussianized series object</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">v_mod</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">gaussianize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">v_mod</span>
        <span class="k">return</span> <span class="n">new</span>

    <span class="k">def</span> <span class="nf">standardize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Standardizes the time series</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : pyleoclim.Series</span>
<span class="sd">            The standardized series object</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">v_mod</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">standardize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">new</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">v_mod</span>
        <span class="k">return</span> <span class="n">new</span>

    <span class="k">def</span> <span class="nf">segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gap detection</span>

<span class="sd">        This function segments a timeseries into n number of parts following a gap</span>
<span class="sd">            detection algorithm. The rule of gap detection is very simple:</span>
<span class="sd">            we define the intervals between time points as dts, then if dts[i] is larger than factor * dts[i-1],</span>
<span class="sd">            we think that the change of dts (or the gradient) is too large, and we regard it as a breaking point</span>
<span class="sd">            and divide the time series into two segments here</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        ts : pyleoclim Series</span>

<span class="sd">        factor : float</span>
<span class="sd">            The factor that adjusts the threshold for gap detection</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        res : pyleoclim MultipleSeries Object or pyleoclim Series Object</span>
<span class="sd">            If gaps were detected, returns the segments in a MultipleSeries object,</span>
<span class="sd">            else, returns the original timeseries.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">seg_y</span><span class="p">,</span> <span class="n">seg_t</span><span class="p">,</span> <span class="n">n_segs</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">ts2segments</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="n">factor</span><span class="o">=</span><span class="n">factor</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seg_y</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">s_list</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">seg_y</span><span class="p">):</span>
                <span class="n">s_tmp</span><span class="o">=</span><span class="n">Series</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">seg_t</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="n">value</span><span class="o">=</span><span class="n">s</span><span class="p">,</span><span class="n">time_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_name</span><span class="p">,</span>
                             <span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value_name</span><span class="p">,</span>
                             <span class="n">value_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value_unit</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
                <span class="n">s_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_tmp</span><span class="p">)</span>
            <span class="n">res</span><span class="o">=</span><span class="n">MultipleSeries</span><span class="p">(</span><span class="n">series_list</span><span class="o">=</span><span class="n">s_list</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">seg_y</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">res</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No timeseries detected&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timespan</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Slicing the timeseries with a timespan (tuple or list)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        timespan : tuple or list</span>
<span class="sd">            The list of time points for slicing, whose length must be even.</span>
<span class="sd">            When there are n time points, the output Series includes n/2 segments.</span>
<span class="sd">            For example, if timespan = [a, b], then the sliced output includes one segment [a, b];</span>
<span class="sd">            if timespan = [a, b, c, d], then the sliced output includes segment [a, b] and segment [c, d].</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        new : Series</span>
<span class="sd">            The sliced Series object.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">n_elements</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">timespan</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n_elements</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The number of elements in timespan must be even!&#39;</span><span class="p">)</span>

        <span class="n">n_segments</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_elements</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">))]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_segments</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">|=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;=</span> <span class="n">timespan</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;=</span> <span class="n">timespan</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">new</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">new</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">new</span>

    <span class="k">def</span> <span class="nf">detrend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;emd&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Detrend Series object        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        method : str, optional</span>
<span class="sd">            The method for detrending. The default is &#39;emd&#39;.</span>
<span class="sd">            Options include:</span>
<span class="sd">                * linear: the result of a linear least-squares fit to y is subtracted from y.</span>
<span class="sd">                * constant: only the mean of data is subtrated.</span>
<span class="sd">                * &quot;savitzky-golay&quot;, y is filtered using the Savitzky-Golay filters and the resulting filtered series is subtracted from y.</span>
<span class="sd">                * &quot;emd&quot; (default): Empirical mode decomposition. The last mode is assumed to be the trend and removed from the series</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Relevant arguments for each of the methods.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : pyleoclim.Series</span>
<span class="sd">            Detrended Series object</span>
<span class="sd">        </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pyleoclim.utils.tsutils.detrend : detrending wrapper functions</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        We will generate a random signal and use the different detrending functions</span>
<span class="sd">        </span>
<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>
<span class="sd">            </span>
<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            import numpy as np</span>
<span class="sd">            from matplotlib import pyplot as plt</span>
<span class="sd">            </span>
<span class="sd">            # Generate a mixed signal with known frequencies</span>
<span class="sd">            freqs=[1/20,1/80]</span>
<span class="sd">            time=np.arange(2001)</span>
<span class="sd">            signals=[]</span>
<span class="sd">            for freq in freqs:</span>
<span class="sd">                signals.append(np.cos(2*np.pi*freq*time))</span>
<span class="sd">            signal=sum(signals)</span>
<span class="sd">            </span>
<span class="sd">            # Add a non-linear trend</span>
<span class="sd">            slope = 1e-5</span>
<span class="sd">            intercept = -1</span>
<span class="sd">            nonlinear_trend = slope*time**2 + intercept</span>
<span class="sd">            signal_trend = signal + nonlinear_trend</span>

<span class="sd">            #Add white noise</span>
<span class="sd">            sig_var = np.var(signal)</span>
<span class="sd">            noise_var = sig_var / 2 #signal is twice the size of noise</span>
<span class="sd">            white_noise = np.random.normal(0, np.sqrt(noise_var), size=np.size(signal))</span>
<span class="sd">            signal_noise = signal_trend + white_noise</span>
<span class="sd">            </span>
<span class="sd">            #Create a series object</span>
<span class="sd">            ts=pyleo.Series(time=time,value=signal_noise)</span>
<span class="sd">            @savefig random_series.png</span>
<span class="sd">            fig,ax = ts.plot(title=&#39;Timeseries with nonlinear trend&#39;)</span>
<span class="sd">            plt.close(fig)</span>
<span class="sd">            </span>
<span class="sd">            #Standardize</span>
<span class="sd">            ts_std=ts.standardize()</span>
<span class="sd">            </span>
<span class="sd">            #Detrend using EMD </span>
<span class="sd">            ts_emd = ts_std.detrend()</span>
<span class="sd">            @savefig ts_emd.png</span>
<span class="sd">            fig,ax=ts_emd.plot(title=&#39;Detrended with EMD method&#39;)</span>
<span class="sd">            plt.close(fig)</span>
<span class="sd">            </span>
<span class="sd">            #Detrend using Savitzky-Golay filter</span>
<span class="sd">            ts_sg = ts_std.detrend(method=&#39;savitzky-golay&#39;)</span>
<span class="sd">            @savefig ts_sg.png</span>
<span class="sd">            fig,ax=ts_sg.plot(title=&#39;Detrended with Savitzky-Golay filter&#39;)</span>
<span class="sd">            plt.close(fig)</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">v_mod</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">detrend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">v_mod</span>
        <span class="k">return</span> <span class="n">new</span>

    <span class="k">def</span> <span class="nf">spectral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;wwz&#39;</span><span class="p">,</span> <span class="n">freq_method</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">freq_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Perform spectral analysis on the timeseries</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        </span>
<span class="sd">        method : str</span>
<span class="sd">            {&#39;wwz&#39;, &#39;mtm&#39;, &#39;lomb_scargle&#39;, &#39;welch&#39;, &#39;periodogram&#39;}</span>

<span class="sd">        freq_method : str</span>
<span class="sd">            {&#39;log&#39;,&#39;scale&#39;, &#39;nfft&#39;, &#39;lomb_scargle&#39;, &#39;welch&#39;}</span>
<span class="sd">        </span>
<span class="sd">        freq_kwargs : dict</span>
<span class="sd">            Arguments for frequency vector</span>
<span class="sd">        </span>
<span class="sd">        settings : dict</span>
<span class="sd">            Arguments for the specific spectral method</span>
<span class="sd">        </span>
<span class="sd">        label : str</span>
<span class="sd">            Label for the PSD object</span>
<span class="sd">        </span>
<span class="sd">        verbose : {True, False}</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        </span>
<span class="sd">        psd : pyleoclim.Psd</span>
<span class="sd">            A PSD object</span>
<span class="sd">            </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pyleoclim.utils.spectral.mtm : Spectral analysis using the Multitaper approach</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.spectral.lomb_scargle : Spectral analysis using the Lomb-Scargle method</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.spectral.welch: Spectral analysis using the Welch segement approach</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.spectral.periodogram: Spectral anaysis using the basic Fourier transform</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.spectral.wwz_psd : Spectral analysis using the Wavelet Weighted Z transform</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.wavelet.make_freq : Functions to create the frequency vector</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.tsutils.detrend : Detrending function</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.core.ui.PSD : PSD object</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.core.ui.MultiplePSD : Multiple PSD object</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        Calculate the spectrum of SOI using the various methods and compute significance</span>
<span class="sd">        </span>
<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>
<span class="sd">        </span>
<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            import pandas as pd</span>
<span class="sd">            from matplotlib import pyplot as plt</span>
<span class="sd">            data=pd.read_csv(&#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/soi_data.csv&#39;,skiprows=0,header=1)</span>
<span class="sd">            time=data.iloc[:,1]</span>
<span class="sd">            value=data.iloc[:,2]</span>
<span class="sd">            ts=pyleo.Series(time=time,value=value,time_name=&#39;Year C.E&#39;, value_name=&#39;SOI&#39;, label=&#39;SOI&#39;)</span>
<span class="sd">            # Standardize the time series</span>
<span class="sd">            ts_std=ts.standardize()</span>
<span class="sd">            # WWZ</span>
<span class="sd">            psd_wwz=ts_std.spectral()</span>
<span class="sd">            psd_wwz_signif=psd_wwz.signif_test(number=10)</span>
<span class="sd">            @savefig spec_wwz.png</span>
<span class="sd">            fig,ax=psd_wwz_signif.plot(title=&#39;PSD using WWZ method&#39;)</span>
<span class="sd">            plt.close(fig)</span>
<span class="sd">            #Periodogram</span>
<span class="sd">            ts_interp = ts_std.interp()</span>
<span class="sd">            psd_perio=ts_interp.spectral(method=&#39;periodogram&#39;)</span>
<span class="sd">            psd_perio_signif=psd_perio.signif_test()</span>
<span class="sd">            @savefig spec_perio.png</span>
<span class="sd">            fig,ax=psd_perio_signif.plot(title=&#39;PSD using Periodogram method&#39;)</span>
<span class="sd">            plt.close(fig)</span>
<span class="sd">            #Welch</span>
<span class="sd">            ts_interp = ts_std.interp()</span>
<span class="sd">            psd_welch=ts_interp.spectral(method=&#39;welch&#39;)</span>
<span class="sd">            psd_welch_signif=psd_welch.signif_test()</span>
<span class="sd">            @savefig spec_welch.png</span>
<span class="sd">            fig,ax=psd_welch_signif.plot(title=&#39;PSD using Welch method&#39;)</span>
<span class="sd">            plt.close(fig)</span>
<span class="sd">            #MTM</span>
<span class="sd">            ts_interp = ts_std.interp()</span>
<span class="sd">            psd_mtm=ts_interp.spectral(method=&#39;mtm&#39;)</span>
<span class="sd">            psd_mtm_signif=psd_mtm.signif_test()</span>
<span class="sd">            @savefig spec_mtm.png</span>
<span class="sd">            fig,ax=psd_mtm_signif.plot(title=&#39;PSD using MTM method&#39;)</span>
<span class="sd">            plt.close(fig)</span>
<span class="sd">            #Lomb-Scargle</span>
<span class="sd">            psd_ls=ts_std.spectral(method=&#39;lomb_scargle&#39;)</span>
<span class="sd">            psd_ls_signif=psd_ls.signif_test()</span>
<span class="sd">            @savefig spec_ls.png</span>
<span class="sd">            fig,ax=psd_ls_signif.plot(title=&#39;PSD using Lomb-Scargle method&#39;)</span>
<span class="sd">            plt.close(fig)</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

        <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">spec_func</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;wwz&#39;</span><span class="p">:</span> <span class="n">specutils</span><span class="o">.</span><span class="n">wwz_psd</span><span class="p">,</span>
            <span class="s1">&#39;mtm&#39;</span><span class="p">:</span> <span class="n">specutils</span><span class="o">.</span><span class="n">mtm</span><span class="p">,</span>
            <span class="s1">&#39;lomb_scargle&#39;</span><span class="p">:</span> <span class="n">specutils</span><span class="o">.</span><span class="n">lomb_scargle</span><span class="p">,</span>
            <span class="s1">&#39;welch&#39;</span><span class="p">:</span> <span class="n">specutils</span><span class="o">.</span><span class="n">welch</span><span class="p">,</span>
            <span class="s1">&#39;periodogram&#39;</span><span class="p">:</span> <span class="n">specutils</span><span class="o">.</span><span class="n">periodogram</span>
        <span class="p">}</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">freq_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">freq_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">freq_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">waveutils</span><span class="o">.</span><span class="n">make_freq_vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">freq_method</span><span class="p">,</span> <span class="o">**</span><span class="n">freq_kwargs</span><span class="p">)</span>

        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;wwz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;mtm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;lomb_scargle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;welch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;periodogram&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
        <span class="n">spec_res</span> <span class="o">=</span> <span class="n">spec_func</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">spec_res</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">spec_res</span> <span class="o">=</span> <span class="n">dict2namedtuple</span><span class="p">(</span><span class="n">spec_res</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>

        <span class="n">psd</span> <span class="o">=</span> <span class="n">PSD</span><span class="p">(</span>
            <span class="n">frequency</span><span class="o">=</span><span class="n">spec_res</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span>
            <span class="n">amplitude</span><span class="o">=</span><span class="n">spec_res</span><span class="o">.</span><span class="n">psd</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
            <span class="n">timeseries</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">spec_method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
            <span class="n">spec_args</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">psd</span>

    <span class="k">def</span> <span class="nf">wavelet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;wwz&#39;</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freq_method</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">freq_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Perform wavelet analysis on the timeseries</span>

<span class="sd">        cwt wavelets documented on https://pywavelets.readthedocs.io/en/latest/ref/cwt.html</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        </span>
<span class="sd">        method : {wwz,cwt}</span>
<span class="sd">            Whether to use the wwz method for unevenly spaced timeseries or traditional cwt (from pywavelets)</span>
<span class="sd">            </span>
<span class="sd">        freq_method : str</span>
<span class="sd">            {&#39;log&#39;,&#39;scale&#39;, &#39;nfft&#39;, &#39;lomb_scargle&#39;, &#39;welch&#39;}</span>
<span class="sd">        </span>
<span class="sd">        freq_kwargs : dict</span>
<span class="sd">            Arguments for frequency vector</span>
<span class="sd">        </span>
<span class="sd">        settings : dict</span>
<span class="sd">            Arguments for the specific spectral method</span>
<span class="sd">        </span>
<span class="sd">        verbose : {True, False}</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        </span>
<span class="sd">        scal : Series.Scalogram</span>
<span class="sd">        </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.wavelet.wwz : wwz function</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.wavelet.cwt : cwt function</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.wavelet.make_freq : Functions to create the frequency vector</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.tsutils.detrend : Detrending function</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.core.ui.Scalogram : Scalogram object</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.core.ui.MultipleScalogram : Multiple Scalogram object</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        Wavelet analysis on the SOI record. </span>
<span class="sd">        </span>
<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>
<span class="sd">        </span>
<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            import pandas as pd</span>
<span class="sd">            from matplotlib import pyplot as plt</span>
<span class="sd">            data=pd.read_csv(&#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/soi_data.csv&#39;,skiprows=0,header=1)</span>
<span class="sd">            time=data.iloc[:,1]</span>
<span class="sd">            value=data.iloc[:,2]</span>
<span class="sd">            ts=pyleo.Series(time=time,value=value,time_name=&#39;Year C.E&#39;, value_name=&#39;SOI&#39;, label=&#39;SOI&#39;)</span>
<span class="sd">            #WWZ</span>
<span class="sd">            scal = ts.wavelet()</span>
<span class="sd">            scal_signif = scal.signif_test(number=10)</span>
<span class="sd">            @savefig wave_wwz.png</span>
<span class="sd">            fig,ax=scal_signif.plot()</span>
<span class="sd">            plt.close(fig)</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

        <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">wave_func</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;wwz&#39;</span><span class="p">:</span> <span class="n">waveutils</span><span class="o">.</span><span class="n">wwz</span><span class="p">,</span>
            <span class="s1">&#39;cwt&#39;</span><span class="p">:</span> <span class="n">waveutils</span><span class="o">.</span><span class="n">cwt</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">freq_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">freq_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">freq_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">waveutils</span><span class="o">.</span><span class="n">make_freq_vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">freq_method</span><span class="p">,</span> <span class="o">**</span><span class="n">freq_kwargs</span><span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;wwz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tau&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;cwt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;wavelet&#39;</span> <span class="p">:</span> <span class="s1">&#39;morl&#39;</span><span class="p">}</span>


        <span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
        <span class="n">wave_res</span> <span class="o">=</span> <span class="n">wave_func</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">])</span>
        <span class="n">scal</span> <span class="o">=</span> <span class="n">Scalogram</span><span class="p">(</span>
            <span class="n">frequency</span><span class="o">=</span><span class="n">wave_res</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span>
            <span class="n">time</span><span class="o">=</span><span class="n">wave_res</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">amplitude</span><span class="o">=</span><span class="n">wave_res</span><span class="o">.</span><span class="n">amplitude</span><span class="p">,</span>
            <span class="n">coi</span><span class="o">=</span><span class="n">wave_res</span><span class="o">.</span><span class="n">coi</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
            <span class="n">timeseries</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">wave_method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
            <span class="n">freq_method</span><span class="o">=</span><span class="n">freq_method</span><span class="p">,</span>
            <span class="n">freq_kwargs</span><span class="o">=</span><span class="n">freq_kwargs</span><span class="p">,</span>
            <span class="n">wave_args</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">scal</span>

    <span class="k">def</span> <span class="nf">wavelet_coherence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_series</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;wwz&#39;</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freq_method</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">freq_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Perform wavelet coherence analysis with the target timeseries</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        </span>
<span class="sd">        target_series : pyleoclim.Series</span>
<span class="sd">            A pyleoclim Series object on which to perform the coherence analysis</span>
<span class="sd">        </span>
<span class="sd">        method : {&#39;wwz&#39;}</span>
<span class="sd">        </span>
<span class="sd">        freq_method : str</span>
<span class="sd">            {&#39;log&#39;,&#39;scale&#39;, &#39;nfft&#39;, &#39;lomb_scargle&#39;, &#39;welch&#39;}</span>
<span class="sd">        </span>
<span class="sd">        freq_kwargs : dict</span>
<span class="sd">            Arguments for frequency vector</span>
<span class="sd">        </span>
<span class="sd">        settings : dict</span>
<span class="sd">            Arguments for the specific spectral method</span>
<span class="sd">        </span>
<span class="sd">        verbose : {True, False}</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        </span>
<span class="sd">        coh : pyleoclim.Coherence</span>
<span class="sd">        </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.wavelet.xwt : Cross-wavelet analysis based on WWZ method</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.wavelet.make_freq : Functions to create the frequency vector</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.tsutils.detrend : Detrending function</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.core.ui.Coherence : Coherence object</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>
<span class="sd">        </span>
<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            import pandas as pd</span>
<span class="sd">            from matplotlib import pyplot as plt</span>
<span class="sd">            data=pd.read_csv(&#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/wtc_test_data_nino.csv&#39;)</span>
<span class="sd">            t=data.iloc[:,0]</span>
<span class="sd">            air=data.iloc[:,1]</span>
<span class="sd">            nino=data.iloc[:,2]</span>
<span class="sd">            ts_nino=pyleo.Series(time=t,value=nino)</span>
<span class="sd">            ts_air=pyleo.Series(time=t,value=air)</span>
<span class="sd">            #plot the two timeseries</span>
<span class="sd">            @savefig ts_nino.png</span>
<span class="sd">            fig, ax = ts_nino.plot(title=&#39;El Nino Region 3 -- SST Anomalies&#39;)</span>
<span class="sd">            plt.close(fig)</span>
<span class="sd">            @savefig ts_air.png</span>
<span class="sd">            fig, ax = ts_air.plot(title=&#39;Deasonalized All Indian Rainfall Index&#39;)</span>
<span class="sd">            plt.close(fig)</span>
<span class="sd">            ts_air_std=ts_air.standardize()</span>
<span class="sd">            ts_nino_std=ts_nino.standardize()</span>
<span class="sd">            coh = ts_nino.wavelet_coherence(ts_air)</span>
<span class="sd">            coh_signif = coh.signif_test(number=10, qs=[0.99])</span>
<span class="sd">            @savefig coh_plot.png</span>
<span class="sd">            fig, ax = coh_signif.plot(phase_style={&#39;skip_x&#39;: 50, &#39;skip_y&#39;: 10}) </span>
<span class="sd">            plt.close(fig)</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

        <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">xwc_func</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;wwz&#39;</span><span class="p">:</span> <span class="n">waveutils</span><span class="o">.</span><span class="n">xwc</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">freq_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">freq_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">freq_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">waveutils</span><span class="o">.</span><span class="n">make_freq_vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">freq_method</span><span class="p">,</span> <span class="o">**</span><span class="n">freq_kwargs</span><span class="p">)</span>

        <span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">target_series</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="n">dt1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t1</span><span class="p">))</span>
        <span class="n">dt2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t2</span><span class="p">))</span>
        <span class="n">overlap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">t1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t2</span><span class="p">[</span><span class="mi">0</span><span class="p">]]),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">t1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">t2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">dt1</span><span class="p">,</span> <span class="n">dt2</span><span class="p">]))</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;wwz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tau&#39;</span><span class="p">:</span> <span class="n">overlap</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span>
        <span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
        <span class="n">xwc_res</span> <span class="o">=</span> <span class="n">xwc_func</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">target_series</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">target_series</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">])</span>

        <span class="n">coh</span> <span class="o">=</span> <span class="n">Coherence</span><span class="p">(</span>
            <span class="n">frequency</span><span class="o">=</span><span class="n">xwc_res</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span>
            <span class="n">time</span><span class="o">=</span><span class="n">xwc_res</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">coherence</span><span class="o">=</span><span class="n">xwc_res</span><span class="o">.</span><span class="n">xw_coherence</span><span class="p">,</span>
            <span class="n">phase</span><span class="o">=</span><span class="n">xwc_res</span><span class="o">.</span><span class="n">xw_phase</span><span class="p">,</span>
            <span class="n">coi</span><span class="o">=</span><span class="n">xwc_res</span><span class="o">.</span><span class="n">coi</span><span class="p">,</span>
            <span class="n">timeseries1</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">timeseries2</span><span class="o">=</span><span class="n">target_series</span><span class="p">,</span>
            <span class="n">freq_method</span><span class="o">=</span><span class="n">freq_method</span><span class="p">,</span>
            <span class="n">freq_kwargs</span><span class="o">=</span><span class="n">freq_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">coh</span>

    <span class="k">def</span> <span class="nf">correlation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_series</span><span class="p">,</span> <span class="n">timespan</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Estimates the Pearson&#39;s correlation and associated significance between two non IID time series</span>
<span class="sd">    </span>
<span class="sd">        The significance of the correlation is assessed using one of the following methods:</span>
<span class="sd">        </span>
<span class="sd">        1) &#39;ttest&#39;: T-test adjusted for effective sample size.</span>
<span class="sd">        2) &#39;isopersistent&#39;: AR(1) modeling of x and y.</span>
<span class="sd">        3) &#39;isospectral&#39;: phase randomization of original inputs. (default)</span>
<span class="sd">    </span>
<span class="sd">        The T-test is a parametric test, hence computationally cheap but can only be performed in idyllic circumstances.</span>
<span class="sd">        The others are non-parametric, but their computational requirements scales with nsim.</span>
<span class="sd">        </span>
<span class="sd">        The choise of significance test and associated number of Monte-Carlo simulations are passed through the settings parameter.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        </span>
<span class="sd">        target_series : pyleoclim.Series</span>
<span class="sd">            A pyleoclim Series object</span>
<span class="sd">        </span>
<span class="sd">        timespan : tuple</span>
<span class="sd">            The time interval over which to perform the calculation</span>
<span class="sd">        </span>
<span class="sd">        settings : dict</span>
<span class="sd">            Parameters for the correlation function (singificance testing and number of simulation)</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        </span>
<span class="sd">        res : dict</span>
<span class="sd">            Containing the Pearson&#39;s correlation coefficient, associated significance and p-value. </span>
<span class="sd">        </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.correlation.corr_sig : Correlation function</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        Correlation between the Nino3.4 index and the Deasonalized All Indian Rainfall Index</span>
<span class="sd">        </span>
<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>
<span class="sd">        </span>
<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            import pandas as pd</span>
<span class="sd">            from matplotlib import pyplot as plt</span>
<span class="sd">            data=pd.read_csv(&#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/wtc_test_data_nino.csv&#39;)</span>
<span class="sd">            t=data.iloc[:,0]</span>
<span class="sd">            air=data.iloc[:,1]</span>
<span class="sd">            nino=data.iloc[:,2]</span>
<span class="sd">            ts_nino=pyleo.Series(time=t,value=nino)</span>
<span class="sd">            ts_air=pyleo.Series(time=t,value=air)</span>
<span class="sd">            #plot the two timeseries</span>
<span class="sd">            @savefig ts_nino.png</span>
<span class="sd">            fig, ax = ts_nino.plot(title=&#39;El Nino Region 3 -- SST Anomalies&#39;)</span>
<span class="sd">            plt.close(fig)</span>
<span class="sd">            @savefig ts_air.png</span>
<span class="sd">            fig, ax = ts_air.plot(title=&#39;Deasonalized All Indian Rainfall Index&#39;)</span>
<span class="sd">            plt.close(fig)</span>
<span class="sd">            corr_res = ts_nino.correlation(ts_air)</span>
<span class="sd">            print(corr_res)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">timespan</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
            <span class="n">value2</span> <span class="o">=</span> <span class="n">target_series</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">timespan</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
            <span class="n">value2</span> <span class="o">=</span> <span class="n">target_series</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">timespan</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

        <span class="n">corr_res</span> <span class="o">=</span> <span class="n">corrutils</span><span class="o">.</span><span class="n">corr_sig</span><span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">corr_res</span>

    <span class="k">def</span> <span class="nf">causality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_series</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;liang&#39;</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Perform causality analysis with the target timeseries</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        </span>
<span class="sd">        target_series : pyleoclim.Series</span>
<span class="sd">            A pyleoclim Series object on which to compute causality</span>
<span class="sd">        </span>
<span class="sd">        method : {&#39;liang&#39;, &#39;granger&#39;}</span>
<span class="sd">            The causality method to use.</span>
<span class="sd">        </span>
<span class="sd">        settings : dict</span>
<span class="sd">            Parameters associated with the causality methods  . Note that each method has different parameters. See individual methods for details</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        </span>
<span class="sd">        res : dict</span>
<span class="sd">            Dictionary containing the results of the the causality analysis. See indivudal methods for details</span>
<span class="sd">        </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.causality.liang_causality : Liang causality</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.causality.granger_causality : Granger causality</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        Liang causality</span>
<span class="sd">        </span>
<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>
<span class="sd">        </span>
<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            import pandas as pd</span>
<span class="sd">            from matplotlib import pyplot as plt</span>
<span class="sd">            data=pd.read_csv(&#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/wtc_test_data_nino.csv&#39;)</span>
<span class="sd">            t=data.iloc[:,0]</span>
<span class="sd">            air=data.iloc[:,1]</span>
<span class="sd">            nino=data.iloc[:,2]</span>
<span class="sd">            ts_nino=pyleo.Series(time=t,value=nino)</span>
<span class="sd">            ts_air=pyleo.Series(time=t,value=air)</span>
<span class="sd">            #plot the two timeseries</span>
<span class="sd">            @savefig ts_nino.png</span>
<span class="sd">            fig, ax = ts_nino.plot(title=&#39;El Nino Region 3 -- SST Anomalies&#39;)</span>
<span class="sd">            plt.close(fig)</span>
<span class="sd">            @savefig ts_air.png</span>
<span class="sd">            fig, ax = ts_air.plot(title=&#39;Deasonalized All Indian Rainfall Index&#39;)</span>
<span class="sd">            plt.close(fig)</span>
<span class="sd">            caus_res = ts_nino.causality(ts_air)</span>
<span class="sd">            print(caus_res)</span>
<span class="sd">        </span>
<span class="sd">        Granger causality</span>
<span class="sd">        </span>
<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>
<span class="sd">                </span>
<span class="sd">            caus_res = ts_nino.causality(ts_air, method=&#39;granger&#39;)</span>
<span class="sd">            print(caus_res)</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">spec_func</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;liang&#39;</span><span class="p">:</span><span class="n">causalutils</span><span class="o">.</span><span class="n">liang_causality</span><span class="p">,</span>
            <span class="s1">&#39;granger&#39;</span><span class="p">:</span><span class="n">causalutils</span><span class="o">.</span><span class="n">granger_causality</span><span class="p">}</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;liang&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;granger&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
        <span class="n">causal_res</span> <span class="o">=</span> <span class="n">spec_func</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">target_series</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">causal_res</span>

    <span class="k">def</span> <span class="nf">surrogates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ar1&#39;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Generate surrogates with increasing time axis</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        </span>
<span class="sd">        method : {ar1}</span>
<span class="sd">            Uses an AR1 model to generate surrogates of the timeseries</span>
<span class="sd">        </span>
<span class="sd">        number : int</span>
<span class="sd">            The number of surrogates to generate</span>
<span class="sd">            </span>
<span class="sd">        length : int</span>
<span class="sd">            Lenght of the series</span>
<span class="sd">        </span>
<span class="sd">        seed : int</span>
<span class="sd">            Control seed option for reproducibility</span>
<span class="sd">        </span>
<span class="sd">        settings : dict</span>
<span class="sd">            Parameters for surogate generator. See individual methods for details. </span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        surr : pyleoclim SurrogateSeries</span>
<span class="sd">        </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.tsmodel.ar1_sim : AR1 simulator</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">surrogate_func</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;ar1&#39;</span><span class="p">:</span> <span class="n">tsmodel</span><span class="o">.</span><span class="n">ar1_sim</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;ar1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">}</span>
        <span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

        <span class="n">surr_res</span> <span class="o">=</span> <span class="n">surrogate_func</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">surr_res</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">surr_res</span> <span class="o">=</span> <span class="n">surr_res</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

        <span class="n">s_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">surr_res</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
            <span class="n">s_tmp</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">time_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_name</span><span class="p">,</span> <span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value_name</span><span class="p">,</span> <span class="n">value_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value_unit</span><span class="p">)</span>
            <span class="n">s_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_tmp</span><span class="p">)</span>

        <span class="n">surr</span> <span class="o">=</span> <span class="n">SurrogateSeries</span><span class="p">(</span><span class="n">series_list</span><span class="o">=</span><span class="n">s_list</span><span class="p">,</span> <span class="n">surrogate_method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">surrogate_args</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">surr</span>

    <span class="k">def</span> <span class="nf">outliers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fig_outliers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">fig_knee</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">plot_outliers_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">plot_knee_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
                 <span class="n">saveknee_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">saveoutliers_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Detects outliers in a timeseries and removes if specified</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        </span>
<span class="sd">        auto : boolean</span>
<span class="sd">            True by default, detects knee in the plot automatically</span>
<span class="sd">        remove : boolean</span>
<span class="sd">            True by default, removes all outlier points if detected</span>
<span class="sd">        fig_knee  : boolean</span>
<span class="sd">            True by default, plots knee plot if true</span>
<span class="sd">        fig_outliers : boolean</span>
<span class="sd">            True by degault, plots outliers if true</span>
<span class="sd">        save_knee : dict</span>
<span class="sd">            default parameters from matplotlib savefig None by default</span>
<span class="sd">        save_outliers : dict</span>
<span class="sd">            default parameters from matplotlib savefig None by default</span>
<span class="sd">        plot_knee_kwargs : dict</span>
<span class="sd">            arguments for the knee plot</span>
<span class="sd">        plot_outliers_kwargs : dict</span>
<span class="sd">            arguments for the outliers plot</span>
<span class="sd">        figsize : list</span>
<span class="sd">            by default [10,4]</span>
<span class="sd">     </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : Series</span>
<span class="sd">            Time series with outliers removed if they exist</span>
<span class="sd">        </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.tsutils.remove_outliers : remove outliers function</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.plotting.plot_xy : basic x-y plot</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.plotting.plot_scatter_xy : Scatter plot on top of a line plot</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1">#outlier_indices,fig1,ax1,fig2,ax2 = tsutils.detect_outliers(self.time, self.value, auto=auto, plot_knee=fig_knee,plot_outliers=fig_outliers,\</span>
        <span class="c1">#                                                   figsize=figsize,save_knee=save_knee,save_outliers=save_outliers,plot_outliers_kwargs=plot_outliers_kwargs,plot_knee_kwargs=plot_knee_kwargs)</span>
        <span class="n">outlier_indices</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">detect_outliers</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="n">auto</span><span class="p">,</span> <span class="n">plot_knee</span><span class="o">=</span><span class="n">fig_knee</span><span class="p">,</span><span class="n">plot_outliers</span><span class="o">=</span><span class="n">fig_outliers</span><span class="p">,</span>\
                                                           <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span><span class="n">saveknee_settings</span><span class="o">=</span><span class="n">saveknee_settings</span><span class="p">,</span><span class="n">saveoutliers_settings</span><span class="o">=</span><span class="n">saveoutliers_settings</span><span class="p">,</span><span class="n">plot_outliers_kwargs</span><span class="o">=</span><span class="n">plot_outliers_kwargs</span><span class="p">,</span><span class="n">plot_knee_kwargs</span><span class="o">=</span><span class="n">plot_knee_kwargs</span><span class="p">)</span>
        <span class="n">outlier_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">outlier_indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">remove</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">outlier_indices</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">outlier_indices</span><span class="p">)</span>
            <span class="n">new</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">ys</span>
            <span class="n">new</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">t</span>

        <span class="k">return</span> <span class="n">new</span>

    <span class="k">def</span> <span class="nf">interp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Interpolate a time series onto  a new  time axis</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        </span>
<span class="sd">        method : {‘linear’, ‘nearest’, ‘zero’, ‘slinear’, ‘quadratic’, ‘cubic’, ‘previous’, ‘next’}</span>
<span class="sd">            where ‘zero’, ‘slinear’, ‘quadratic’ and ‘cubic’ refer to a spline interpolation of zeroth, first, second or third order; ‘previous’ and ‘next’ simply return the previous or next value of the point) or as an integer specifying the order of the spline interpolator to use. Default is ‘linear’.</span>
<span class="sd">    </span>
<span class="sd">        kwargs : </span>
<span class="sd">            Arguments specific to each interpolation function. See pyleoclim.utils.tsutils.interp for details</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        </span>
<span class="sd">        new : pyleoclim.Series</span>
<span class="sd">            An interpolated Series object</span>
<span class="sd">        </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.tsutils.interp : interpolation function</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">x_mod</span><span class="p">,</span> <span class="n">v_mod</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">interp_type</span><span class="o">=</span><span class="n">method</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">x_mod</span>
        <span class="n">new</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">v_mod</span>
        <span class="k">return</span> <span class="n">new</span>

    <span class="k">def</span> <span class="nf">bin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Bin values in a time series</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        </span>
<span class="sd">        kwargs : </span>
<span class="sd">            Arguments for binning function. See pyleoclim.utils.tsutils.bin_values for details</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        </span>
<span class="sd">        new : pyleoclim.Series</span>
<span class="sd">            An binned Series object</span>
<span class="sd">        </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.tsutils.bin_values : bin the time series into evenly-spaced bins</span>
<span class="sd">                </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">x_mod</span><span class="p">,</span> <span class="n">v_mod</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">bin_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">x_mod</span>
        <span class="n">new</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">v_mod</span>
        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="PSD"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.PSD">[docs]</a><span class="k">class</span> <span class="nc">PSD</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;PSD object obtained from spectral analysis.</span>
<span class="sd">    </span>
<span class="sd">    See examples in pyleoclim.core.ui.Series.spectral to see how to create and manipulate these objects</span>
<span class="sd">    </span>
<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    </span>
<span class="sd">    pyleoclim.core.ui.Series.spectral : spectral analysis</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeseries</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">spec_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spec_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signif_qs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signif_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">period_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">amplitude</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeseries</span> <span class="o">=</span> <span class="n">timeseries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spec_method</span> <span class="o">=</span> <span class="n">spec_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spec_args</span> <span class="o">=</span> <span class="n">spec_args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signif_qs</span> <span class="o">=</span> <span class="n">signif_qs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signif_method</span> <span class="o">=</span> <span class="n">signif_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">plot_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">period_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="o">=</span> <span class="n">period_unit</span>
        <span class="k">elif</span> <span class="n">timeseries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">timeseries</span><span class="o">.</span><span class="n">time_unit</span><span class="si">}</span><span class="s1">s&#39;</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Copy object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">table</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Frequency&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span>
            <span class="s1">&#39;Amplitude&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s1">&#39;keys&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Length: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">def</span> <span class="nf">signif_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ar1&#39;</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">qs</span><span class="o">=</span><span class="p">[</span><span class="mf">0.95</span><span class="p">],</span>
                    <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        number : int, optional</span>
<span class="sd">            Number of surrogate series to generate for significance testing. The default is 200.</span>
<span class="sd">        method : {ar1}, optional</span>
<span class="sd">            Method to generate surrogates. The default is &#39;ar1&#39;.</span>
<span class="sd">        seed : int, optional</span>
<span class="sd">            Option to set the seed for reproducibility. The default is None.</span>
<span class="sd">        qs : list, optional</span>
<span class="sd">            Singificance levels to return. The default is [0.95].</span>
<span class="sd">        settings : dict, optional</span>
<span class="sd">            Parameters. The default is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : pyleoclim.PSD</span>
<span class="sd">            New PSD object with appropriate significance test</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">surr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">surrogates</span><span class="p">(</span>
            <span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span>
        <span class="p">)</span>
        <span class="n">surr_psd</span> <span class="o">=</span> <span class="n">surr</span><span class="o">.</span><span class="n">spectral</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spec_method</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spec_args</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">signif_qs</span> <span class="o">=</span> <span class="n">surr_psd</span><span class="o">.</span><span class="n">quantiles</span><span class="p">(</span><span class="n">qs</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">signif_method</span> <span class="o">=</span> <span class="n">method</span>

        <span class="k">return</span> <span class="n">new</span>

    <span class="k">def</span> <span class="nf">beta_est</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Estimate the scaling factor beta of the PSD in a log-log space</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fmin : float</span>
<span class="sd">            the minimum frequency edge for beta estimation; the default is the minimum of the frequency vector of the PSD obj</span>

<span class="sd">        fmax : float</span>
<span class="sd">            the maximum frequency edge for beta estimation; the default is the maximum of the frequency vector of the PSD obj</span>

<span class="sd">        verbose : bool</span>
<span class="sd">            if True, will print out debug information</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        res_dict : dictionary</span>
<span class="sd">            - beta: the scaling factor</span>
<span class="sd">            - std_err: the one standard deviation error of the scaling factor</span>
<span class="sd">            - f_binned: the binned frequency series, used as X for linear regression</span>
<span class="sd">            - psd_binned: the binned PSD series, used as Y for linear regression</span>
<span class="sd">            - Y_reg: the predicted Y from linear regression, used with f_binned for the slope curve plotting</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">fmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">waveutils</span><span class="o">.</span><span class="n">beta_estimation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">res_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;beta&#39;</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">beta</span><span class="p">,</span>
            <span class="s1">&#39;std_err&#39;</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">std_err</span><span class="p">,</span>
            <span class="s1">&#39;f_binned&#39;</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">f_binned</span><span class="p">,</span>
            <span class="s1">&#39;psd_binned&#39;</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">psd_binned</span><span class="p">,</span>
            <span class="s1">&#39;Y_reg&#39;</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">Y_reg</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">res_dict</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_loglog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">in_period</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transpose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">plot_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lgd_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">plot_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signif_clr</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">signif_linestyles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">],</span> <span class="n">signif_linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Plots the PSD estimates and signif level if included</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        in_loglog : bool, optional</span>
<span class="sd">            Plot on loglog axis. The default is True.</span>
<span class="sd">        in_period : bool, optional</span>
<span class="sd">            Plot the x-axis as periodicity rather than frequency. The default is True.</span>
<span class="sd">        label : str, optional</span>
<span class="sd">            label for the series. The default is None.</span>
<span class="sd">        xlabel : str, optional</span>
<span class="sd">            Label for the x-axis. The default is None. Will guess based on Series</span>
<span class="sd">        ylabel : str, optional</span>
<span class="sd">            Label for the y-axis. The default is &#39;Amplitude&#39;. Will guess based on Series</span>
<span class="sd">        title : str, optional</span>
<span class="sd">            Plot title. The default is None.</span>
<span class="sd">        marker : str, optional</span>
<span class="sd">            marker to use. The default is None.</span>
<span class="sd">        markersize : int, optional</span>
<span class="sd">            size of the marker. The default is None.</span>
<span class="sd">        color : str, optional</span>
<span class="sd">            Line color. The default is None.</span>
<span class="sd">        linestyle : str, optional</span>
<span class="sd">            linestyle. The default is None.</span>
<span class="sd">        linewidth : float, optional</span>
<span class="sd">            Width of the line. The default is None.</span>
<span class="sd">        transpose : bool, optional</span>
<span class="sd">            Plot periodicity on y-. The default is False.</span>
<span class="sd">        xlim : list, optional</span>
<span class="sd">            x-axis limits. The default is None.</span>
<span class="sd">        ylim : list, optional</span>
<span class="sd">            y-axis limits. The default is None.</span>
<span class="sd">        figsize : list, optional</span>
<span class="sd">            Figure size. The default is [10, 4].</span>
<span class="sd">        savefig_settings : dict, optional</span>
<span class="sd">            save settings options. The default is None.</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">            - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">              with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">            - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;}</span>
<span class="sd">        ax : ax, optional</span>
<span class="sd">            The matplotlib.Axes object onto which to return the plot. The default is None.</span>
<span class="sd">        mute : bool, optional</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax The default is False.</span>
<span class="sd">        plot_legend : bool, optional</span>
<span class="sd">            whether to plot the legend. The default is True.</span>
<span class="sd">        lgd_kwargs : dict, optional</span>
<span class="sd">            Arguments for the legend. The default is None.</span>
<span class="sd">        xticks : list, optional</span>
<span class="sd">            xticks to use. The default is None.</span>
<span class="sd">        yticks : list, optional</span>
<span class="sd">            yticks to use. The default is None.</span>
<span class="sd">        alpha : float, optional</span>
<span class="sd">            Transparency setting. The default is None.</span>
<span class="sd">        zorder : int, optional</span>
<span class="sd">            Order for the plot. The default is None.</span>
<span class="sd">        plot_kwargs : dict, optional</span>
<span class="sd">            Other plotting argument. The default is None.</span>
<span class="sd">        signif_clr : str, optional</span>
<span class="sd">            Color for the significance line. The default is &#39;red&#39;.</span>
<span class="sd">        signif_linestyles : list of str, optional</span>
<span class="sd">            Linestyles for significance. The default is [&#39;--&#39;, &#39;-.&#39;, &#39;:&#39;].</span>
<span class="sd">        signif_linewidth : float, optional</span>
<span class="sd">            width of the significance line. The default is 1.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig, ax</span>
<span class="sd">        </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.core.ui.Series.spectral : spectral analysis</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">savefig_settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">savefig_settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">savefig_settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">plot_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_kwargs</span> <span class="k">if</span> <span class="n">plot_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">lgd_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">lgd_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">lgd_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>

        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">label</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">marker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="n">marker</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">markersize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;markersize&#39;</span><span class="p">:</span> <span class="n">markersize</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">linestyle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="n">linestyle</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">linewidth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="n">linewidth</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">alpha</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">zorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;zorder&#39;</span><span class="p">:</span> <span class="n">zorder</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">in_period</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">x_axis</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
            <span class="n">y_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Period [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span><span class="si">}</span><span class="s1">]&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;Period&#39;</span>

            <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xticks_default</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">])</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">xticks_default</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_axis</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">xticks_default</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_axis</span><span class="p">))</span>
                <span class="n">xticks</span> <span class="o">=</span> <span class="n">xticks_default</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xticks</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">xticks</span><span class="p">)]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">x_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
            <span class="n">y_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Frequency [1/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span><span class="si">}</span><span class="s1">]&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;Frequency&#39;</span>

            <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xlim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
                <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">xlim</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xlim</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
            <span class="n">x_axis</span><span class="p">,</span> <span class="n">y_axis</span> <span class="o">=</span> <span class="n">y_axis</span><span class="p">,</span> <span class="n">x_axis</span>
            <span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span> <span class="o">=</span> <span class="n">ylim</span><span class="p">,</span> <span class="n">xlim</span>
            <span class="n">xticks</span><span class="p">,</span> <span class="n">yticks</span> <span class="o">=</span> <span class="n">yticks</span><span class="p">,</span> <span class="n">xticks</span>
            <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">xlabel</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">y_axis</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>

        <span class="c1"># plot significance levels</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signif_qs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">signif_method_label</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;ar1&#39;</span><span class="p">:</span> <span class="s1">&#39;AR(1)&#39;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">nqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signif_qs</span><span class="o">.</span><span class="n">psd_list</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signif_qs</span><span class="o">.</span><span class="n">psd_list</span><span class="p">):</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">frequency</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">signif_x_axis</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="k">if</span> <span class="n">in_period</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
                <span class="n">signif_y_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">amplitude</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
                    <span class="n">signif_x_axis</span><span class="p">,</span> <span class="n">signif_y_axis</span> <span class="o">=</span> <span class="n">signif_y_axis</span><span class="p">,</span> <span class="n">signif_x_axis</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">signif_x_axis</span><span class="p">,</span> <span class="n">signif_y_axis</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">signif_method_label</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">signif_method</span><span class="p">]</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">q</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1"> threshold&#39;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">signif_clr</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="n">signif_linestyles</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="mi">3</span><span class="p">],</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="n">signif_linewidth</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">in_loglog</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">nonpositive</span><span class="o">=</span><span class="s1">&#39;clip&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">nonpositive</span><span class="o">=</span><span class="s1">&#39;clip&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ScalarFormatter</span><span class="p">())</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ScalarFormatter</span><span class="p">())</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot_legend</span><span class="p">:</span>
            <span class="n">lgd_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;frameon&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
            <span class="n">lgd_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lgd_kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">lgd_args</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;fig&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">savefig_settings</span><span class="p">:</span>
                <span class="n">plotting</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mute</span><span class="p">:</span>
                    <span class="n">plotting</span><span class="o">.</span><span class="n">showfig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="Scalogram"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Scalogram">[docs]</a><span class="k">class</span> <span class="nc">Scalogram</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">,</span> <span class="n">coi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Neff</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">timeseries</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">wave_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wave_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signif_qs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signif_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freq_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freq_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">period_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">            frequency : array</span>
<span class="sd">                the frequency axis</span>
<span class="sd">            time : array</span>
<span class="sd">                the time axis</span>
<span class="sd">            amplitude : array</span>
<span class="sd">                the amplitude at each (frequency, time) point;</span>
<span class="sd">                note the dimension is assumed to be (frequency, time)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">amplitude</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">coi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coi</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coi</span> <span class="o">=</span> <span class="n">waveutils</span><span class="o">.</span><span class="n">make_coi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">Neff</span><span class="o">=</span><span class="n">Neff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeseries</span> <span class="o">=</span> <span class="n">timeseries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wave_method</span> <span class="o">=</span> <span class="n">wave_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wave_args</span> <span class="o">=</span> <span class="n">wave_args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signif_qs</span> <span class="o">=</span> <span class="n">signif_qs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signif_method</span> <span class="o">=</span> <span class="n">signif_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_method</span> <span class="o">=</span> <span class="n">freq_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_kwargs</span> <span class="o">=</span> <span class="n">freq_kwargs</span>
        <span class="k">if</span> <span class="n">period_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="o">=</span> <span class="n">period_unit</span>
        <span class="k">elif</span> <span class="n">timeseries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="o">=</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">time_unit</span>
        <span class="k">if</span> <span class="n">time_label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_label</span> <span class="o">=</span> <span class="n">time_label</span>
        <span class="k">elif</span> <span class="n">timeseries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">timeseries</span><span class="o">.</span><span class="n">time_name</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Copy object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">table</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Frequency&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span>
            <span class="s1">&#39;Time&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="s1">&#39;Amplitude&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s1">&#39;keys&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Dimension: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span><span class="si">}</span><span class="s1"> x </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_period</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">signif_clr</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">signif_linestyles</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">signif_linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
             <span class="n">contourf_style</span><span class="o">=</span><span class="p">{},</span> <span class="n">cbar_style</span><span class="o">=</span><span class="p">{},</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="p">{},</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Plot the scalogram        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        in_period : bool, optional</span>
<span class="sd">            Plot the in period instead of frequency space. The default is True.</span>
<span class="sd">        xlabel : str, optional</span>
<span class="sd">            Label for the x-axis. The default is None.</span>
<span class="sd">        ylabel : str, optional</span>
<span class="sd">            Label for the y-axis. The default is None.</span>
<span class="sd">        title : str, optional</span>
<span class="sd">            Title for the figure. The default is None.</span>
<span class="sd">        ylim : list, optional</span>
<span class="sd">            Limits for the y-axis. The default is None.</span>
<span class="sd">        xlim : list, optional</span>
<span class="sd">            Limits for the x-axis. The default is None.</span>
<span class="sd">        yticks : list, optional</span>
<span class="sd">            yticks label. The default is None.</span>
<span class="sd">        figsize : list, optional</span>
<span class="sd">            Figure size The default is [10, 8].</span>
<span class="sd">        mute : bool, optional</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax The default is False.</span>
<span class="sd">        signif_clr : str, optional</span>
<span class="sd">            Color of the singificance line. The default is &#39;white&#39;.</span>
<span class="sd">        signif_linestyles : str, optional</span>
<span class="sd">            Linestyle of the significance line. The default is &#39;-&#39;.</span>
<span class="sd">        signif_linewidths : float, optional</span>
<span class="sd">            Width for the significance line. The default is 1.</span>
<span class="sd">        contourf_style : dict, optional</span>
<span class="sd">            Arguments for the contour plot. The default is {}.</span>
<span class="sd">        cbar_style : dict, optional</span>
<span class="sd">            Arguments for the colarbar. The default is {}.</span>
<span class="sd">        savefig_settings : dict, optional</span>
<span class="sd">            saving options for the figure. The default is {}.</span>
<span class="sd">        ax : ax, optional</span>
<span class="sd">            Matplotlib Axis on which to return the figure. The default is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig, ax</span>
<span class="sd">        </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.core.ui.Series.wavelet : Wavelet analysis</span>
<span class="sd">        </span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">contourf_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cmap&#39;</span><span class="p">:</span> <span class="s1">&#39;magma&#39;</span><span class="p">,</span> <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="s1">&#39;levels&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">}</span>
        <span class="n">contourf_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">contourf_style</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">in_period</span><span class="p">:</span>
            <span class="n">y_axis</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>
            <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Period [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span><span class="si">}</span><span class="s1">]&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;Period&#39;</span>

            <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">yticks_default</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">])</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">yticks_default</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y_axis</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">yticks_default</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_axis</span><span class="p">))</span>
                <span class="n">yticks</span> <span class="o">=</span> <span class="n">yticks_default</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>
            <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Frequency [1/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span><span class="si">}</span><span class="s1">]&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;Frequency&#39;</span>

        <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_label</span>

        <span class="n">cont</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">y_axis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="o">**</span><span class="n">contourf_args</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">nonpositive</span><span class="o">=</span><span class="s1">&#39;clip&#39;</span><span class="p">)</span>

        <span class="c1"># plot colorbar</span>
        <span class="n">cbar_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;drawedges&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="s1">&#39;fraction&#39;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">,</span> <span class="s1">&#39;pad&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">}</span>
        <span class="n">cbar_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cbar_style</span><span class="p">)</span>

        <span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="o">**</span><span class="n">cbar_args</span><span class="p">)</span>

        <span class="c1"># plot cone of influence</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coi</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ScalarFormatter</span><span class="p">())</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y_axis</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_axis</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coi</span><span class="p">)])]</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coi</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="c1"># plot significance levels</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signif_qs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">signif_method_label</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;ar1&#39;</span><span class="p">:</span> <span class="s1">&#39;AR(1)&#39;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">signif_scal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signif_qs</span><span class="o">.</span><span class="n">scalogram_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">signif_boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">signif_scal</span><span class="o">.</span><span class="n">amplitude</span><span class="o">.</span><span class="n">T</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">y_axis</span><span class="p">,</span> <span class="n">signif_boundary</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">99</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">colors</span><span class="o">=</span><span class="n">signif_clr</span><span class="p">,</span>
                <span class="n">linestyles</span><span class="o">=</span><span class="n">signif_linestyles</span><span class="p">,</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="n">signif_linewidths</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;fig&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">savefig_settings</span><span class="p">:</span>
                <span class="n">plotting</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mute</span><span class="p">:</span>
                    <span class="n">plotting</span><span class="o">.</span><span class="n">showfig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">signif_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ar1&#39;</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">qs</span><span class="o">=</span><span class="p">[</span><span class="mf">0.95</span><span class="p">],</span>
                    <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Significance test for wavelet analysis</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        number : int, optional</span>
<span class="sd">            Number of surrogates to generate for significance analysis. The default is 200.</span>
<span class="sd">        method : {&#39;ar1&#39;}, optional</span>
<span class="sd">            Method to use to generate the surrogates. The default is &#39;ar1&#39;.</span>
<span class="sd">        seed : int, optional</span>
<span class="sd">            Set the seed for the random number generator. Useful for reproducibility The default is None.</span>
<span class="sd">        qs : list, optional</span>
<span class="sd">            Significane level to consider. The default is [0.95].</span>
<span class="sd">        settings : dict, optional</span>
<span class="sd">            Parameters for the model. The default is None.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            qs should be a list with at least one value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : pyleoclim.Scalogram</span>
<span class="sd">            A new Scalogram object with the significance level</span>
<span class="sd">        </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.core.ui.Series.wavelet : wavelet analysis</span>

<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">surr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">surrogates</span><span class="p">(</span>
            <span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span>
        <span class="p">)</span>
        <span class="n">surr_scal</span> <span class="o">=</span> <span class="n">surr</span><span class="o">.</span><span class="n">wavelet</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_method</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_args</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">qs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;qs should be a list with size 1!&#39;</span><span class="p">)</span>

        <span class="n">new</span><span class="o">.</span><span class="n">signif_qs</span> <span class="o">=</span> <span class="n">surr_scal</span><span class="o">.</span><span class="n">quantiles</span><span class="p">(</span><span class="n">qs</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">signif_method</span> <span class="o">=</span> <span class="n">method</span>

        <span class="k">return</span> <span class="n">new</span></div>


<div class="viewcode-block" id="Coherence"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Coherence">[docs]</a><span class="k">class</span> <span class="nc">Coherence</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Coherence object</span>
<span class="sd">    </span>
<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    </span>
<span class="sd">    pyleoclim.core.ui.Series.wavelet_coherence : Wavelet coherence</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">coherence</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">coi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">timeseries1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeseries2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signif_qs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signif_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">freq_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freq_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Neff</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">period_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coherence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coherence</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">coi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coi</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coi</span> <span class="o">=</span> <span class="n">waveutils</span><span class="o">.</span><span class="n">make_coi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">Neff</span><span class="o">=</span><span class="n">Neff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeseries1</span> <span class="o">=</span> <span class="n">timeseries1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeseries2</span> <span class="o">=</span> <span class="n">timeseries2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signif_qs</span> <span class="o">=</span> <span class="n">signif_qs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signif_method</span> <span class="o">=</span> <span class="n">signif_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_method</span> <span class="o">=</span> <span class="n">freq_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_kwargs</span> <span class="o">=</span> <span class="n">freq_kwargs</span>
        <span class="k">if</span> <span class="n">period_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="o">=</span> <span class="n">period_unit</span>
        <span class="k">elif</span> <span class="n">timeseries1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="o">=</span> <span class="n">timeseries1</span><span class="o">.</span><span class="n">time_unit</span>
        <span class="k">if</span> <span class="n">time_label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_label</span> <span class="o">=</span> <span class="n">time_label</span>
        <span class="k">elif</span> <span class="n">timeseries1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">timeseries1</span><span class="o">.</span><span class="n">time_name</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Copy object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
             <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">in_period</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">contourf_style</span><span class="o">=</span><span class="p">{},</span> <span class="n">phase_style</span><span class="o">=</span><span class="p">{},</span> <span class="n">cbar_style</span><span class="o">=</span><span class="p">{},</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="p">{},</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">signif_clr</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">signif_linestyles</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">signif_linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
             <span class="n">under_clr</span><span class="o">=</span><span class="s1">&#39;ivory&#39;</span><span class="p">,</span> <span class="n">over_clr</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">bad_clr</span><span class="o">=</span><span class="s1">&#39;dimgray&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Plot the cross-wavelet results</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xlabel : str, optional</span>
<span class="sd">            x-axis label. The default is None.</span>
<span class="sd">        ylabel : str, optional</span>
<span class="sd">            y-axis label. The default is None.</span>
<span class="sd">        title : str, optional</span>
<span class="sd">            Title of the plot. The default is None.</span>
<span class="sd">        figsize : list, optional</span>
<span class="sd">            Figure size. The default is [10, 8].</span>
<span class="sd">        ylim : list, optional</span>
<span class="sd">            y-axis limits. The default is None.</span>
<span class="sd">        xlim : list, optional</span>
<span class="sd">            x-axis limits. The default is None.</span>
<span class="sd">        in_period : bool, optional</span>
<span class="sd">            Plots periods instead of frequencies The default is True.</span>
<span class="sd">        yticks : list, optional</span>
<span class="sd">            y-ticks label. The default is None.</span>
<span class="sd">        mute : bool, optional</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax The default is False. The default is False.</span>
<span class="sd">        contourf_style : dict, optional</span>
<span class="sd">            Arguments for the contour plot. The default is {}.</span>
<span class="sd">        phase_style : dict, optional</span>
<span class="sd">            Arguments for the phase arrows. The default is {}.</span>
<span class="sd">        cbar_style : dict, optional</span>
<span class="sd">            Arguments for the color bar. The default is {}.</span>
<span class="sd">        savefig_settings : dict, optional</span>
<span class="sd">            The default is {}.</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">            - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">              with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">            - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;}</span>
<span class="sd">        ax : ax, optional</span>
<span class="sd">            Matplotlib axis on which to return the figure. The default is None.</span>
<span class="sd">        signif_clr : str, optional</span>
<span class="sd">            Color of the singificance line. The default is &#39;white&#39;.</span>
<span class="sd">        signif_linestyles : str, optional</span>
<span class="sd">            Style of the significance line. The default is &#39;-&#39;.</span>
<span class="sd">        signif_linewidths : float, optional</span>
<span class="sd">            Width of the significance line. The default is 1.</span>
<span class="sd">        under_clr : str, optional</span>
<span class="sd">            Color for under 0. The default is &#39;ivory&#39;.</span>
<span class="sd">        over_clr : str, optional</span>
<span class="sd">            Color for over 1. The default is &#39;black&#39;.</span>
<span class="sd">        bad_clr : str, optional</span>
<span class="sd">            Color for missing values. The default is &#39;dimgray&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig, ax</span>
<span class="sd">        </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.core.ui.Series.wavelet_coherence</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">in_period</span><span class="p">:</span>
            <span class="n">y_axis</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>
            <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Period [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span><span class="si">}</span><span class="s1">]&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;Period&#39;</span>

            <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">yticks_default</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">])</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">yticks_default</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y_axis</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">yticks_default</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_axis</span><span class="p">))</span>
                <span class="n">yticks</span> <span class="o">=</span> <span class="n">yticks_default</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>
            <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Frequency [1/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span><span class="si">}</span><span class="s1">]&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;Frequency&#39;</span>

        <span class="c1"># plot coherence amplitude</span>
        <span class="n">contourf_args</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;cmap&#39;</span><span class="p">:</span> <span class="s1">&#39;magma&#39;</span><span class="p">,</span>
            <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="s1">&#39;lower&#39;</span><span class="p">,</span>
            <span class="s1">&#39;levels&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">contourf_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">contourf_style</span><span class="p">)</span>

        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">contourf_args</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">])</span>
        <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">under_clr</span><span class="p">)</span>
        <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">over_clr</span><span class="p">)</span>
        <span class="n">cmap</span><span class="o">.</span><span class="n">set_bad</span><span class="p">(</span><span class="n">bad_clr</span><span class="p">)</span>
        <span class="n">contourf_args</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmap</span>

        <span class="n">cont</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">y_axis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coherence</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="o">**</span><span class="n">contourf_args</span><span class="p">)</span>

        <span class="c1"># plot significance levels</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signif_qs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">signif_method_label</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;ar1&#39;</span><span class="p">:</span> <span class="s1">&#39;AR(1)&#39;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">signif_coh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signif_qs</span><span class="o">.</span><span class="n">scalogram_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">signif_boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coherence</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">signif_coh</span><span class="o">.</span><span class="n">amplitude</span><span class="o">.</span><span class="n">T</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">y_axis</span><span class="p">,</span> <span class="n">signif_boundary</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">99</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">colors</span><span class="o">=</span><span class="n">signif_clr</span><span class="p">,</span>
                <span class="n">linestyles</span><span class="o">=</span><span class="n">signif_linestyles</span><span class="p">,</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="n">signif_linewidths</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># plot colorbar</span>
        <span class="n">cbar_args</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;drawedges&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;vertical&#39;</span><span class="p">,</span>
            <span class="s1">&#39;fraction&#39;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">,</span>
            <span class="s1">&#39;pad&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
            <span class="s1">&#39;ticks&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">cbar_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cbar_style</span><span class="p">)</span>

        <span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="o">**</span><span class="n">cbar_args</span><span class="p">)</span>

        <span class="c1"># plot cone of influence</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">nonposy</span><span class="o">=</span><span class="s1">&#39;clip&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coi</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y_axis</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_axis</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coi</span><span class="p">)])]</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coi</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ScalarFormatter</span><span class="p">())</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="c1"># plot phase</span>
        <span class="n">yaxis_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_axis</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y_axis</span><span class="p">)</span>
        <span class="n">xaxis_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="n">phase_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pt&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;skip_x&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">xaxis_range</span><span class="o">//</span><span class="mi">10</span><span class="p">),</span> <span class="s1">&#39;skip_y&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">yaxis_range</span><span class="o">//</span><span class="mi">50</span><span class="p">),</span> <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mf">0.004</span><span class="p">}</span>
        <span class="n">phase_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">phase_style</span><span class="p">)</span>

        <span class="n">pt</span> <span class="o">=</span> <span class="n">phase_args</span><span class="p">[</span><span class="s1">&#39;pt&#39;</span><span class="p">]</span>
        <span class="n">skip_x</span> <span class="o">=</span> <span class="n">phase_args</span><span class="p">[</span><span class="s1">&#39;skip_x&#39;</span><span class="p">]</span>
        <span class="n">skip_y</span> <span class="o">=</span> <span class="n">phase_args</span><span class="p">[</span><span class="s1">&#39;skip_y&#39;</span><span class="p">]</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">phase_args</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">phase_args</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span>

        <span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signif_qs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">phase</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">coherence</span> <span class="o">&lt;</span> <span class="n">pt</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">phase</span><span class="p">[</span><span class="n">signif_boundary</span><span class="o">.</span><span class="n">T</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
        <span class="n">U</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">X</span><span class="p">[::</span><span class="n">skip_y</span><span class="p">,</span> <span class="p">::</span><span class="n">skip_x</span><span class="p">],</span> <span class="n">Y</span><span class="p">[::</span><span class="n">skip_y</span><span class="p">,</span> <span class="p">::</span><span class="n">skip_x</span><span class="p">],</span>
                  <span class="n">U</span><span class="p">[::</span><span class="n">skip_y</span><span class="p">,</span> <span class="p">::</span><span class="n">skip_x</span><span class="p">],</span> <span class="n">V</span><span class="p">[::</span><span class="n">skip_y</span><span class="p">,</span> <span class="p">::</span><span class="n">skip_x</span><span class="p">],</span>
                  <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;fig&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">savefig_settings</span><span class="p">:</span>
                <span class="n">plotting</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mute</span><span class="p">:</span>
                    <span class="n">plotting</span><span class="o">.</span><span class="n">showfig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">signif_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ar1&#39;</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">qs</span><span class="o">=</span><span class="p">[</span><span class="mf">0.95</span><span class="p">],</span> <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute_pbar</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Significance testing        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        number : int, optional</span>
<span class="sd">            Number of surrogate series to create for significance testing. The default is 200.</span>
<span class="sd">        method : {&#39;ar1&#39;}, optional</span>
<span class="sd">            Method through which to generate the surrogate series. The default is &#39;ar1&#39;.</span>
<span class="sd">        seed : int, optional</span>
<span class="sd">            Fixes the seed for the random number generator. Useful for reproducibility. The default is None.</span>
<span class="sd">        qs : list, optional</span>
<span class="sd">            Significanc level to return. The default is [0.95].</span>
<span class="sd">        settings : dict, optional</span>
<span class="sd">            Parameters for surrogate model. The default is None.</span>
<span class="sd">        mute_pbar : bool, optional</span>
<span class="sd">            Mute the progress bar. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : pyleoclim.Coherence</span>
<span class="sd">            Coherence with significance level</span>
<span class="sd">            </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.core.ui.Series.wavelet_coherence : Wavelet coherence</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">surr1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeseries1</span><span class="o">.</span><span class="n">surrogates</span><span class="p">(</span>
            <span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span>
        <span class="p">)</span>
        <span class="n">surr2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeseries2</span><span class="o">.</span><span class="n">surrogates</span><span class="p">(</span>
            <span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span>
        <span class="p">)</span>

        <span class="n">cohs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">number</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Performing wavelet coherence on surrogate pairs&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="n">mute_pbar</span><span class="p">):</span>
            <span class="n">coh_tmp</span> <span class="o">=</span> <span class="n">surr1</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">wavelet_coherence</span><span class="p">(</span><span class="n">surr2</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">freq_method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_method</span><span class="p">,</span> <span class="n">freq_kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_kwargs</span><span class="p">)</span>
            <span class="n">cohs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coh_tmp</span><span class="o">.</span><span class="n">coherence</span><span class="p">)</span>

        <span class="n">cohs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cohs</span><span class="p">)</span>

        <span class="n">ne</span><span class="p">,</span> <span class="n">nf</span><span class="p">,</span> <span class="n">nt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">cohs</span><span class="p">)</span>

        <span class="n">coh_qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">qs</span><span class="p">),</span> <span class="n">nf</span><span class="p">,</span> <span class="n">nt</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nf</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">):</span>
                <span class="n">coh_qs</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">mquantiles</span><span class="p">(</span><span class="n">cohs</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">qs</span><span class="p">)</span>

        <span class="n">scal_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">amp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coh_qs</span><span class="p">):</span>
            <span class="n">scal_tmp</span> <span class="o">=</span> <span class="n">Scalogram</span><span class="p">(</span>
                    <span class="n">frequency</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">coi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coi</span><span class="p">,</span>
                    <span class="n">freq_method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_method</span><span class="p">,</span> <span class="n">freq_kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_kwargs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s1">g</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">scal_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scal_tmp</span><span class="p">)</span>

        <span class="n">new</span><span class="o">.</span><span class="n">signif_qs</span> <span class="o">=</span> <span class="n">MultipleScalogram</span><span class="p">(</span><span class="n">scalogram_list</span><span class="o">=</span><span class="n">scal_list</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">signif_method</span> <span class="o">=</span> <span class="n">method</span>

        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="MultipleSeries"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultipleSeries">[docs]</a><span class="k">class</span> <span class="nc">MultipleSeries</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Define a multiple series object.</span>
<span class="sd">    </span>
<span class="sd">    This is useful for ensembling or working with multiple timeseries in the same workflow</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    </span>
<span class="sd">    series_list : list</span>
<span class="sd">        a list of pyleoclim.Series objects</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    </span>
<span class="sd">    Create a MultipleSeries object for the Nino and All Indian Rainfall indices</span>
<span class="sd">    </span>
<span class="sd">    .. ipython:: python</span>
<span class="sd">        :okwarning:</span>
<span class="sd">        </span>
<span class="sd">        import pyleoclim as pyleo</span>
<span class="sd">        import pandas as pd</span>
<span class="sd">        data=pd.read_csv(&#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/wtc_test_data_nino.csv&#39;)</span>
<span class="sd">        t=data.iloc[:,0]</span>
<span class="sd">        air=data.iloc[:,1]</span>
<span class="sd">        nino=data.iloc[:,2]</span>
<span class="sd">        ts_nino=pyleo.Series(time=t,value=nino)</span>
<span class="sd">        ts_air=pyleo.Series(time=t,value=air)</span>
<span class="sd">        series_list=[ts_nino,ts_air]</span>
<span class="sd">        ts_all = pyleo.MultipleSeries(series_list)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">series_list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">series_list</span> <span class="o">=</span> <span class="n">series_list</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Copy the object </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">standardize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Standardize each series object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : pyleoclim.MultipleSeries</span>
<span class="sd">            The standardized Series</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">series_list</span><span class="p">):</span>
            <span class="n">s</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">v_mod</span><span class="o">=</span><span class="n">tsutils</span><span class="o">.</span><span class="n">standardize</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">s</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="n">v_mod</span>
            <span class="n">new</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="n">s</span>
        <span class="k">return</span> <span class="n">new</span>

    <span class="c1"># def mssa(self, M, MC=0, f=0.5):</span>
    <span class="c1">#     data = []</span>
    <span class="c1">#     for val in self.series_list:</span>
    <span class="c1">#         data.append(val.value)</span>
    <span class="c1">#     data = np.transpose(np.asarray(data))</span>


    <span class="c1">#     res = decomposition.mssa(data, M=M, MC=MC, f=f)</span>
    <span class="c1">#     return res</span>

    <span class="c1"># def pca(self):</span>
    <span class="c1">#     data = []</span>
    <span class="c1">#     for val in self.series_list:</span>
    <span class="c1">#         data.append(val.value)</span>
    <span class="c1">#     a = len(data[0])</span>
    <span class="c1">#     r = data[1:]</span>
    <span class="c1">#     flag = all (len(v)==a for v in r)</span>
    <span class="c1">#     if flag==False:</span>
    <span class="c1">#         print(&#39;All Time Series should be of same length&#39;)</span>
    <span class="c1">#         return</span>
    <span class="c1">#     data = np.transpose(np.asarray(data))</span>
    <span class="c1">#     res = decomposition.pca(data)</span>
    <span class="c1">#     return res</span>

    <span class="k">def</span> <span class="nf">detrend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;emd&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Detrend timeseries</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        method : str, optional</span>
<span class="sd">            The method for detrending. The default is &#39;emd&#39;.</span>
<span class="sd">            Options include:</span>
<span class="sd">                * linear: the result of a linear least-squares fit to y is subtracted from y.</span>
<span class="sd">                * constant: only the mean of data is subtrated.</span>
<span class="sd">                * &quot;savitzky-golay&quot;, y is filtered using the Savitzky-Golay filters and the resulting filtered series is subtracted from y.</span>
<span class="sd">                * &quot;emd&quot; (default): Empirical mode decomposition. The last mode is assumed to be the trend and removed from the series</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Relevant arguments for each of the methods.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : pyleoclim.MultipleSeries</span>
<span class="sd">            The detrended timeseries</span>
<span class="sd">            </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.core.ui.Series.detrend : Detrending for a single series</span>
<span class="sd">        pyleoclim.utils.tsutils.detrend : Detrending function</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">series_list</span><span class="p">):</span>
            <span class="n">s</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">v_mod</span><span class="o">=</span><span class="n">tsutils</span><span class="o">.</span><span class="n">detrend</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">s</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="n">v_mod</span>
            <span class="n">new</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="n">s</span>
        <span class="k">return</span> <span class="n">new</span>

    <span class="k">def</span> <span class="nf">spectral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;wwz&#39;</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="p">{},</span> <span class="n">mute_pbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">freq_method</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">freq_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Perform spectral analysis on the timeseries</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        </span>
<span class="sd">        method : str</span>
<span class="sd">            {&#39;wwz&#39;, &#39;mtm&#39;, &#39;lomb_scargle&#39;, &#39;welch&#39;, &#39;periodogram&#39;}</span>

<span class="sd">        freq_method : str</span>
<span class="sd">            {&#39;log&#39;,&#39;scale&#39;, &#39;nfft&#39;, &#39;lomb_scargle&#39;, &#39;welch&#39;}</span>
<span class="sd">        </span>
<span class="sd">        freq_kwargs : dict</span>
<span class="sd">            Arguments for frequency vector</span>
<span class="sd">        </span>
<span class="sd">        settings : dict</span>
<span class="sd">            Arguments for the specific spectral method</span>
<span class="sd">        </span>
<span class="sd">        mute_pbar : {True, False}</span>
<span class="sd">            Mute the progress bar. Default is False. </span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        </span>
<span class="sd">        psd : pyleoclim.MultiplePSD</span>
<span class="sd">            A Multiple PSD object</span>
<span class="sd">            </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pyleoclim.utils.spectral.mtm : Spectral analysis using the Multitaper approach</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.spectral.lomb_scargle : Spectral analysis using the Lomb-Scargle method</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.spectral.welch: Spectral analysis using the Welch segement approach</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.spectral.periodogram: Spectral anaysis using the basic Fourier transform</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.spectral.wwz_psd : Spectral analysis using the Wavelet Weighted Z transform</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.wavelet.make_freq : Functions to create the frequency vector</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.tsutils.detrend : Detrending function</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.core.ui.Series.spectral : Spectral analysis for a single timeseries</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.core.ui.PSD : PSD object</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.core.ui.MultiplePSD : Multiple PSD object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;wwz&#39;</span><span class="p">,</span> <span class="s1">&#39;lomb_scargle&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;freq&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">res</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">):</span>
                <span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="n">res</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
            <span class="n">ts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>
            <span class="n">freq_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">freq_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">freq_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">freq</span><span class="o">=</span><span class="n">waveutils</span><span class="o">.</span><span class="n">make_freq_vector</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">freq_method</span><span class="o">=</span><span class="n">freq_method</span><span class="p">,</span> <span class="o">**</span><span class="n">freq_kwargs</span><span class="p">)</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;freq&#39;</span><span class="p">:</span><span class="n">freq</span><span class="p">})</span>
        <span class="n">psd_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Performing spectral analysis on surrogates&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="n">mute_pbar</span><span class="p">):</span>
            <span class="n">psd_tmp</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">spectral</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>
            <span class="n">psd_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">psd_tmp</span><span class="p">)</span>

        <span class="n">psds</span> <span class="o">=</span> <span class="n">MultiplePSD</span><span class="p">(</span><span class="n">psd_list</span><span class="o">=</span><span class="n">psd_list</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">psds</span>

    <span class="k">def</span> <span class="nf">wavelet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;wwz&#39;</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="p">{},</span> <span class="n">mute_pbar</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Wavelet analysis        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        method : {&#39;wwz&#39;}, optional</span>
<span class="sd">            Method for the wavelet analysis. The default is &#39;wwz&#39;.</span>
<span class="sd">        settings : dict, optional</span>
<span class="sd">            Settings for the particular method. The default is {}.</span>
<span class="sd">        mute_pbar : bool, optional</span>
<span class="sd">            Whether to mute the progress bar. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        scals : pyleoclim.MultipleScalograms</span>
<span class="sd">        </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pyleoclim.utils.wavelet.wwz : wwz function</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.wavelet.make_freq : Functions to create the frequency vector</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.utils.tsutils.detrend : Detrending function</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.core.ui.Series.wavelet : wavelet analysis on single object</span>
<span class="sd">        </span>
<span class="sd">        pyleoclim.core.ui.MultipleScalogram : Multiple Scalogram object</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">scal_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Performing wavelet analysis on surrogates&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="n">mute_pbar</span><span class="p">):</span>
            <span class="n">scal_tmp</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">wavelet</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>
            <span class="n">scal_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scal_tmp</span><span class="p">)</span>

        <span class="n">scals</span> <span class="o">=</span> <span class="n">MultipleScalogram</span><span class="p">(</span><span class="n">scalogram_list</span><span class="o">=</span><span class="n">scal_list</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">scals</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
             <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">linestyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lgd_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Plot multiple timeseries on the same axis</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        figsize : list, optional</span>
<span class="sd">            Size of the figure. The default is [10, 4].</span>
<span class="sd">        marker : str, optional</span>
<span class="sd">            marker type. The default is None.</span>
<span class="sd">        markersize : float, optional</span>
<span class="sd">            marker size. The default is None.</span>
<span class="sd">        color : str, optional</span>
<span class="sd">            color. The default is None.</span>
<span class="sd">        linestyle : str, optional</span>
<span class="sd">            Line style. The default is None.</span>
<span class="sd">        linewidth : float, optional</span>
<span class="sd">            The width of the line. The default is None.</span>
<span class="sd">        label : str, optional</span>
<span class="sd">            Label for the series. The default is None.</span>
<span class="sd">        xlabel : str, optional</span>
<span class="sd">            x-axis label. The default is None.</span>
<span class="sd">        ylabel : str, optional</span>
<span class="sd">            y-axis label. The default is None.</span>
<span class="sd">        title : str, optional</span>
<span class="sd">            Title. The default is None.</span>
<span class="sd">        legend : bool, optional</span>
<span class="sd">            Wether the show the legend. The default is True.</span>
<span class="sd">        plot_kwargs : dict, optional</span>
<span class="sd">            Plot parameters. The default is None.</span>
<span class="sd">        lgd_kwargs : dict, optional</span>
<span class="sd">            Legend parameters. The default is None.</span>
<span class="sd">        savefig_settings : TYPE, optional</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">            - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">              with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">            - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;} The default is None.</span>
<span class="sd">        ax : matplotlib.ax, optional</span>
<span class="sd">            The matplotlib axis onto which to return the figure. The default is None.</span>
<span class="sd">        mute : bool, optional</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig, ax</span>
<span class="sd">            </span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">savefig_settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">savefig_settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">savefig_settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">plot_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">plot_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">lgd_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">lgd_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">lgd_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="n">plot_kwargs</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;fig&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">savefig_settings</span><span class="p">:</span>
                <span class="n">plotting</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mute</span><span class="p">:</span>
                    <span class="n">plotting</span><span class="o">.</span><span class="n">showfig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ax</span></div>

    <span class="c1"># def stackplot(self, figsize=None, xlabel=None, ylabel=None, </span>
    <span class="c1">#           xlim=None, ylim=None, title=None,</span>
    <span class="c1">#           savefig_settings=None, ax=None, style=None, </span>
    <span class="c1">#           plot_kwargs=None, mute=False,color=None):</span>
    <span class="c1">#     x = []</span>
    <span class="c1">#     y = []</span>
    <span class="c1">#     for s in self.series_list:</span>
    <span class="c1">#         x.append(s.time)</span>
    <span class="c1">#         y.append(s.value)</span>
    <span class="c1">#     color = pl.cm.jet(np.linspace(0.3, 1, len(x)))</span>
    <span class="c1">#     fig,ax = plotting.stackplot(x,y,figsize=figsize,color=color,xlabel=xlabel,</span>
    <span class="c1">#                                 ylabel=ylabel,title=title,plot_kwargs=plot_kwargs,</span>
    <span class="c1">#                                 savefig_settings=savefig_settings,ax=ax,mute=mute)</span>
    <span class="c1">#     return fig,ax</span>

<div class="viewcode-block" id="SurrogateSeries"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.SurrogateSeries">[docs]</a><span class="k">class</span> <span class="nc">SurrogateSeries</span><span class="p">(</span><span class="n">MultipleSeries</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Object containing surrogate timeseries</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">series_list</span><span class="p">,</span> <span class="n">surrogate_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">surrogate_args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">series_list</span> <span class="o">=</span> <span class="n">series_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surrogate_method</span> <span class="o">=</span> <span class="n">surrogate_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surrogate_args</span> <span class="o">=</span> <span class="n">surrogate_args</span></div>

<div class="viewcode-block" id="MultiplePSD"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultiplePSD">[docs]</a><span class="k">class</span> <span class="nc">MultiplePSD</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39; Object for multiple PSD.</span>
<span class="sd">    </span>
<span class="sd">    Used for significance level</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psd_list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psd_list</span> <span class="o">=</span> <span class="n">psd_list</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Copy object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">quantiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qs</span><span class="o">=</span><span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]):</span>
        <span class="sd">&#39;&#39;&#39;Calculate quantiles</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        qs : list, optional</span>
<span class="sd">            List of quantiles to consider for the calculation. The default is [0.05, 0.5, 0.95].</span>
<span class="sd">        lw : list, optional</span>
<span class="sd">            Linewidth to use for plotting each level. Should be the same length as qs. The default is [0.5, 1.5, 0.5].</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Frequency axis not consistent across the PSD list!</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        psds : pyleoclim.MultiplePSD</span>
<span class="sd">            </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">timeseries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">period_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">time_unit</span>

        <span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
        <span class="n">amps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">psd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">psd</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">freq</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Frequency axis not consistent across the PSD list!&#39;</span><span class="p">)</span>

            <span class="n">amps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">psd</span><span class="o">.</span><span class="n">amplitude</span><span class="p">)</span>

        <span class="n">amps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">amps</span><span class="p">)</span>
        <span class="n">amp_qs</span> <span class="o">=</span> <span class="n">mquantiles</span><span class="p">(</span><span class="n">amps</span><span class="p">,</span> <span class="n">qs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">psd_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">amp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">amp_qs</span><span class="p">):</span>
            <span class="n">psd_tmp</span> <span class="o">=</span> <span class="n">PSD</span><span class="p">(</span><span class="n">frequency</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s1">g</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="s1">&#39;lw&#39;</span><span class="p">:</span> <span class="n">lw</span><span class="p">[</span><span class="n">i</span><span class="p">]},</span> <span class="n">period_unit</span><span class="o">=</span><span class="n">period_unit</span><span class="p">)</span>
            <span class="n">psd_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">psd_tmp</span><span class="p">)</span>

        <span class="n">psds</span> <span class="o">=</span> <span class="n">MultiplePSD</span><span class="p">(</span><span class="n">psd_list</span><span class="o">=</span><span class="n">psd_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">psds</span>

    <span class="k">def</span> <span class="nf">beta_est</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Estimate the scaling factor beta of the each PSD from the psd_list in a log-log space</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fmin : float</span>
<span class="sd">            the minimum frequency edge for beta estimation; the default is the minimum of the frequency vector of the PSD obj</span>

<span class="sd">        fmax : float</span>
<span class="sd">            the maximum frequency edge for beta estimation; the default is the maximum of the frequency vector of the PSD obj</span>

<span class="sd">        verbose : bool</span>
<span class="sd">            if True, will print out debug information</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        res_dict : dictionary</span>
<span class="sd">            - beta: list of the scaling factors</span>
<span class="sd">            - std_err: list of one standard deviation errors of the scaling factor</span>
<span class="sd">            - f_binned: list of the binned frequency series, used as X for linear regression</span>
<span class="sd">            - psd_binned: list of the binned PSD series, used as Y for linear regression</span>
<span class="sd">            - Y_reg: list of the predicted Y from linear regression, used with f_binned for the slope curve plotting</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.core.ui.PSD.beta_est : beta estimation for on a single PSD object</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">res_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">res_dict</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">res_dict</span><span class="p">[</span><span class="s1">&#39;std_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">res_dict</span><span class="p">[</span><span class="s1">&#39;f_binned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">res_dict</span><span class="p">[</span><span class="s1">&#39;psd_binned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">res_dict</span><span class="p">[</span><span class="s1">&#39;Y_reg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">psd_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd_list</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">psd_obj</span><span class="o">.</span><span class="n">beta_est</span><span class="p">(</span><span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">res_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">res_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">res_dict</span>


    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">in_loglog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">in_period</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">plot_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lgd_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Plot multiple PSD on the same plot</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        figsize : list, optional</span>
<span class="sd">            Figure size. The default is [10, 4].</span>
<span class="sd">        in_loglog : bool, optional</span>
<span class="sd">            Whether to plot in loglog. The default is True.</span>
<span class="sd">        in_period : bool, optional</span>
<span class="sd">            Plots against periods instead of frequencies. The default is True.</span>
<span class="sd">        xlabel : str, optional</span>
<span class="sd">            x-axis label. The default is None.</span>
<span class="sd">        ylabel : str, optional</span>
<span class="sd">            y-axis label. The default is &#39;Amplitude&#39;.</span>
<span class="sd">        title : str, optional</span>
<span class="sd">            Title for the figure. The default is None.</span>
<span class="sd">        xlim : list, optional</span>
<span class="sd">            Limits for the x-axis. The default is None.</span>
<span class="sd">        ylim : list, optional</span>
<span class="sd">            limits for the y-axis. The default is None.</span>
<span class="sd">        savefig_settings : dict, optional</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">            - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">              with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">            - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;}</span>
<span class="sd">        ax : matplotlib axis, optional</span>
<span class="sd">            The matplotlib axis object on which to retrun the figure. The default is None.</span>
<span class="sd">        xticks : list, optional</span>
<span class="sd">            x-ticks label. The default is None.</span>
<span class="sd">        yticks : list, optional</span>
<span class="sd">            y-ticks label. The default is None.</span>
<span class="sd">        plot_legend : bool, optional</span>
<span class="sd">            Whether to plot the legend. The default is True.</span>
<span class="sd">        plot_kwargs : TYPE, optional</span>
<span class="sd">            Parameters for plot function. The default is None.</span>
<span class="sd">        lgd_kwargs : TYPE, optional</span>
<span class="sd">            Parameters for legend. The default is None.</span>
<span class="sd">        mute : bool, optional</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax</span>
<span class="sd">            The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig,ax</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">savefig_settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">savefig_settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">savefig_settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">plot_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">plot_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">lgd_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">lgd_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">lgd_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">psd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd_list</span><span class="p">:</span>
            <span class="n">tmp_plot_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">psd</span><span class="o">.</span><span class="n">plot_kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tmp_plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">psd</span><span class="o">.</span><span class="n">plot_kwargs</span><span class="p">)</span>
            <span class="n">tmp_plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">plot_kwargs</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">psd</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">in_loglog</span><span class="o">=</span><span class="n">in_loglog</span><span class="p">,</span> <span class="n">in_period</span><span class="o">=</span><span class="n">in_period</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">plot_legend</span><span class="o">=</span><span class="n">plot_legend</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="n">tmp_plot_kwargs</span><span class="p">,</span> <span class="n">lgd_kwargs</span><span class="o">=</span><span class="n">lgd_kwargs</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;fig&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">savefig_settings</span><span class="p">:</span>
                <span class="n">plotting</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mute</span><span class="p">:</span>
                    <span class="n">plotting</span><span class="o">.</span><span class="n">showfig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">plot_envelope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">qs</span><span class="o">=</span><span class="p">[</span><span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.975</span><span class="p">],</span>
             <span class="n">in_loglog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">in_period</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">curve_clr</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s1">&#39;pale red&#39;</span><span class="p">],</span> <span class="n">curve_lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">shade_clr</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s1">&#39;pale red&#39;</span><span class="p">],</span> <span class="n">shade_alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">shade_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">lgd_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">members_plot_num</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">members_alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">members_lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Plot mutiple PSD as an envelope.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        figsize : list, optional</span>
<span class="sd">            The figure size. The default is [10, 4].</span>
<span class="sd">        qs : list, optional</span>
<span class="sd">            The significance levels to consider. The default is [0.025, 0.5, 0.975].</span>
<span class="sd">        in_loglog : bool, optional</span>
<span class="sd">            Plot in log space. The default is True.</span>
<span class="sd">        in_period : TYPE, optional</span>
<span class="sd">            Whether to plot periodicity instead of frequency. The default is True.</span>
<span class="sd">        xlabel : str, optional</span>
<span class="sd">            x-axis label. The default is None.</span>
<span class="sd">        ylabel : str, optional</span>
<span class="sd">            y-axis label. The default is &#39;Amplitude&#39;.</span>
<span class="sd">        title : str, optional</span>
<span class="sd">            Plot title. The default is None.</span>
<span class="sd">        xlim : list, optional</span>
<span class="sd">            x-axis limits. The default is None.</span>
<span class="sd">        ylim : list, optional</span>
<span class="sd">            y-axis limits. The default is None.</span>
<span class="sd">        savefig_settings : dict, optional</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">            - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">              with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">            - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;} The default is None.</span>
<span class="sd">        ax : matplotlib.ax, optional</span>
<span class="sd">            Matplotlib axis on which to return the plot. The default is None.</span>
<span class="sd">        xticks : list, optional</span>
<span class="sd">            xticks label. The default is None.</span>
<span class="sd">        yticks : list, optional</span>
<span class="sd">            yticks label. The default is None.</span>
<span class="sd">        plot_legend : bool, optional</span>
<span class="sd">            Wether to plot the legend. The default is True.</span>
<span class="sd">        curve_clr : str, optional</span>
<span class="sd">            Color of the main PSD. The default is sns.xkcd_rgb[&#39;pale red&#39;].</span>
<span class="sd">        curve_lw : str, optional</span>
<span class="sd">            Width of the main PSD line. The default is 3.</span>
<span class="sd">        shade_clr : str, optional</span>
<span class="sd">            Color of the shaded envelope. The default is sns.xkcd_rgb[&#39;pale red&#39;].</span>
<span class="sd">        shade_alpha : float, optional</span>
<span class="sd">            Transparency on the envelope. The default is 0.3.</span>
<span class="sd">        shade_label : str, optional</span>
<span class="sd">            Label for the envelope. The default is None.</span>
<span class="sd">        lgd_kwargs : dict, optional</span>
<span class="sd">            Parameters for the legend. The default is None.</span>
<span class="sd">        mute : bool, optional</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax. The default is False.</span>
<span class="sd">        members_plot_num : int, optional</span>
<span class="sd">            Number of individual members to plot. The default is 10.</span>
<span class="sd">        members_alpha : float, optional</span>
<span class="sd">            Transparency of the lines representing the multiple members. The default is 0.3.</span>
<span class="sd">        members_lw : float, optional</span>
<span class="sd">            With of the lines representing the multiple members. The default is 1.</span>
<span class="sd">        seed : int, optional</span>
<span class="sd">            Set the seed for random number generator. Useful for reproducibility. The default is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig, ax</span>

<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">savefig_settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">savefig_settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">savefig_settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">lgd_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">lgd_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">lgd_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">members_plot_num</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

            <span class="n">npsd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psd_list</span><span class="p">)</span>
            <span class="n">random_draw_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">npsd</span><span class="p">,</span> <span class="n">members_plot_num</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">random_draw_idx</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">psd_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">in_loglog</span><span class="o">=</span><span class="n">in_loglog</span><span class="p">,</span> <span class="n">in_period</span><span class="o">=</span><span class="n">in_period</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
                    <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">members_alpha</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="mi">99</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">members_lw</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;example members (n=</span><span class="si">{</span><span class="n">members_plot_num</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

        <span class="n">psd_qs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantiles</span><span class="p">(</span><span class="n">qs</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>
        <span class="n">psd_qs</span><span class="o">.</span><span class="n">psd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">in_loglog</span><span class="o">=</span><span class="n">in_loglog</span><span class="p">,</span> <span class="n">in_period</span><span class="o">=</span><span class="n">in_period</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">curve_lw</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">curve_clr</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span>
        <span class="p">)</span>


        <span class="k">if</span> <span class="n">in_period</span><span class="p">:</span>
            <span class="n">x_axis</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">psd_qs</span><span class="o">.</span><span class="n">psd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">frequency</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_axis</span> <span class="o">=</span> <span class="n">psd_qs</span><span class="o">.</span><span class="n">psd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">frequency</span>

        <span class="k">if</span> <span class="n">shade_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">shade_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">psd_qs</span><span class="o">.</span><span class="n">psd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">psd_qs</span><span class="o">.</span><span class="n">psd_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
            <span class="n">x_axis</span><span class="p">,</span> <span class="n">psd_qs</span><span class="o">.</span><span class="n">psd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">amplitude</span><span class="p">,</span> <span class="n">psd_qs</span><span class="o">.</span><span class="n">psd_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">amplitude</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">shade_clr</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">shade_alpha</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">shade_clr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">shade_label</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot_legend</span><span class="p">:</span>
            <span class="n">lgd_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;frameon&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
            <span class="n">lgd_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lgd_kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">lgd_args</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;fig&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">savefig_settings</span><span class="p">:</span>
                <span class="n">plotting</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mute</span><span class="p">:</span>
                    <span class="n">plotting</span><span class="o">.</span><span class="n">showfig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="MultipleScalogram"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultipleScalogram">[docs]</a><span class="k">class</span> <span class="nc">MultipleScalogram</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39; Multiple Scalogram objects</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scalogram_list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scalogram_list</span> <span class="o">=</span> <span class="n">scalogram_list</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Copy the object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">quantiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qs</span><span class="o">=</span><span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">]):</span>
        <span class="sd">&#39;&#39;&#39;Calculate quantiles</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        qs : list, optional</span>
<span class="sd">            List of quantiles to consider for the calculation. The default is [0.05, 0.5, 0.95].</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Frequency axis not consistent across the PSD list!</span>
<span class="sd">            </span>
<span class="sd">        Value Error</span>
<span class="sd">            Time axis not consistent across the scalogram list!</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        scals : pyleoclim.MultipleScalogram</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scalogram_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scalogram_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="n">coi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scalogram_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coi</span><span class="p">)</span>
        <span class="n">amps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">scal</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scalogram_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">scal</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">freq</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Frequency axis not consistent across the scalogram list!&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">scal</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Time axis not consistent across the scalogram list!&#39;</span><span class="p">)</span>

            <span class="n">amps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scal</span><span class="o">.</span><span class="n">amplitude</span><span class="p">)</span>

        <span class="n">amps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">amps</span><span class="p">)</span>
        <span class="n">ne</span><span class="p">,</span> <span class="n">nf</span><span class="p">,</span> <span class="n">nt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">amps</span><span class="p">)</span>
        <span class="n">amp_qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">qs</span><span class="p">),</span> <span class="n">nf</span><span class="p">,</span> <span class="n">nt</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nf</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">):</span>
                <span class="n">amp_qs</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">mquantiles</span><span class="p">(</span><span class="n">amps</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">qs</span><span class="p">)</span>

        <span class="n">scal_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">amp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">amp_qs</span><span class="p">):</span>
            <span class="n">scal_tmp</span> <span class="o">=</span> <span class="n">Scalogram</span><span class="p">(</span><span class="n">frequency</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">coi</span><span class="o">=</span><span class="n">coi</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s1">g</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
            <span class="n">scal_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scal_tmp</span><span class="p">)</span>

        <span class="n">scals</span> <span class="o">=</span> <span class="n">MultipleScalogram</span><span class="p">(</span><span class="n">scalogram_list</span><span class="o">=</span><span class="n">scal_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scals</span></div>


<div class="viewcode-block" id="Lipd"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Lipd">[docs]</a><span class="k">class</span> <span class="nc">Lipd</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Create a Lipd object from Lipd Files</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    </span>
<span class="sd">    usr_path : str</span>
<span class="sd">        path to the Lipd file(s). Can be URL (LiPD utilities only support loading one file at a time from a URL)</span>
<span class="sd">    </span>
<span class="sd">    lidp_dict : dict</span>
<span class="sd">        LiPD files already loaded into Python through the LiPD utilities</span>
<span class="sd">    </span>
<span class="sd">    TODO</span>
<span class="sd">    ----</span>
<span class="sd">    </span>
<span class="sd">    Support querying the LinkedEarth platform</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    </span>
<span class="sd">    .. ipython:: python</span>
<span class="sd">        :okwarning:</span>
<span class="sd">        </span>
<span class="sd">        import pyleoclim as pyleo</span>
<span class="sd">        import lipd as lpd</span>
<span class="sd">        d1=lpd.readLipd(&#39;http://wiki.linked.earth/wiki/index.php/Special:WTLiPD?op=export&amp;lipdid=MD982176.Stott.2004&#39;)</span>
<span class="sd">        d=pyleo.Lipd(lipd_dict=d1)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">query_args</span><span class="o">=</span><span class="p">{},</span> <span class="n">usr_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lipd_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_default</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ice/rock&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#FFD600&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">],</span>
                <span class="s1">&#39;coral&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#FF8B00&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">],</span>
                <span class="s1">&#39;documents&#39;</span><span class="p">:[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">],</span>
                <span class="s1">&#39;glacier ice&#39;</span><span class="p">:[</span><span class="s1">&#39;#86CDFA&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span>
                <span class="s1">&#39;hybrid&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#00BEFF&#39;</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">],</span>
                <span class="s1">&#39;lake sediment&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#4169E0&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">],</span>
                <span class="s1">&#39;marine sediment&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#8A4513&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">],</span>
                <span class="s1">&#39;sclerosponge&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">],</span>
                <span class="s1">&#39;speleothem&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#FF1492&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">],</span>
                <span class="s1">&#39;wood&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#32CC32&#39;</span><span class="p">,</span><span class="s1">&#39;^&#39;</span><span class="p">],</span>
                <span class="s1">&#39;mollusk shells&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#FFD600&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">],</span>
                <span class="s1">&#39;peat&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#2F4F4F&#39;</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">],</span>
                <span class="s1">&#39;other&#39;</span><span class="p">:[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">]}</span>

        <span class="c1">#check that query has matching terms</span>
        <span class="k">if</span> <span class="n">query</span><span class="o">==</span><span class="kc">True</span> <span class="ow">and</span> <span class="nb">bool</span><span class="p">(</span><span class="n">query_args</span><span class="p">)</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;When query is set to true, you must define query terms&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">query</span><span class="o">==</span><span class="kc">False</span> <span class="ow">and</span> <span class="n">usr_path</span><span class="o">==</span><span class="kc">None</span> <span class="ow">and</span> <span class="n">lipd_dict</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">usr_path</span><span class="o">==</span><span class="s1">&#39;&#39;</span>

        <span class="c1">#deal with the query dictionary</span>
        <span class="k">if</span> <span class="n">query</span><span class="o">==</span><span class="kc">True</span> <span class="ow">and</span> <span class="nb">bool</span><span class="p">(</span><span class="n">query_args</span><span class="p">)</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;archiveType&#39;</span> <span class="ow">in</span> <span class="n">query_args</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">archiveType</span><span class="o">=</span><span class="n">query_args</span><span class="p">[</span><span class="s1">&#39;archiveType&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">archiveType</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="n">archiveType</span><span class="o">=</span><span class="n">lipdutils</span><span class="o">.</span><span class="n">pre_process_str</span><span class="p">(</span><span class="n">archiveType</span><span class="p">)</span>
                    <span class="n">archiveType</span><span class="o">=</span><span class="p">[</span><span class="n">archiveType</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">archiveType</span><span class="o">=</span><span class="n">lipdutils</span><span class="o">.</span><span class="n">pre_process_list</span><span class="p">(</span><span class="n">archiveType</span><span class="p">)</span>
                <span class="n">availableType</span><span class="o">=</span><span class="n">lipdutils</span><span class="o">.</span><span class="n">whatArchives</span><span class="p">(</span><span class="n">print_response</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">availableTypeP</span><span class="o">=</span><span class="n">lipdutils</span><span class="o">.</span><span class="n">pre_process_list</span><span class="p">(</span><span class="n">availableType</span><span class="p">)</span>
                <span class="n">res</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">archiveType</span><span class="p">:</span>
                    <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">availableTypeP</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">item</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">availableType</span><span class="p">)[</span><span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">res</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">res</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">archiveType</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">archiveType</span><span class="o">=</span><span class="n">res</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">archiveType</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>

            <span class="k">if</span> <span class="s1">&#39;proxyObsType&#39;</span> <span class="ow">in</span> <span class="n">query_args</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">proxyObsType</span><span class="o">=</span><span class="n">query_args</span><span class="p">[</span><span class="s1">&#39;proxyObsType&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">proxyObsType</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="n">proxyObsType</span><span class="o">=</span><span class="n">lipdutils</span><span class="o">.</span><span class="n">pre_process_str</span><span class="p">(</span><span class="n">proxyObsType</span><span class="p">)</span>
                    <span class="n">proxyObsType</span><span class="o">=</span><span class="p">[</span><span class="n">proxyObsType</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">proxyObsType</span><span class="o">=</span><span class="n">lipdutils</span><span class="o">.</span><span class="n">pre_process_list</span><span class="p">(</span><span class="n">proxyObsType</span><span class="p">)</span>
                <span class="n">availableProxy</span><span class="o">=</span><span class="n">lipdutils</span><span class="o">.</span><span class="n">whatProxyObservations</span><span class="p">(</span><span class="n">print_response</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">availableProxyP</span><span class="o">=</span><span class="n">lipdutils</span><span class="o">.</span><span class="n">pre_process_list</span><span class="p">(</span><span class="n">availableProxy</span><span class="p">)</span>
                <span class="n">res</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">proxyObsType</span><span class="p">:</span>
                    <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">availableProxyP</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">item</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">availableProxy</span><span class="p">)[</span><span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">res</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">res</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">proxyObsType</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">proxyObsType</span><span class="o">=</span><span class="n">res</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">proxyObsType</span><span class="o">=</span><span class="p">[</span> <span class="p">]</span>

            <span class="k">if</span> <span class="s1">&#39;infVarType&#39;</span> <span class="ow">in</span> <span class="n">query_args</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">infVarType</span><span class="o">=</span><span class="n">query_args</span><span class="p">[</span><span class="s1">&#39;infVarType&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">infVarType</span><span class="o">=</span><span class="p">[</span> <span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;sensorGenus&#39;</span> <span class="ow">in</span> <span class="n">query_args</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">sensorGenus</span> <span class="o">=</span> <span class="n">query_args</span><span class="p">[</span><span class="s1">&#39;sensorGenus&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sensorGenus</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;sensorSpecies&#39;</span> <span class="ow">in</span> <span class="n">query_args</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">sensorSpecies</span> <span class="o">=</span> <span class="n">query_args</span><span class="p">[</span><span class="s1">&#39;sensorSpecies&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sensorSpecies</span><span class="o">=</span><span class="p">[</span> <span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;interpName&#39;</span> <span class="ow">in</span> <span class="n">query_args</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">interpName</span> <span class="o">=</span> <span class="n">query_args</span><span class="p">[</span><span class="s1">&#39;interpName&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">interpName</span><span class="o">=</span><span class="p">[</span> <span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;interpDetail&#39;</span> <span class="ow">in</span> <span class="n">query_args</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">interpDetail</span> <span class="o">=</span> <span class="n">query_args</span><span class="p">[</span><span class="s1">&#39;interpDetail&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">interpDetail</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;ageUnits&#39;</span> <span class="ow">in</span> <span class="n">query_args</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">ageUnits</span> <span class="o">=</span> <span class="n">query_args</span><span class="p">[</span><span class="s1">&#39;ageUnits&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ageUnits</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;ageBound&#39;</span> <span class="ow">in</span> <span class="n">query_args</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">ageBound</span> <span class="o">=</span> <span class="n">query_args</span><span class="p">[</span><span class="s1">&#39;ageBound&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ageBound</span><span class="o">=</span><span class="p">[</span> <span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;ageBoundType&#39;</span> <span class="ow">in</span> <span class="n">query_args</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">ageBoundType</span> <span class="o">=</span> <span class="n">query_args</span><span class="p">[</span><span class="s1">&#39;ageBoundType&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ageBoundType</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;recordLength&#39;</span> <span class="ow">in</span> <span class="n">query_args</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">recordLength</span> <span class="o">=</span> <span class="n">query_args</span><span class="p">[</span><span class="s1">&#39;recordLength&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">recordLength</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;resolution&#39;</span> <span class="ow">in</span> <span class="n">query_args</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">resolution</span> <span class="o">=</span> <span class="n">query_args</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">resolution</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;lat&#39;</span> <span class="ow">in</span> <span class="n">query_args</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">lat</span> <span class="o">=</span> <span class="n">query_args</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lat</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;lon&#39;</span> <span class="ow">in</span> <span class="n">query_args</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">lon</span> <span class="o">=</span> <span class="n">query_args</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lon</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;alt&#39;</span> <span class="ow">in</span> <span class="n">query_args</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">alt</span> <span class="o">=</span> <span class="n">query_args</span><span class="p">[</span><span class="s1">&#39;alt&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">alt</span><span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;download_folder&#39;</span> <span class="ow">in</span> <span class="n">query_args</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">download_folder</span> <span class="o">=</span> <span class="n">query_args</span><span class="p">[</span><span class="s1">&#39;download_folder&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">download_folder</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>

            <span class="n">lipdutils</span><span class="o">.</span><span class="n">queryLinkedEarth</span><span class="p">(</span><span class="n">archiveType</span><span class="o">=</span><span class="n">archiveType</span><span class="p">,</span> <span class="n">proxyObsType</span><span class="o">=</span><span class="n">proxyObsType</span><span class="p">,</span> <span class="n">infVarType</span> <span class="o">=</span> <span class="n">infVarType</span><span class="p">,</span> <span class="n">sensorGenus</span><span class="o">=</span><span class="n">sensorGenus</span><span class="p">,</span>
                    <span class="n">sensorSpecies</span><span class="o">=</span><span class="n">sensorSpecies</span><span class="p">,</span> <span class="n">interpName</span> <span class="o">=</span><span class="n">interpName</span><span class="p">,</span> <span class="n">interpDetail</span> <span class="o">=</span><span class="n">interpDetail</span><span class="p">,</span> <span class="n">ageUnits</span> <span class="o">=</span> <span class="n">ageUnits</span><span class="p">,</span>
                    <span class="n">ageBound</span> <span class="o">=</span> <span class="n">ageBound</span><span class="p">,</span> <span class="n">ageBoundType</span> <span class="o">=</span> <span class="n">ageBoundType</span><span class="p">,</span> <span class="n">recordLength</span> <span class="o">=</span> <span class="n">recordLength</span><span class="p">,</span> <span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span><span class="p">,</span>
                    <span class="n">lat</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span><span class="p">,</span> <span class="n">alt</span> <span class="o">=</span> <span class="n">alt</span><span class="p">,</span> <span class="n">print_response</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">download_lipd</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="n">download_folder</span> <span class="o">=</span> <span class="n">download_folder</span><span class="p">)</span>

            <span class="n">D_query</span> <span class="o">=</span> <span class="n">lpd</span><span class="o">.</span><span class="n">readLipd</span><span class="p">(</span><span class="n">download_folder</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;archiveType&#39;</span> <span class="ow">in</span> <span class="n">D_query</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">D_query</span><span class="o">=</span><span class="p">{</span><span class="n">D_query</span><span class="p">[</span><span class="s1">&#39;dataSetName&#39;</span><span class="p">]:</span><span class="n">D_query</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">D_query</span><span class="o">=</span><span class="p">{}</span>
        <span class="c1">#prepare the dictionaries for all possible scenarios</span>
        <span class="k">if</span> <span class="n">usr_path</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
            <span class="c1"># since readLipd() takes only absolute path and it will change the current working directory (CWD) without turning back,</span>
            <span class="c1"># we need to record CWD manually and turn back after the data loading is finished</span>
            <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
            <span class="n">abs_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">usr_path</span><span class="p">)</span>
            <span class="n">D_path</span> <span class="o">=</span> <span class="n">lpd</span><span class="o">.</span><span class="n">readLipd</span><span class="p">(</span><span class="n">abs_path</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
            <span class="c1">#make sure that it&#39;s more than one</span>
            <span class="k">if</span> <span class="s1">&#39;archiveType&#39;</span> <span class="ow">in</span> <span class="n">D_path</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">D_path</span><span class="o">=</span><span class="p">{</span><span class="n">D_path</span><span class="p">[</span><span class="s1">&#39;dataSetName&#39;</span><span class="p">]:</span><span class="n">D_path</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">D_path</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">if</span> <span class="n">lipd_dict</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">D_dict</span><span class="o">=</span><span class="n">lipd_dict</span>
            <span class="k">if</span> <span class="s1">&#39;archiveType&#39;</span> <span class="ow">in</span> <span class="n">D_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">D_dict</span><span class="o">=</span><span class="p">{</span><span class="n">D_dict</span><span class="p">[</span><span class="s1">&#39;dataSetName&#39;</span><span class="p">]:</span><span class="n">D_dict</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">D_dict</span><span class="o">=</span><span class="p">{}</span>

        <span class="c1">#assemble</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lipd</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lipd</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">D_query</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lipd</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">D_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lipd</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">D_dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Copy the object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_tso</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ts_list : list</span>
<span class="sd">            List of Lipd timeseries objects</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ts_list</span><span class="o">=</span><span class="n">lpd</span><span class="o">.</span><span class="n">extractTs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;lipd&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">ts_list</span>

    <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dataSetName</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dataSetName : str</span>
<span class="sd">            Extract a particular dataset</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : pyleoclim.Lipd</span>
<span class="sd">            A new object corresponding to a particular dataset</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dict_out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;lipd&#39;</span><span class="p">][</span><span class="n">dataSetName</span><span class="p">]</span>
            <span class="n">new</span><span class="o">.</span><span class="n">lipd</span><span class="o">=</span><span class="n">dict_out</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">new</span>

    <span class="k">def</span> <span class="nf">mapAllArchive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">projection</span> <span class="o">=</span> <span class="s1">&#39;Robinson&#39;</span><span class="p">,</span> <span class="n">proj_default</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">background</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">borders</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">rivers</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lakes</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
           <span class="n">figsize</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">markersize</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">scatter_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lgd_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Map the records contained in LiPD files by archive type</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        projection : str, optional</span>
<span class="sd">            The projection to use. The default is &#39;Robinson&#39;.</span>
<span class="sd">        proj_default : bool, optional</span>
<span class="sd">            Wether to use the Pyleoclim defaults for each projection type. The default is True.</span>
<span class="sd">        background : bool, optional</span>
<span class="sd">            Wether to use a backgound. The default is True.</span>
<span class="sd">        borders : bool, optional</span>
<span class="sd">            Draw borders. The default is False.</span>
<span class="sd">        rivers : bool, optional</span>
<span class="sd">            Draw rivers. The default is False.</span>
<span class="sd">        lakes : bool, optional</span>
<span class="sd">            Draw lakes. The default is False.</span>
<span class="sd">        figsize : list, optional</span>
<span class="sd">            The size of the figure. The default is None.</span>
<span class="sd">        ax : matplotlib.ax, optional</span>
<span class="sd">            The matplotlib axis onto which to return the map. The default is None.</span>
<span class="sd">        marker : str, optional</span>
<span class="sd">            The marker type for each archive. The default is None. Uses plot_default</span>
<span class="sd">        color : str, optional</span>
<span class="sd">            Color for each acrhive. The default is None. Uses plot_default</span>
<span class="sd">        markersize : float, optional</span>
<span class="sd">            Size of the marker. The default is None.</span>
<span class="sd">        scatter_kwargs : dict, optional</span>
<span class="sd">            Parameters for the scatter plot. The default is None.</span>
<span class="sd">        legend : bool, optional</span>
<span class="sd">            Whether to plot the legend. The default is True.</span>
<span class="sd">        lgd_kwargs : dict, optional</span>
<span class="sd">            Arguments for the legend. The default is None.</span>
<span class="sd">        savefig_settings : TYPE, optional</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">            - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">              with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">            - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;}. The default is None.</span>
<span class="sd">        mute : bool, optional</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        res : figure</span>
<span class="sd">            The figure</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#get the information from the LiPD dict</span>
        <span class="n">lat</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">lon</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">archiveType</span><span class="o">=</span><span class="p">[]</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">lat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;geo&#39;</span><span class="p">][</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">lon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;geo&#39;</span><span class="p">][</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">archiveType</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lipdutils</span><span class="o">.</span><span class="n">LipdToOntology</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;archiveType&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

        <span class="c1"># make sure criteria is in the plot_default list</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">archiveType</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_default</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">archiveType</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>

        <span class="k">if</span> <span class="n">markersize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scatter_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;markersize&#39;</span><span class="p">:</span> <span class="n">markersize</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">marker</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">marker</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">archiveType</span><span class="p">:</span>
                <span class="n">marker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_default</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">color</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">color</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">archiveType</span><span class="p">:</span>
                <span class="n">color</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_default</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">map_all</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="n">lon</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">archiveType</span><span class="p">,</span>
                              <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span><span class="n">color</span><span class="p">,</span>
                              <span class="n">projection</span> <span class="o">=</span> <span class="n">projection</span><span class="p">,</span> <span class="n">proj_default</span> <span class="o">=</span> <span class="n">proj_default</span><span class="p">,</span>
                              <span class="n">background</span> <span class="o">=</span> <span class="n">background</span><span class="p">,</span><span class="n">borders</span> <span class="o">=</span> <span class="n">borders</span><span class="p">,</span>
                              <span class="n">rivers</span> <span class="o">=</span> <span class="n">rivers</span><span class="p">,</span> <span class="n">lakes</span> <span class="o">=</span> <span class="n">lakes</span><span class="p">,</span>
                              <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span>
                              <span class="n">scatter_kwargs</span><span class="o">=</span><span class="n">scatter_kwargs</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">,</span>
                              <span class="n">lgd_kwargs</span><span class="o">=</span><span class="n">lgd_kwargs</span><span class="p">,</span><span class="n">savefig_settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">,</span>
                              <span class="n">mute</span><span class="o">=</span><span class="n">mute</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">res</span></div>

    <span class="c1">#def mapNearRecord():</span>

        <span class="c1">#res={}</span>

        <span class="c1">#return res</span>

<div class="viewcode-block" id="LipdSeries"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.LipdSeries">[docs]</a><span class="k">class</span> <span class="nc">LipdSeries</span><span class="p">(</span><span class="n">Series</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Lipd time series object</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tso</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tso</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="o">=</span><span class="n">lipdutils</span><span class="o">.</span><span class="n">getTs</span><span class="p">(</span><span class="n">tso</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="o">=</span><span class="n">tso</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_default</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ice/rock&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#FFD600&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">],</span>
                <span class="s1">&#39;coral&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#FF8B00&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">],</span>
                <span class="s1">&#39;documents&#39;</span><span class="p">:[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">],</span>
                <span class="s1">&#39;glacier ice&#39;</span><span class="p">:[</span><span class="s1">&#39;#86CDFA&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span>
                <span class="s1">&#39;hybrid&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#00BEFF&#39;</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">],</span>
                <span class="s1">&#39;lake sediment&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#4169E0&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">],</span>
                <span class="s1">&#39;marine sediment&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#8A4513&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">],</span>
                <span class="s1">&#39;sclerosponge&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">],</span>
                <span class="s1">&#39;speleothem&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#FF1492&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">],</span>
                <span class="s1">&#39;wood&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#32CC32&#39;</span><span class="p">,</span><span class="s1">&#39;^&#39;</span><span class="p">],</span>
                <span class="s1">&#39;molluskshells&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#FFD600&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">],</span>
                <span class="s1">&#39;peat&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#2F4F4F&#39;</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">],</span>
                <span class="s1">&#39;other&#39;</span><span class="p">:[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">]}</span>

        <span class="n">time</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span> <span class="n">lipdutils</span><span class="o">.</span><span class="n">checkTimeAxis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">label</span><span class="o">==</span><span class="s1">&#39;age&#39;</span><span class="p">:</span>
            <span class="n">time_name</span><span class="o">=</span><span class="s1">&#39;Age&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;ageUnits&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;ageUnits&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">time_unit</span><span class="o">=</span><span class="kc">None</span>
        <span class="k">elif</span> <span class="n">label</span><span class="o">==</span><span class="s1">&#39;year&#39;</span><span class="p">:</span>
            <span class="n">time_name</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;yearUnits&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;yearUnits&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">time_unit</span><span class="o">=</span><span class="kc">None</span>

        <span class="n">value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;paleoData_values&#39;</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="c1">#Remove NaNs</span>
        <span class="n">ys_tmp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ys_tmp</span><span class="p">)]</span>
        <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ys_tmp</span><span class="p">)]</span>
        <span class="n">value_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;paleoData_variableName&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;paleoData_units&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">value_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;paleoData_units&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value_unit</span><span class="o">=</span><span class="kc">None</span>
        <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;dataSetName&#39;</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LipdSeries</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span><span class="n">time_name</span><span class="o">=</span><span class="n">time_name</span><span class="p">,</span>
             <span class="n">time_unit</span><span class="o">=</span><span class="n">time_unit</span><span class="p">,</span><span class="n">value_name</span><span class="o">=</span><span class="n">value_name</span><span class="p">,</span><span class="n">value_unit</span><span class="o">=</span><span class="n">value_unit</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Copy the object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">chronEnsembleToPaleo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">modelNumber</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tableNumber</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fetch chron ensembles from a lipd object and return the ensemble as MultipleSeries</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        D : a LiPD object</span>
<span class="sd">        modelNumber : int, optional</span>
<span class="sd">            Age model number. The default is None.</span>
<span class="sd">        tableNumber : int, optional</span>
<span class="sd">            Table Number. The default is None.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ms : pyleoclim.MultipleSeries</span>
<span class="sd">            A MultipleSeries object with each series representing a possible realization of the age model</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#get the corresponding LiPD</span>
        <span class="n">dataSetName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;dataSetName&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">D</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">lipd</span><span class="o">=</span><span class="n">D</span><span class="p">[</span><span class="n">dataSetName</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">lipd</span><span class="o">=</span><span class="n">D</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span><span class="o">=</span><span class="n">D</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">dataSetName</span><span class="p">)</span>
            <span class="n">lipd</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;lipd&#39;</span><span class="p">]</span>
        <span class="c1">#Look for the ensemble and get values</span>
        <span class="n">csv_dict</span><span class="o">=</span><span class="n">lpd</span><span class="o">.</span><span class="n">getCsv</span><span class="p">(</span><span class="n">lipd</span><span class="p">)</span>
        <span class="n">chron</span><span class="p">,</span><span class="n">paleo</span> <span class="o">=</span> <span class="n">lipdutils</span><span class="o">.</span><span class="n">isEnsemble</span><span class="p">(</span><span class="n">csv_dict</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chron</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No ChronMeasurementTables available&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">chron</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modelNumber</span><span class="o">==</span><span class="kc">None</span> <span class="ow">or</span> <span class="n">tableNumber</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
                <span class="n">csvName</span><span class="o">=</span><span class="n">lipdutils</span><span class="o">.</span><span class="n">whichEnsemble</span><span class="p">(</span><span class="n">chron</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">str1</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">modelNumber</span><span class="p">)</span>
                <span class="n">str2</span><span class="o">=</span><span class="s1">&#39;ensemble&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">tableNumber</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">chron</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">str1</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">str2</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                        <span class="n">csvName</span><span class="o">=</span><span class="n">item</span>
            <span class="n">depth</span><span class="p">,</span> <span class="n">ensembleValues</span> <span class="o">=</span><span class="n">lipdutils</span><span class="o">.</span><span class="n">getEnsemble</span><span class="p">(</span><span class="n">csv_dict</span><span class="p">,</span><span class="n">csvName</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">depth</span><span class="p">,</span> <span class="n">ensembleValues</span> <span class="o">=</span><span class="n">lipdutils</span><span class="o">.</span><span class="n">getEnsemble</span><span class="p">(</span><span class="n">csv_dict</span><span class="p">,</span><span class="n">chron</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1">#make sure it&#39;s sorted</span>
        <span class="n">sort_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span>
        <span class="n">depth</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">depth</span><span class="p">)[</span><span class="n">sort_ind</span><span class="p">])</span>
        <span class="n">ensembleValues</span><span class="o">=</span><span class="n">ensembleValues</span><span class="p">[</span><span class="n">sort_ind</span><span class="p">,:]</span>
        <span class="c1">#Map to paleovalues</span>
        <span class="n">key</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;depth&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="s1">&#39;Units&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">key</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ds</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="n">ys</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;paleoData_values&#39;</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="c1">#Remove NaNs</span>
        <span class="n">ys_tmp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span>
        <span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ys_tmp</span><span class="p">)]</span>
        <span class="n">ensembleValuestoPaleo</span><span class="o">=</span><span class="n">lipdutils</span><span class="o">.</span><span class="n">mapAgeEnsembleToPaleoData</span><span class="p">(</span><span class="n">ensembleValues</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">ds</span><span class="p">)</span>
        <span class="c1">#create multipleseries</span>
        <span class="n">s_list</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">ensembleValuestoPaleo</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
            <span class="n">s_tmp</span><span class="o">=</span><span class="n">Series</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">s</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">s_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_tmp</span><span class="p">)</span>

        <span class="n">ms</span> <span class="o">=</span> <span class="n">MultipleSeries</span><span class="p">(</span><span class="n">series_list</span><span class="o">=</span><span class="n">s_list</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ms</span>

    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">projection</span> <span class="o">=</span> <span class="s1">&#39;Orthographic&#39;</span><span class="p">,</span> <span class="n">proj_default</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">background</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">borders</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">rivers</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lakes</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
           <span class="n">figsize</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">markersize</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">scatter_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lgd_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Map the location of the record        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        projection : str, optional</span>
<span class="sd">            The projection to use. The default is &#39;Robinson&#39;.</span>
<span class="sd">        proj_default : bool, optional</span>
<span class="sd">            Wether to use the Pyleoclim defaults for each projection type. The default is True.</span>
<span class="sd">        background : bool, optional</span>
<span class="sd">            Wether to use a backgound. The default is True.</span>
<span class="sd">        borders : bool, optional</span>
<span class="sd">            Draw borders. The default is False.</span>
<span class="sd">        rivers : bool, optional</span>
<span class="sd">            Draw rivers. The default is False.</span>
<span class="sd">        lakes : bool, optional</span>
<span class="sd">            Draw lakes. The default is False.</span>
<span class="sd">        figsize : list, optional</span>
<span class="sd">            The size of the figure. The default is None.</span>
<span class="sd">        ax : matplotlib.ax, optional</span>
<span class="sd">            The matplotlib axis onto which to return the map. The default is None.</span>
<span class="sd">        marker : str, optional</span>
<span class="sd">            The marker type for each archive. The default is None. Uses plot_default</span>
<span class="sd">        color : str, optional</span>
<span class="sd">            Color for each acrhive. The default is None. Uses plot_default</span>
<span class="sd">        markersize : float, optional</span>
<span class="sd">            Size of the marker. The default is None.</span>
<span class="sd">        scatter_kwargs : dict, optional</span>
<span class="sd">            Parameters for the scatter plot. The default is None.</span>
<span class="sd">        legend : bool, optional</span>
<span class="sd">            Whether to plot the legend. The default is True.</span>
<span class="sd">        lgd_kwargs : dict, optional</span>
<span class="sd">            Arguments for the legend. The default is None.</span>
<span class="sd">        savefig_settings : TYPE, optional</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">            - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">              with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">            - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;}. The default is None.</span>
<span class="sd">        mute : bool, optional</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        res : fig</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#get the information from the timeseries</span>
        <span class="n">lat</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;geo_meanLat&#39;</span><span class="p">]]</span>
        <span class="n">lon</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;geo_meanLon&#39;</span><span class="p">]]</span>
        <span class="n">archiveType</span><span class="o">=</span><span class="n">lipdutils</span><span class="o">.</span><span class="n">LipdToOntology</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;archiveType&#39;</span><span class="p">])</span>

        <span class="c1"># make sure criteria is in the plot_default list</span>
        <span class="k">if</span> <span class="n">archiveType</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_default</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">archiveType</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>

        <span class="k">if</span> <span class="n">markersize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scatter_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;markersize&#39;</span><span class="p">:</span> <span class="n">markersize</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">marker</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">marker</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_default</span><span class="p">[</span><span class="n">archiveType</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">color</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_default</span><span class="p">[</span><span class="n">archiveType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">proj_default</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="n">proj1</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;central_latitude&#39;</span><span class="p">:</span><span class="n">lat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                   <span class="s1">&#39;central_longitude&#39;</span><span class="p">:</span><span class="n">lon</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span>
            <span class="n">proj2</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;central_latitude&#39;</span><span class="p">:</span><span class="n">lat</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span>
            <span class="n">proj3</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;central_longitude&#39;</span><span class="p">:</span><span class="n">lon</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span>

        <span class="n">archiveType</span><span class="o">=</span><span class="p">[</span><span class="n">archiveType</span><span class="p">]</span> <span class="c1">#list so it will work with map_all</span>
        <span class="n">marker</span><span class="o">=</span><span class="p">[</span><span class="n">marker</span><span class="p">]</span>
        <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="n">color</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">proj_default</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">map_all</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="n">lon</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">archiveType</span><span class="p">,</span>
                              <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span><span class="n">color</span><span class="p">,</span>
                              <span class="n">projection</span> <span class="o">=</span> <span class="n">projection</span><span class="p">,</span> <span class="n">proj_default</span> <span class="o">=</span> <span class="n">proj1</span><span class="p">,</span>
                              <span class="n">background</span> <span class="o">=</span> <span class="n">background</span><span class="p">,</span><span class="n">borders</span> <span class="o">=</span> <span class="n">borders</span><span class="p">,</span>
                              <span class="n">rivers</span> <span class="o">=</span> <span class="n">rivers</span><span class="p">,</span> <span class="n">lakes</span> <span class="o">=</span> <span class="n">lakes</span><span class="p">,</span>
                              <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span>
                              <span class="n">scatter_kwargs</span><span class="o">=</span><span class="n">scatter_kwargs</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">,</span>
                              <span class="n">lgd_kwargs</span><span class="o">=</span><span class="n">lgd_kwargs</span><span class="p">,</span><span class="n">savefig_settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">,</span>
                              <span class="n">mute</span><span class="o">=</span><span class="n">mute</span><span class="p">)</span>

            <span class="k">except</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">map_all</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="n">lon</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">archiveType</span><span class="p">,</span>
                              <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span><span class="n">color</span><span class="p">,</span>
                              <span class="n">projection</span> <span class="o">=</span> <span class="n">projection</span><span class="p">,</span> <span class="n">proj_default</span> <span class="o">=</span> <span class="n">proj3</span><span class="p">,</span>
                              <span class="n">background</span> <span class="o">=</span> <span class="n">background</span><span class="p">,</span><span class="n">borders</span> <span class="o">=</span> <span class="n">borders</span><span class="p">,</span>
                              <span class="n">rivers</span> <span class="o">=</span> <span class="n">rivers</span><span class="p">,</span> <span class="n">lakes</span> <span class="o">=</span> <span class="n">lakes</span><span class="p">,</span>
                              <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span>
                              <span class="n">scatter_kwargs</span><span class="o">=</span><span class="n">scatter_kwargs</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">,</span>
                              <span class="n">lgd_kwargs</span><span class="o">=</span><span class="n">lgd_kwargs</span><span class="p">,</span><span class="n">savefig_settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">,</span>
                              <span class="n">mute</span><span class="o">=</span><span class="n">mute</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">map_all</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="n">lon</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">archiveType</span><span class="p">,</span>
                              <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span><span class="n">color</span><span class="p">,</span>
                              <span class="n">projection</span> <span class="o">=</span> <span class="n">projection</span><span class="p">,</span> <span class="n">proj_default</span> <span class="o">=</span> <span class="n">proj2</span><span class="p">,</span>
                              <span class="n">background</span> <span class="o">=</span> <span class="n">background</span><span class="p">,</span><span class="n">borders</span> <span class="o">=</span> <span class="n">borders</span><span class="p">,</span>
                              <span class="n">rivers</span> <span class="o">=</span> <span class="n">rivers</span><span class="p">,</span> <span class="n">lakes</span> <span class="o">=</span> <span class="n">lakes</span><span class="p">,</span>
                              <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span>
                              <span class="n">scatter_kwargs</span><span class="o">=</span><span class="n">scatter_kwargs</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">,</span>
                              <span class="n">lgd_kwargs</span><span class="o">=</span><span class="n">lgd_kwargs</span><span class="p">,</span><span class="n">savefig_settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">,</span>
                              <span class="n">mute</span><span class="o">=</span><span class="n">mute</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">map_all</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="n">lon</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">archiveType</span><span class="p">,</span>
                              <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span><span class="n">color</span><span class="p">,</span>
                              <span class="n">projection</span> <span class="o">=</span> <span class="n">projection</span><span class="p">,</span> <span class="n">proj_default</span> <span class="o">=</span> <span class="n">proj_default</span><span class="p">,</span>
                              <span class="n">background</span> <span class="o">=</span> <span class="n">background</span><span class="p">,</span><span class="n">borders</span> <span class="o">=</span> <span class="n">borders</span><span class="p">,</span>
                              <span class="n">rivers</span> <span class="o">=</span> <span class="n">rivers</span><span class="p">,</span> <span class="n">lakes</span> <span class="o">=</span> <span class="n">lakes</span><span class="p">,</span>
                              <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span>
                              <span class="n">scatter_kwargs</span><span class="o">=</span><span class="n">scatter_kwargs</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">,</span>
                              <span class="n">lgd_kwargs</span><span class="o">=</span><span class="n">lgd_kwargs</span><span class="p">,</span><span class="n">savefig_settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">,</span>
                              <span class="n">mute</span><span class="o">=</span><span class="n">mute</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2017-2020, Deborah Khider, Feng Zhu, Julien Emile-Geay

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>