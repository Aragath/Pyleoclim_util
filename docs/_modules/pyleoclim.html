
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>pyleoclim &#8212; Pyleoclim 0.3.0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pyleoclim</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Wed May 11 10:42:34 2016</span>

<span class="sd">@author: deborahkhider</span>

<span class="sd">License agreement - GNU GENERAL PUBLIC LICENSE v3</span>
<span class="sd">https://github.com/LinkedEarth/Pyleoclim_util/blob/master/license</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#Import all the needed packages</span>
<span class="kn">import</span> <span class="nn">lipd</span> <span class="k">as</span> <span class="nn">lpd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.basemap</span> <span class="k">import</span> <span class="n">Basemap</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">gridspec</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">sys</span>


<span class="c1"># Import internal modules to pyleoclim</span>
<span class="kn">from</span> <span class="nn">pyleoclim</span> <span class="k">import</span> <span class="n">Map</span>
<span class="kn">from</span> <span class="nn">pyleoclim</span> <span class="k">import</span> <span class="n">LipdUtils</span>
<span class="kn">from</span> <span class="nn">pyleoclim</span> <span class="k">import</span> <span class="n">SummaryPlots</span>
<span class="kn">from</span> <span class="nn">pyleoclim</span> <span class="k">import</span> <span class="n">Plot</span>
<span class="kn">from</span> <span class="nn">pyleoclim</span> <span class="k">import</span> <span class="n">Spectral</span>
<span class="kn">from</span> <span class="nn">pyleoclim</span> <span class="k">import</span> <span class="n">Stats</span>
<span class="kn">from</span> <span class="nn">pyleoclim</span> <span class="k">import</span> <span class="n">Timeseries</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Open Lipd files and extract timeseries (set them as global variable)</span>
<span class="sd"> </span>
<span class="sd">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="readLipd"><a class="viewcode-back" href="../Main.html#pyleoclim.readLipd">[docs]</a><span class="k">def</span> <span class="nf">readLipd</span><span class="p">(</span><span class="n">usr_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read Lipd files into a dictionary</span>
<span class="sd">    </span>
<span class="sd">    This function is based on the function of the same name in the LiPD utilities.</span>
<span class="sd">    Sets the dictionary as global variable so that it doesn&#39;t have to be provided</span>
<span class="sd">    as an argument for every function.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        usr_path (str): The path to a directory or a single file. (Optional argument)</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        lipd_dict - a dictionary containing the LiPD library</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">lipd_dict</span>
    <span class="n">lipd_dict</span> <span class="o">=</span> <span class="n">lpd</span><span class="o">.</span><span class="n">readLipd</span><span class="p">(</span><span class="n">usr_path</span><span class="o">=</span><span class="n">usr_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lipd_dict</span></div>

<div class="viewcode-block" id="extractTs"><a class="viewcode-back" href="../Main.html#pyleoclim.extractTs">[docs]</a><span class="k">def</span> <span class="nf">extractTs</span><span class="p">(</span><span class="n">lipds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Extract timeseries dictionary</span>
<span class="sd">    </span>
<span class="sd">    This function is based on the function of the same name in the LiPD utilities.</span>
<span class="sd">    Set the dictionary as a global variable so that it doesn&#39;t have to be</span>
<span class="sd">    provided as an argument for every function. </span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        lipds (dict): A dictionary of LiPD files obtained through the </span>
<span class="sd">        readLipd function</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        ts_list - A list of timeseries object</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">ts_list</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">lipds</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;lipd_dict&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
            <span class="n">readLipd</span><span class="p">()</span>
            
        <span class="n">ts_list</span> <span class="o">=</span> <span class="n">lpd</span><span class="o">.</span><span class="n">extractTs</span><span class="p">(</span><span class="n">lipd_dict</span><span class="p">)</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ts_list</span> <span class="o">=</span> <span class="n">lpd</span><span class="o">.</span><span class="n">extractTs</span><span class="p">(</span><span class="n">lipds</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ts_list</span></div>
        

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Set a few global variables</span>
<span class="sd">&quot;&quot;&quot;</span>
      
<span class="c1">#Set the default palette for plots</span>

<span class="n">plot_default</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ice/rock&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#FFD600&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">],</span>
                <span class="s1">&#39;coral&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#FF8B00&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">],</span>
                <span class="s1">&#39;documents&#39;</span><span class="p">:[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">],</span>
                <span class="s1">&#39;glacier ice&#39;</span><span class="p">:[</span><span class="s1">&#39;#86CDFA&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span>
                <span class="s1">&#39;hybrid&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#00BEFF&#39;</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">],</span>
                <span class="s1">&#39;lake sediment&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#4169E0&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">],</span>
                <span class="s1">&#39;marine sediment&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#8A4513&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">],</span>
                <span class="s1">&#39;sclerosponge&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">],</span>
                <span class="s1">&#39;speleothem&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#FF1492&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">],</span>
                <span class="s1">&#39;wood&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#32CC32&#39;</span><span class="p">,</span><span class="s1">&#39;^&#39;</span><span class="p">],</span>
                <span class="s1">&#39;molluskshells&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#FFD600&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">],</span>
                <span class="s1">&#39;peat&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#2F4F4F&#39;</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">],</span>
                <span class="s1">&#39;other&#39;</span><span class="p">:[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">]}</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Mapping</span>
<span class="sd">&quot;&quot;&quot;</span>
<div class="viewcode-block" id="mapAllArchive"><a class="viewcode-back" href="../Main.html#pyleoclim.mapAllArchive">[docs]</a><span class="k">def</span> <span class="nf">mapAllArchive</span><span class="p">(</span><span class="n">lipds</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">background</span> <span class="o">=</span> <span class="s1">&#39;shadedrelief&#39;</span><span class="p">,</span>\
                  <span class="n">figsize</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>\
                  <span class="n">saveFig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;eps&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Map all the available records loaded into the workspace by archiveType.</span>

<span class="sd">    Map of all the records into the workspace by archiveType.</span>
<span class="sd">        Uses the default color palette. Enter pyleoclim.plot_default for detail.</span>

<span class="sd">    Args:</span>
<span class="sd">        lipds (dict): A dictionary of LiPD files. (Optional)</span>
<span class="sd">        markersize (int): The size of the markers. Default is 50</span>
<span class="sd">        background (str): Plots one of the following images on the map:</span>
<span class="sd">            bluemarble, etopo, shadedrelief, or none (filled continents).</span>
<span class="sd">            Default is shadedrelief.</span>
<span class="sd">        figsize (list): the size for the figure</span>
<span class="sd">        ax: Return as axis instead of figure (useful to integrate plot into a subplot)     </span>
<span class="sd">        saveFig (bool): Default is to not save the figure</span>
<span class="sd">        dir (str): The absolute path of the directory in which to save the</span>
<span class="sd">            figure. If not provided, creates a default folder called &#39;figures&#39;</span>
<span class="sd">            in the LiPD working directory (lipd.path).</span>
<span class="sd">        format (str): One of the file extensions supported by the active</span>
<span class="sd">            backend. Default is &quot;eps&quot;. Most backend support png, pdf, ps, eps,</span>
<span class="sd">            and svg.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The figure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Get the dictionary of LiPD files</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">lipds</span> <span class="ow">and</span> <span class="s1">&#39;lipd_dict&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
        <span class="n">readLipd</span><span class="p">()</span>
        
    <span class="c1"># Initialize the various lists</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">archiveType</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Loop ang grab the metadata</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lipd_dict</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">lipd_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">lat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;geo&#39;</span><span class="p">][</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">lon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;geo&#39;</span><span class="p">][</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">archiveType</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LipdUtils</span><span class="o">.</span><span class="n">LipdToOntology</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;archiveType&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>


    <span class="c1"># make sure criteria is in the plot_default list</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">archiveType</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plot_default</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">archiveType</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>


    <span class="c1"># Make the map</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">mapAll</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span><span class="n">archiveType</span><span class="p">,</span><span class="n">lat_0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">lon_0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">palette</span><span class="o">=</span><span class="n">plot_default</span><span class="p">,</span>\
                     <span class="n">background</span> <span class="o">=</span> <span class="n">background</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="n">markersize</span><span class="p">,</span>\
                     <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Save the figure if asked</span>
    <span class="k">if</span> <span class="n">saveFig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">LipdUtils</span><span class="o">.</span><span class="n">saveFigure</span><span class="p">(</span><span class="s1">&#39;mapLipds_archive&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="nb">dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span>

    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="mapLipd"><a class="viewcode-back" href="../Main.html#pyleoclim.mapLipd">[docs]</a><span class="k">def</span> <span class="nf">mapLipd</span><span class="p">(</span><span class="n">timeseries</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">countries</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">counties</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> \
        <span class="n">rivers</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">states</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">background</span> <span class="o">=</span> <span class="s2">&quot;shadedrelief&quot;</span><span class="p">,</span>\
        <span class="n">scale</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span> \
        <span class="n">figsize</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> \
        <span class="n">saveFig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="nb">dir</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;eps&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Create a Map for a single record</span>

<span class="sd">    Orthographic projection map of a single record.</span>

<span class="sd">    Args:</span>
<span class="sd">        timeseries: a LiPD timeseries object. Will prompt for one if not given</span>
<span class="sd">        countries (bool): Draws the country borders. Default is on (True).</span>
<span class="sd">        counties (bool): Draws the USA counties. Default is off (False).</span>
<span class="sd">        rivers (bool): Draws the rivers. Default is off (False).</span>
<span class="sd">        states (bool): Draws the American and Australian states borders.</span>
<span class="sd">            Default is off (False)</span>
<span class="sd">        background (str): Plots one of the following images on the map:</span>
<span class="sd">            bluemarble, etopo, shadedrelief, or none (filled continents).</span>
<span class="sd">            Default is shadedrelief</span>
<span class="sd">        scale (float): useful to downgrade the original image resolution to</span>
<span class="sd">            speed up the process. Default is 0.5.</span>
<span class="sd">        markersize (int): default is 50</span>
<span class="sd">        marker (str): a string (or list) containing the color and shape of the</span>
<span class="sd">            marker. Default is by archiveType. Type pyleo.plot_default to see</span>
<span class="sd">            the default palette.</span>
<span class="sd">        figsize (list): the size for the figure</span>
<span class="sd">        saveFig (bool): default is to not save the figure</span>
<span class="sd">        dir (str): the full path of the directory in which to save the figure.</span>
<span class="sd">            If not provided, creates a default folder called &#39;figures&#39; in the</span>
<span class="sd">            LiPD working directory (lipd.path).</span>
<span class="sd">        format (str): One of the file extensions supported by the active</span>
<span class="sd">            backend. Default is &quot;eps&quot;. Most backend support png, pdf, ps, eps,</span>
<span class="sd">            and svg.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The figure</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Make sure there are LiPD files to plot</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">timeseries</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;ts_list&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
            <span class="n">extractTs</span><span class="p">()</span>
        <span class="n">timeseries</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">getTs</span><span class="p">(</span><span class="n">ts_list</span><span class="p">)</span>    

    <span class="c1"># Get latitude/longitude</span>

    <span class="n">lat</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="s1">&#39;geo_meanLat&#39;</span><span class="p">]</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="s1">&#39;geo_meanLon&#39;</span><span class="p">]</span>

    <span class="c1"># Make sure it&#39;s in the palette</span>
    <span class="k">if</span> <span class="n">marker</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span>
        <span class="n">archiveType</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">LipdToOntology</span><span class="p">(</span><span class="n">timeseries</span><span class="p">[</span><span class="s1">&#39;archiveType&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">archiveType</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plot_default</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">archiveType</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="n">plot_default</span><span class="p">[</span><span class="n">archiveType</span><span class="p">]</span>
    

    <span class="n">fig</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">mapOne</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>\
                     <span class="n">countries</span> <span class="o">=</span> <span class="n">countries</span><span class="p">,</span> <span class="n">counties</span> <span class="o">=</span> <span class="n">counties</span><span class="p">,</span><span class="n">rivers</span> <span class="o">=</span> <span class="n">rivers</span><span class="p">,</span> \
                     <span class="n">states</span> <span class="o">=</span> <span class="n">states</span><span class="p">,</span> <span class="n">background</span> <span class="o">=</span> <span class="n">background</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span><span class="n">scale</span><span class="p">,</span>
                     <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">)</span>

    <span class="c1"># Save the figure if asked</span>
    <span class="k">if</span> <span class="n">saveFig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">LipdUtils</span><span class="o">.</span><span class="n">saveFigure</span><span class="p">(</span><span class="n">timeseries</span><span class="p">[</span><span class="s1">&#39;dataSetName&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_map&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="nb">dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span>

    <span class="k">return</span> <span class="n">fig</span></div>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Plotting</span>
<span class="sd">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="plotTs"><a class="viewcode-back" href="../Main.html#pyleoclim.plotTs">[docs]</a><span class="k">def</span> <span class="nf">plotTs</span><span class="p">(</span><span class="n">timeseries</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">x_axis</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>\
            <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>\
            <span class="n">saveFig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="nb">dir</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>\
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;eps&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot a single time series.</span>

<span class="sd">    Args:</span>
<span class="sd">        A timeseries: By default, will prompt the user for one.</span>
<span class="sd">        x_axis (str): The representation against which to plot the paleo-data.</span>
<span class="sd">            Options are &quot;age&quot;, &quot;year&quot;, and &quot;depth&quot;. Default is to let the</span>
<span class="sd">            system choose if only one available or prompt the user.</span>
<span class="sd">        markersize (int): default is 50.</span>
<span class="sd">        marker (str): a string (or list) containing the color and shape of the</span>
<span class="sd">            marker. Default is by archiveType. Type pyleo.plot_default to see</span>
<span class="sd">            the default palette.</span>
<span class="sd">        figsize (list): the size for the figure</span>
<span class="sd">        saveFig (bool): default is to not save the figure</span>
<span class="sd">        dir (str): the full path of the directory in which to save the figure.</span>
<span class="sd">            If not provided, creates a default folder called &#39;figures&#39; in the</span>
<span class="sd">            LiPD working directory (lipd.path).</span>
<span class="sd">        format (str): One of the file extensions supported by the active</span>
<span class="sd">            backend. Default is &quot;eps&quot;. Most backend support png, pdf, ps, eps,</span>
<span class="sd">            and svg.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The figure.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">timeseries</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;ts_list&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
            <span class="n">extractTs</span><span class="p">()</span>
        <span class="n">timeseries</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">getTs</span><span class="p">(</span><span class="n">ts_list</span><span class="p">)</span> 

    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">timeseries</span><span class="p">[</span><span class="s1">&#39;paleoData_values&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">checkXaxis</span><span class="p">(</span><span class="n">timeseries</span><span class="p">,</span> <span class="n">x_axis</span><span class="o">=</span><span class="n">x_axis</span><span class="p">)</span>

    <span class="c1"># remove nans</span>
    <span class="n">y_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_temp</span><span class="p">)]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_temp</span><span class="p">)]</span>

    <span class="c1"># get the markers</span>
    <span class="k">if</span> <span class="n">marker</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span>
        <span class="n">archiveType</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">LipdToOntology</span><span class="p">(</span><span class="n">timeseries</span><span class="p">[</span><span class="s1">&#39;archiveType&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">archiveType</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plot_default</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">archiveType</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="n">plot_default</span><span class="p">[</span><span class="n">archiveType</span><span class="p">]</span>

    <span class="c1"># Get the labels</span>
    <span class="c1"># title</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="s1">&#39;dataSetName&#39;</span><span class="p">]</span>
    <span class="c1"># x_label</span>
    <span class="k">if</span> <span class="n">label</span><span class="o">+</span><span class="s2">&quot;Units&quot;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="n">label</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span> <span class="s2">&quot; (&quot;</span><span class="o">+</span><span class="n">timeseries</span><span class="p">[</span><span class="n">label</span><span class="o">+</span><span class="s2">&quot;Units&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;)&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="n">label</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="c1"># ylabel</span>
    <span class="k">if</span> <span class="s2">&quot;paleoData_InferredVariableType&quot;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="s2">&quot;paleoData_units&quot;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="s2">&quot;paleoData_InferredVariableType&quot;</span><span class="p">]</span> <span class="o">+</span> \
                      <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="n">timeseries</span><span class="p">[</span><span class="s2">&quot;paleoData_units&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="s2">&quot;paleoData_InferredVariableType&quot;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="s2">&quot;paleoData_ProxyObservationType&quot;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="s2">&quot;paleoData_units&quot;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="s2">&quot;paleoData_ProxyObservationType&quot;</span><span class="p">]</span> <span class="o">+</span> \
                      <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="n">timeseries</span><span class="p">[</span><span class="s2">&quot;paleoData_units&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="s2">&quot;paleoData_ProxyObservationType&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;paleoData_units&quot;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="s2">&quot;paleoData_variableName&quot;</span><span class="p">]</span> <span class="o">+</span> \
                      <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="n">timeseries</span><span class="p">[</span><span class="s2">&quot;paleoData_units&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="s2">&quot;paleoData_variableName&quot;</span><span class="p">]</span>


    
    <span class="c1"># make the plot</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">Plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span><span class="n">x_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">,</span>\
              <span class="n">y_label</span><span class="o">=</span><span class="n">y_label</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1">#Save the figure if asked</span>
    <span class="k">if</span> <span class="n">saveFig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;plot_timeseries_&#39;</span><span class="o">+</span><span class="n">timeseries</span><span class="p">[</span><span class="s2">&quot;dataSetName&quot;</span><span class="p">]</span><span class="o">+</span>\
            <span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">y_label</span>
        <span class="n">LipdUtils</span><span class="o">.</span><span class="n">saveFigure</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="nb">format</span><span class="p">,</span><span class="nb">dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="histTs"><a class="viewcode-back" href="../Main.html#pyleoclim.histTs">[docs]</a><span class="k">def</span> <span class="nf">histTs</span><span class="p">(</span><span class="n">timeseries</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">hist</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> \
             <span class="n">kde</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">rug</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">fit</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">hist_kws</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span><span class="s2">&quot;Histogram&quot;</span><span class="p">},</span>\
             <span class="n">kde_kws</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span><span class="s2">&quot;KDE fit&quot;</span><span class="p">},</span> <span class="n">rug_kws</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span><span class="s2">&quot;Rug&quot;</span><span class="p">},</span> \
             <span class="n">fit_kws</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span><span class="s2">&quot;Fit&quot;</span><span class="p">},</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="n">vertical</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> \
             <span class="n">norm_hist</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>\
             <span class="n">saveFig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span><span class="s2">&quot;eps&quot;</span><span class="p">,</span>\
             <span class="nb">dir</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Plot a univariate distribution of the PaleoData values</span>

<span class="sd">    This function is based on the seaborn displot function, which is</span>
<span class="sd">    itself a combination of the matplotlib hist function with the</span>
<span class="sd">    seaborn kdeplot() and rugplot() functions. It can also fit</span>
<span class="sd">    scipy.stats distributions and plot the estimated PDF over the data.</span>

<span class="sd">    Args:</span>
<span class="sd">        timeseries: A timeseries. By default, will prompt the user for one.</span>
<span class="sd">        bins (int): Specification of hist bins following matplotlib(hist),</span>
<span class="sd">            or None to use Freedman-Diaconis rule</span>
<span class="sd">        hist (bool): Whether to plot a (normed) histogram</span>
<span class="sd">        kde (bool): Whether to plot a gaussian kernel density estimate</span>
<span class="sd">        rug (bool): Whether to draw a rugplot on the support axis</span>
<span class="sd">        fit: Random variable object. An object with fit method, returning</span>
<span class="sd">            a tuple that can be passed to a pdf method of positional</span>
<span class="sd">            arguments following a grid of values to evaluate the pdf on.</span>
<span class="sd">        {hist, kde, rug, fit}_kws: Dictionaries. Keyword arguments for</span>
<span class="sd">            underlying plotting functions. If modifying the dictionary, make</span>
<span class="sd">            sure the labels &quot;hist&quot;, &quot;kde&quot;, &quot;rug&quot; and &quot;fit&quot; are still passed.</span>
<span class="sd">        color (str): matplotlib color. Color to plot everything but the</span>
<span class="sd">            fitted curve in. Default is to use the default paletter for each</span>
<span class="sd">            archive type.</span>
<span class="sd">        vertical (bool): if True, oberved values are on y-axis.</span>
<span class="sd">        norm_hist (bool): If True (default), the histrogram height shows</span>
<span class="sd">            a density rather than a count. This is implied if a KDE or</span>
<span class="sd">            fitted density is plotted</span>
<span class="sd">        figsize (list): the size for the figure</span>
<span class="sd">        saveFig (bool): default is to not save the figure</span>
<span class="sd">        dir (str): the full path of the directory in which to save the figure.</span>
<span class="sd">            If not provided, creates a default folder called &#39;figures&#39; in the</span>
<span class="sd">            LiPD working directory (lipd.path).</span>
<span class="sd">        format (str): One of the file extensions supported by the active</span>
<span class="sd">            backend. Default is &quot;eps&quot;. Most backend support png, pdf, ps, eps,</span>
<span class="sd">            and svg.</span>

<span class="sd">    Returns</span>
<span class="sd">        fig - The figure</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">timeseries</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;ts_list&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
            <span class="n">extractTs</span><span class="p">()</span>
        <span class="n">timeseries</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">getTs</span><span class="p">(</span><span class="n">ts_list</span><span class="p">)</span> 

    <span class="c1"># Get the values</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">timeseries</span><span class="p">[</span><span class="s1">&#39;paleoData_values&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>

    <span class="c1"># Remove NaNs</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="c1"># Get the y_label</span>
    <span class="k">if</span> <span class="s2">&quot;paleoData_InferredVariableType&quot;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="s2">&quot;paleoData_units&quot;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="s2">&quot;paleoData_InferredVariableType&quot;</span><span class="p">]</span> <span class="o">+</span> \
                      <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="n">timeseries</span><span class="p">[</span><span class="s2">&quot;paleoData_units&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="s2">&quot;paleoData_InferredVariableType&quot;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="s2">&quot;paleoData_ProxyObservationType&quot;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="s2">&quot;paleoData_units&quot;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="s2">&quot;paleoData_ProxyObservationType&quot;</span><span class="p">]</span> <span class="o">+</span> \
                      <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="n">timeseries</span><span class="p">[</span><span class="s2">&quot;paleoData_units&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="s2">&quot;paleoData_ProxyObservationType&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;paleoData_units&quot;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="s2">&quot;paleoData_variableName&quot;</span><span class="p">]</span> <span class="o">+</span> \
                      <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="n">timeseries</span><span class="p">[</span><span class="s2">&quot;paleoData_units&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="s2">&quot;paleoData_variableName&quot;</span><span class="p">]</span>

    <span class="c1"># Grab the color</span>
    <span class="k">if</span> <span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span>
        <span class="n">archiveType</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">LipdToOntology</span><span class="p">(</span><span class="n">timeseries</span><span class="p">[</span><span class="s1">&#39;archiveType&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">archiveType</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plot_default</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">archiveType</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">plot_default</span><span class="p">[</span><span class="n">archiveType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># Make this histogram</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">Plot</span><span class="o">.</span><span class="n">plot_hist</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span><span class="p">,</span> <span class="n">hist</span> <span class="o">=</span> <span class="n">hist</span><span class="p">,</span> \
        <span class="n">kde</span> <span class="o">=</span> <span class="n">kde</span><span class="p">,</span> <span class="n">rug</span> <span class="o">=</span> <span class="n">rug</span><span class="p">,</span> <span class="n">fit</span> <span class="o">=</span> <span class="n">fit</span><span class="p">,</span> <span class="n">hist_kws</span> <span class="o">=</span> <span class="n">hist_kws</span><span class="p">,</span>\
        <span class="n">kde_kws</span> <span class="o">=</span> <span class="n">kde_kws</span><span class="p">,</span> <span class="n">rug_kws</span> <span class="o">=</span> <span class="n">rug_kws</span><span class="p">,</span> \
        <span class="n">fit_kws</span> <span class="o">=</span> <span class="n">fit_kws</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">vertical</span> <span class="o">=</span> <span class="n">vertical</span><span class="p">,</span> \
        <span class="n">norm_hist</span> <span class="o">=</span> <span class="n">norm_hist</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">y_label</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1">#Save the figure if asked</span>
    <span class="k">if</span> <span class="n">saveFig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;plot_timeseries_&#39;</span><span class="o">+</span><span class="n">timeseries</span><span class="p">[</span><span class="s2">&quot;dataSetName&quot;</span><span class="p">]</span><span class="o">+</span>\
            <span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">y_label</span>
        <span class="n">LipdUtils</span><span class="o">.</span><span class="n">saveFigure</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="nb">format</span><span class="p">,</span><span class="nb">dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span></div>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">SummaryPlots</span>
<span class="sd">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="summaryTs"><a class="viewcode-back" href="../Main.html#pyleoclim.summaryTs">[docs]</a><span class="k">def</span> <span class="nf">summaryTs</span><span class="p">(</span><span class="n">timeseries</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">x_axis</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">saveFig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="nb">dir</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
               <span class="nb">format</span> <span class="o">=</span><span class="s2">&quot;eps&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Basic summary plot</span>

<span class="sd">    Plots the following information: the time series, a histogram of</span>
<span class="sd">    the PaleoData_values, location map, spectral density using the wwz </span>
<span class="sd">    method, and metadata about the record.</span>

<span class="sd">    Args:</span>
<span class="sd">        timeseries: a timeseries object. By default, will prompt for one</span>
<span class="sd">        x_axis (str): The representation against which to plot the paleo-data.</span>
<span class="sd">            Options are &quot;age&quot;, &quot;year&quot;, and &quot;depth&quot;. Default is to let the</span>
<span class="sd">            system choose if only one available or prompt the user.</span>
<span class="sd">        saveFig (bool): default is to not save the figure</span>
<span class="sd">        dir (str): the full path of the directory in which to save the figure.</span>
<span class="sd">            If not provided, creates a default folder called &#39;figures&#39; in the</span>
<span class="sd">            LiPD working directory (lipd.path).</span>
<span class="sd">        format (str): One of the file extensions supported by the active</span>
<span class="sd">            backend. Default is &quot;eps&quot;. Most backend support png, pdf, ps, eps,</span>
<span class="sd">            and svg.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The figure</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">timeseries</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;ts_list&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
            <span class="n">extractTs</span><span class="p">()</span>
        <span class="n">timeseries</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">getTs</span><span class="p">(</span><span class="n">ts_list</span><span class="p">)</span> 

    <span class="c1"># get the necessary metadata</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="n">SummaryPlots</span><span class="o">.</span><span class="n">getMetadata</span><span class="p">(</span><span class="n">timeseries</span><span class="p">)</span>
    
    <span class="c1"># get the information about the timeseries</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">archiveType</span><span class="p">,</span><span class="n">x_label</span><span class="p">,</span><span class="n">y_label</span> <span class="o">=</span> <span class="n">SummaryPlots</span><span class="o">.</span><span class="n">TsData</span><span class="p">(</span><span class="n">timeseries</span><span class="p">,</span>
                                                          <span class="n">x_axis</span><span class="o">=</span><span class="n">x_axis</span><span class="p">)</span>
        
    <span class="c1"># Make the figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;ggplot&quot;</span><span class="p">)</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">gs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span><span class="mf">1.1</span><span class="p">)</span>
    
    <span class="c1"># Plot the timeseries</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">archiveType</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">LipdToOntology</span><span class="p">(</span><span class="n">timeseries</span><span class="p">[</span><span class="s1">&#39;archiveType&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">archiveType</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plot_default</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">archiveType</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>
    <span class="n">marker</span> <span class="o">=</span> <span class="n">plot_default</span><span class="p">[</span><span class="n">archiveType</span><span class="p">]</span>
    <span class="n">markersize</span> <span class="o">=</span> <span class="mi">50</span>
    
    <span class="n">Plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="n">marker</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">,</span>\
              <span class="n">y_label</span><span class="o">=</span><span class="n">y_label</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="s1">&#39;dataSetName&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    
    <span class="c1"># Plot the histogram and kernel density estimates</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">vertical</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">marker</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> \
                <span class="n">hist_kws</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span><span class="s2">&quot;Histogram&quot;</span><span class="p">},</span>
                <span class="n">kde_kws</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span><span class="s2">&quot;KDE fit&quot;</span><span class="p">})</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;PDF&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">])</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
    
    <span class="c1"># Plot the Map</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="s2">&quot;geo_meanLat&quot;</span><span class="p">]</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="s2">&quot;geo_meanLon&quot;</span><span class="p">]</span>
    
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="nb">map</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">=</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat_0</span><span class="o">=</span><span class="n">lat</span><span class="p">)</span>
    <span class="nb">map</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">()</span>
    <span class="nb">map</span><span class="o">.</span><span class="n">shadedrelief</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="nb">map</span><span class="o">.</span><span class="n">drawcountries</span><span class="p">()</span>
    <span class="n">X</span><span class="p">,</span><span class="n">Y</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span><span class="n">lat</span><span class="p">)</span>
    <span class="nb">map</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span>
               <span class="n">s</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>
               <span class="n">color</span> <span class="o">=</span> <span class="n">marker</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
               <span class="n">marker</span> <span class="o">=</span> <span class="n">marker</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="c1"># Plot Age model if any</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;age&#39;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;year&#39;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No age or year information available, skipping spectral analysis&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>    
        <span class="k">if</span> <span class="s1">&#39;depth&#39;</span> <span class="ow">in</span> <span class="n">x_label</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;age&#39;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;year&#39;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Both age and year information are available.&quot;</span><span class="p">)</span>
                <span class="n">x_axis</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Which one would you like to use? &quot;</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">x_axis</span> <span class="o">!=</span> <span class="s2">&quot;year&quot;</span> <span class="ow">and</span> <span class="n">x_axis</span> <span class="o">!=</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span>
                    <span class="n">x_axis</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Only enter year or age: &quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39;age&#39;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">x_axis</span> <span class="o">=</span> <span class="s1">&#39;age&#39;</span>
            <span class="k">elif</span> <span class="s1">&#39;year&#39;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">x_axis</span> <span class="o">=</span> <span class="s1">&#39;year&#39;</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">timeseries</span><span class="p">[</span><span class="s1">&#39;paleoData_values&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">checkXaxis</span><span class="p">(</span><span class="n">timeseries</span><span class="p">,</span> <span class="n">x_axis</span><span class="o">=</span><span class="n">x_axis</span><span class="p">)</span>
            <span class="n">y_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_temp</span><span class="p">)]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_temp</span><span class="p">)]</span>
                   
    <span class="c1"># Perform the analysis</span>
    <span class="n">default</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tau&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
               <span class="s1">&#39;freqs&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
               <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mf">1e-3</span><span class="p">,</span>
               <span class="s1">&#39;nproc&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span>
               <span class="s1">&#39;nMC&#39;</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span>
               <span class="s1">&#39;detrend&#39;</span><span class="p">:</span><span class="s1">&#39;no&#39;</span><span class="p">,</span>
               <span class="s1">&#39;Neff&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
               <span class="s1">&#39;anti_alias&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
               <span class="s1">&#39;avgs&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
               <span class="s1">&#39;method&#39;</span><span class="p">:</span><span class="s1">&#39;Kirchner_f2py&#39;</span><span class="p">}</span>
    <span class="n">psd</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">psd_ar1_q95</span> <span class="o">=</span> <span class="n">Spectral</span><span class="o">.</span><span class="n">wwz_psd</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="o">**</span><span class="n">default</span><span class="p">)</span>
    
    <span class="c1"># Make the plot</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">freqs</span><span class="p">,</span> <span class="n">psd</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;PSD&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">marker</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">freqs</span><span class="p">,</span> <span class="n">psd_ar1_q95</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;AR1 95%&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s2">&quot;pale red&quot;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Spectral Density&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Period (&#39;</span><span class="o">+</span>\
                <span class="n">x_label</span><span class="p">[</span><span class="n">x_label</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">x_label</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)][</span><span class="mi">0</span><span class="p">:</span><span class="n">x_label</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">nonposy</span><span class="o">=</span><span class="s1">&#39;clip&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">nonposy</span><span class="o">=</span><span class="s1">&#39;clip&#39;</span><span class="p">)</span>
    
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>    
        
    
    <span class="c1">#Add the metadata</span>
    <span class="n">textstr</span> <span class="o">=</span> <span class="s2">&quot;archiveType: &quot;</span> <span class="o">+</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;archiveType&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
              <span class="s2">&quot;Authors: &quot;</span> <span class="o">+</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;authors&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
              <span class="s2">&quot;Year: &quot;</span> <span class="o">+</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
              <span class="s2">&quot;DOI: &quot;</span> <span class="o">+</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;DOI&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
              <span class="s2">&quot;Variable: &quot;</span> <span class="o">+</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Variable&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
              <span class="s2">&quot;units: &quot;</span> <span class="o">+</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
              <span class="s2">&quot;Climate Interpretation: &quot;</span> <span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
              <span class="s2">&quot;    Climate Variable: &quot;</span> <span class="o">+</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Climate_Variable&quot;</span><span class="p">]</span> <span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
              <span class="s2">&quot;    Detail: &quot;</span> <span class="o">+</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Detail&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
              <span class="s2">&quot;    Seasonality: &quot;</span> <span class="o">+</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Seasonality&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
              <span class="s2">&quot;    Direction: &quot;</span> <span class="o">+</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Interpretation_Direction&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
              <span class="s2">&quot;Calibration: </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
              <span class="s2">&quot;    Equation: &quot;</span> <span class="o">+</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Calibration_equation&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>\
              <span class="s2">&quot;    Notes: &quot;</span> <span class="o">+</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Calibration_notes&quot;</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>

    <span class="c1">#Save the figure if asked</span>
    <span class="k">if</span> <span class="n">saveFig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;plot_timeseries_&#39;</span><span class="o">+</span><span class="n">timeseries</span><span class="p">[</span><span class="s2">&quot;dataSetName&quot;</span><span class="p">]</span><span class="o">+</span>\
            <span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">y_label</span>
        <span class="n">LipdUtils</span><span class="o">.</span><span class="n">saveFigure</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="nb">format</span><span class="p">,</span><span class="nb">dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span></div>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Statistics</span>
<span class="sd">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="statsTs"><a class="viewcode-back" href="../Main.html#pyleoclim.statsTs">[docs]</a><span class="k">def</span> <span class="nf">statsTs</span><span class="p">(</span><span class="n">timeseries</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Calculate simple statistics of a timeseries</span>

<span class="sd">    Args:</span>
<span class="sd">        timeseries: sytem will prompt for one if not given</span>

<span class="sd">    Returns:</span>
<span class="sd">        the mean, median, min, max, standard deviation and the</span>
<span class="sd">        inter-quartile range (IQR) of a timeseries.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; mean, median, min_, max_, std, IQR = pyleo.statsTs(timeseries)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">timeseries</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;ts_list&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
            <span class="n">extractTs</span><span class="p">()</span>
        <span class="n">timeseries</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">getTs</span><span class="p">(</span><span class="n">ts_list</span><span class="p">)</span> 

    <span class="c1"># get the values</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">timeseries</span><span class="p">[</span><span class="s1">&#39;paleoData_values&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>

    <span class="n">mean</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span> <span class="n">min_</span><span class="p">,</span> <span class="n">max_</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">IQR</span> <span class="o">=</span> <span class="n">Stats</span><span class="o">.</span><span class="n">simpleStats</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span> <span class="n">min_</span><span class="p">,</span> <span class="n">max_</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">IQR</span></div>

<div class="viewcode-block" id="corrSigTs"><a class="viewcode-back" href="../Main.html#pyleoclim.corrSigTs">[docs]</a><span class="k">def</span> <span class="nf">corrSigTs</span><span class="p">(</span><span class="n">timeseries1</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">timeseries2</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">x_axis</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> \
                 <span class="n">interp_step</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">nsim</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> \
                 <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;isospectral&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Estimates the significance of correlations between non IID timeseries.</span>

<span class="sd">        Function written by. F. Zhu.</span>

<span class="sd">        Args:</span>
<span class="sd">            timeseries1, timeseries2: timeseries object. Default is blank.</span>
<span class="sd">            x-axis (str): The representation against which to express the</span>
<span class="sd">                paleo-data. Options are &quot;age&quot;, &quot;year&quot;, and &quot;depth&quot;.</span>
<span class="sd">                Default is to let the system choose if only one available</span>
<span class="sd">                or prompt the user.</span>
<span class="sd">            interp_step (float): the step size. By default, will prompt the user.</span>
<span class="sd">            start (float): Start time/age/depth. Default is the maximum of</span>
<span class="sd">                the minima of the two timeseries</span>
<span class="sd">            end (float): End time/age/depth. Default is the minimum of the</span>
<span class="sd">                maxima of the two timeseries</span>
<span class="sd">            nsim (int): the number of simulations. Default is 1000</span>
<span class="sd">            method (str): method use to estimate the correlation and significance.</span>
<span class="sd">                Available methods include:</span>
<span class="sd">                    - &#39;ttest&#39;: T-test where the degrees of freedom are corrected for</span>
<span class="sd">                    the effect of serial correlation \n</span>
<span class="sd">                    - &#39;isopersistant&#39;: AR(1) modeling of the two timeseries \n</span>
<span class="sd">                    - &#39;isospectral&#39; (default): phase randomization of original</span>
<span class="sd">                    inputs.</span>
<span class="sd">                The T-test is parametric test, hence cheap but usually wrong</span>
<span class="sd">                except in idyllic circumstances.</span>
<span class="sd">                The others are non-parametric, but their computational</span>
<span class="sd">                requirements scales with nsim.</span>
<span class="sd">            alpha (float): significance level for critical value estimation. Default is 0.05</span>

<span class="sd">        Returns:</span>
<span class="sd">            r (float) - correlation between the two timeseries \n</span>
<span class="sd">            sig (bool) -  Returns True if significant, False otherwise \n</span>
<span class="sd">            p (real) - the p-value</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">timeseries1</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;ts_list&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
            <span class="n">extractTs</span><span class="p">()</span>
        <span class="n">timeseries1</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">getTs</span><span class="p">(</span><span class="n">ts_list</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="ow">not</span> <span class="n">timeseries2</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;ts_list&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
            <span class="n">extractTs</span><span class="p">()</span>
        <span class="n">timeseries2</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">getTs</span><span class="p">(</span><span class="n">ts_list</span><span class="p">)</span>    

    <span class="c1"># Get the first time and paleoData values</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">timeseries1</span><span class="p">[</span><span class="s1">&#39;paleoData_values&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">label1</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">checkXaxis</span><span class="p">(</span><span class="n">timeseries1</span><span class="p">,</span> <span class="n">x_axis</span><span class="o">=</span><span class="n">x_axis</span><span class="p">)</span>

    <span class="c1"># Get the second one</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">timeseries2</span><span class="p">[</span><span class="s1">&#39;paleoData_values&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">label2</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">checkXaxis</span><span class="p">(</span><span class="n">timeseries2</span><span class="p">,</span> <span class="n">x_axis</span><span class="o">=</span><span class="n">x_axis</span><span class="p">)</span>

    <span class="c1"># Remove NaNs</span>
    <span class="n">y1_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">y1</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y1_temp</span><span class="p">)]</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">x1</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y1_temp</span><span class="p">)]</span>

    <span class="n">y2_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">y2</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y2_temp</span><span class="p">)]</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">x2</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y2_temp</span><span class="p">)]</span>
    
    
    <span class="c1"># Make sure that the series have the same units:</span>
    <span class="n">units1</span> <span class="o">=</span> <span class="n">timeseries1</span><span class="p">[</span><span class="n">label1</span><span class="o">+</span><span class="s1">&#39;Units&#39;</span><span class="p">]</span>
    <span class="n">units2</span> <span class="o">=</span> <span class="n">timeseries2</span><span class="p">[</span><span class="n">label2</span><span class="o">+</span><span class="s1">&#39;Units&#39;</span><span class="p">]</span> 
    
    <span class="k">if</span> <span class="n">units2</span><span class="o">!=</span><span class="n">units1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: The two timeseries are on different time units!&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The units of timeseries1 are &#39;</span><span class="o">+</span><span class="n">units1</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The units of timeseries2 are &#39;</span><span class="o">+</span><span class="n">units2</span><span class="p">)</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Enter an equation to convert the units of x2 onto x1.&#39;</span><span class="o">+</span>
                       <span class="s2">&quot; The equation should be written in Python format&quot;</span><span class="o">+</span>
                       <span class="s2">&quot; (e.g., a*x2+b or 1950-a*x2) or press enter to abort: &quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">answer</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Aborted by User&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;x2&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">answer</span><span class="p">:</span> 
            <span class="n">answer</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;The form must be a valid python expression and contain x2!&quot;</span><span class="o">+</span>
                           <span class="s2">&quot;Enter a valid expression: &quot;</span><span class="p">)</span>
            <span class="k">while</span> <span class="s2">&quot;x2&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">answer</span><span class="p">:</span>
                <span class="n">answer</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;The form must be a valid python expression and contain x2!&quot;</span><span class="o">+</span>
                           <span class="s2">&quot;Enter a valid expression: &quot;</span><span class="p">)</span>        
        <span class="k">else</span><span class="p">:</span> <span class="n">x2</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>  
        
    <span class="c1"># Make sure these things are actually ordered</span>
    <span class="n">x1_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>
    <span class="n">x2_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">x1</span><span class="p">[</span><span class="n">x1_idx</span><span class="p">]</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">y1</span><span class="p">[</span><span class="n">x1_idx</span><span class="p">]</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">x2</span><span class="p">[</span><span class="n">x2_idx</span><span class="p">]</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">y2</span><span class="p">[</span><span class="n">x2_idx</span><span class="p">]</span>    

    <span class="c1">#Check that the two timeseries have the same lenght and if not interpolate</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y2</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The two series don&#39;t have the same length. Interpolating ...&quot;</span><span class="p">)</span>
        <span class="n">xi</span><span class="p">,</span> <span class="n">interp_values1</span><span class="p">,</span> <span class="n">interp_values2</span> <span class="o">=</span> <span class="n">Timeseries</span><span class="o">.</span><span class="n">onCommonAxis</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span>
                                                                     <span class="n">interp_step</span> <span class="o">=</span> <span class="n">interp_step</span><span class="p">,</span>
                                                                     <span class="n">start</span> <span class="o">=</span><span class="n">start</span><span class="p">,</span>
                                                                     <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">min</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">max</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x2</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The two series don&#39;t have the same length. Interpolating ...&quot;</span><span class="p">)</span>
        <span class="n">xi</span><span class="p">,</span> <span class="n">interp_values1</span><span class="p">,</span> <span class="n">interp_values2</span> <span class="o">=</span> <span class="n">Timeseries</span><span class="o">.</span><span class="n">onCommonAxis</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span>
                                                                     <span class="n">interp_step</span> <span class="o">=</span> <span class="n">interp_step</span><span class="p">,</span>
                                                                     <span class="n">start</span> <span class="o">=</span><span class="n">start</span><span class="p">,</span>
                                                                     <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#xi = x1</span>
        <span class="n">interp_values1</span> <span class="o">=</span> <span class="n">y1</span>
        <span class="n">interp_values2</span> <span class="o">=</span> <span class="n">y2</span>

    <span class="c1">#Make sure that these vectors are not empty, otherwise return an error</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">interp_values1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">interp_values2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;No common time period between the two time series.&quot;</span><span class="p">)</span>

    <span class="n">r</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Stats</span><span class="o">.</span><span class="n">corrsig</span><span class="p">(</span><span class="n">interp_values1</span><span class="p">,</span><span class="n">interp_values2</span><span class="p">,</span><span class="n">nsim</span><span class="o">=</span><span class="n">nsim</span><span class="p">,</span>
                                 <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">r</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">p</span></div>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Timeseries manipulation</span>
<span class="sd">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="binTs"><a class="viewcode-back" href="../Main.html#pyleoclim.binTs">[docs]</a><span class="k">def</span> <span class="nf">binTs</span><span class="p">(</span><span class="n">timeseries</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">x_axis</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">bin_size</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Bin the paleoData values of the timeseries</span>

<span class="sd">    Args:</span>
<span class="sd">        timeseries. By default, will prompt the user for one.</span>
<span class="sd">        x-axis (str): The representation against which to plot the paleo-data.</span>
<span class="sd">            Options are &quot;age&quot;, &quot;year&quot;, and &quot;depth&quot;. Default is to let the</span>
<span class="sd">            system  choose if only one available or prompt the user.</span>
<span class="sd">        bin_size (float): the size of the bins to be used. By default,</span>
<span class="sd">            will prompt for one</span>
<span class="sd">        start (float): Start time/age/depth. Default is the minimum</span>
<span class="sd">        end (float): End time/age/depth. Default is the maximum</span>

<span class="sd">    Returns:</span>
<span class="sd">        binned_values- the binned output,\n</span>
<span class="sd">        bins-  the bins (centered on the median, i.e. the 100-200 bin is 150),\n</span>
<span class="sd">        n-  number of data points in each bin,\n</span>
<span class="sd">        error- the standard error on the mean in each bin\n</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">timeseries</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;ts_list&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
            <span class="n">extractTs</span><span class="p">()</span>
        <span class="n">timeseries</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">getTs</span><span class="p">(</span><span class="n">ts_list</span><span class="p">)</span>

    <span class="c1"># Get the values</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">timeseries</span><span class="p">[</span><span class="s1">&#39;paleoData_values&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">checkXaxis</span><span class="p">(</span><span class="n">timeseries</span><span class="p">,</span> <span class="n">x_axis</span><span class="o">=</span><span class="n">x_axis</span><span class="p">)</span>

    <span class="c1">#remove nans</span>
    <span class="n">y_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_temp</span><span class="p">)]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_temp</span><span class="p">)]</span>
    
    <span class="c1">#Bin the timeseries:</span>
    <span class="n">bins</span><span class="p">,</span> <span class="n">binned_values</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">Timeseries</span><span class="o">.</span><span class="n">bin</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">bin_size</span> <span class="o">=</span> <span class="n">bin_size</span><span class="p">,</span>\
                                                   <span class="n">start</span> <span class="o">=</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">end</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bins</span><span class="p">,</span> <span class="n">binned_values</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">error</span></div>

<div class="viewcode-block" id="interpTs"><a class="viewcode-back" href="../Main.html#pyleoclim.interpTs">[docs]</a><span class="k">def</span> <span class="nf">interpTs</span><span class="p">(</span><span class="n">timeseries</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">x_axis</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">interp_step</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Simple linear interpolation</span>

<span class="sd">    Simple linear interpolation of the data using the numpy.interp method</span>

<span class="sd">    Args:</span>
<span class="sd">        timeseries. Default is blank, will prompt for it</span>
<span class="sd">        x-axis (str): The representation against which to plot the paleo-data.</span>
<span class="sd">            Options are &quot;age&quot;, &quot;year&quot;, and &quot;depth&quot;. Default is to let the</span>
<span class="sd">            system choose if only one available or prompt the user.</span>
<span class="sd">        interp_step (float): the step size. By default, will prompt the user.</span>
<span class="sd">        start (float): Start year/age/depth. Default is the minimum</span>
<span class="sd">        end (float): End year/age/depth. Default is the maximum</span>

<span class="sd">    Returns:</span>
<span class="sd">        interp_age - the interpolated age/year/depth according to the end/start</span>
<span class="sd">        and time step, \n</span>
<span class="sd">        interp_values - the interpolated values</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">timeseries</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;ts_list&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
            <span class="n">extractTs</span><span class="p">()</span>
        <span class="n">timeseries</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">getTs</span><span class="p">(</span><span class="n">ts_list</span><span class="p">)</span>

    <span class="c1"># Get the values</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">timeseries</span><span class="p">[</span><span class="s1">&#39;paleoData_values&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">checkXaxis</span><span class="p">(</span><span class="n">timeseries</span><span class="p">,</span> <span class="n">x_axis</span><span class="o">=</span><span class="n">x_axis</span><span class="p">)</span>

    <span class="c1">#remove nans</span>
    <span class="n">y_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_temp</span><span class="p">)]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_temp</span><span class="p">)]</span>

    <span class="c1">#Interpolate the timeseries</span>
    <span class="n">interp_age</span><span class="p">,</span> <span class="n">interp_values</span> <span class="o">=</span> <span class="n">Timeseries</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">interp_step</span> <span class="o">=</span> <span class="n">interp_step</span><span class="p">,</span>\
                                                  <span class="n">start</span><span class="o">=</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">interp_age</span><span class="p">,</span> <span class="n">interp_values</span></div>

<div class="viewcode-block" id="standardizeTs"><a class="viewcode-back" href="../Main.html#pyleoclim.standardizeTs">[docs]</a><span class="k">def</span> <span class="nf">standardizeTs</span><span class="p">(</span><span class="n">timeseries</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ddof</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Centers and normalizes the paleoData values of a  given time series.</span>

<span class="sd">    Constant or nearly constant time series not rescaled.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (array): vector of (real) numbers as a time series, NaNs allowed</span>
<span class="sd">        scale (real): a scale factor used to scale a record to a match a given variance</span>
<span class="sd">        axis (int or None): axis along which to operate, if None, compute over the whole array</span>
<span class="sd">        ddof (int): degress of freedom correction in the calculation of the standard deviation</span>
<span class="sd">        eps (real): a threshold to determine if the standard deviation is too close to zero</span>

<span class="sd">    Returns:</span>
<span class="sd">        - z (array): the standardized time series (z-score), Z = (X - E[X])/std(X)*scale, NaNs allowed \n</span>
<span class="sd">        - mu (real): the mean of the original time series, E[X] \n</span>
<span class="sd">        - sig (real): the standard deviation of the original time series, std[X] \n</span>

<span class="sd">    References:</span>
<span class="sd">        1. Tapio Schneider&#39;s MATLAB code: http://www.clidyn.ethz.ch/imputation/standardize.m</span>
<span class="sd">        2. The zscore function in SciPy: https://github.com/scipy/scipy/blob/master/scipy/stats/stats.py</span>

<span class="sd">    @author: fzhu</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">timeseries</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;ts_list&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
            <span class="n">extractTs</span><span class="p">()</span>
        <span class="n">timeseries</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">getTs</span><span class="p">(</span><span class="n">ts_list</span><span class="p">)</span>

    <span class="c1"># get the values</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">timeseries</span><span class="p">[</span><span class="s1">&#39;paleoData_values&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>

    <span class="c1"># Remove NaNs</span>
    <span class="n">y_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_temp</span><span class="p">)]</span>

    <span class="c1">#Standardize</span>
    <span class="n">z</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sig</span> <span class="o">=</span> <span class="n">Timeseries</span><span class="o">.</span><span class="n">standardize</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">eps</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">z</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sig</span></div>

<span class="k">def</span> <span class="nf">segmentTs</span><span class="p">(</span><span class="n">timeseries</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">factor</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Divides a time series into several segments using a gap detection algorithm</span>
<span class="sd">    </span>
<span class="sd">    Gap detection rule: If the time interval between some two data points is</span>
<span class="sd">    larger than some factor times the mean resolution of the timeseries, then</span>
<span class="sd">    a brak point is applied and the timseries is divided. </span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        timeseries: a LiPD timeseries object</span>
<span class="sd">        factor (float): factor to adjust the threshold. threshold = factor*dt_mean.</span>
<span class="sd">            Default is 2.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        seg_y (list) - a list of several segments with potentially different length</span>
<span class="sd">        seg_t (list) - A list of the time values for each y segment. </span>
<span class="sd">        n_segs (int) - the number of segments</span>
<span class="sd">        </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">timeseries</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;ts_list&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
            <span class="n">extractTs</span><span class="p">()</span>
        <span class="n">timeseries</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">getTs</span><span class="p">(</span><span class="n">ts_list</span><span class="p">)</span>
        
    <span class="c1"># Get the values</span>
    <span class="c1"># Raise an error if age or year not in the keys</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;age&#39;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;year&#39;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;No time information available&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;age&#39;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;year&#39;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Both age and year information are available.&quot;</span><span class="p">)</span>
        <span class="n">x_axis</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Which one would you like to use? &quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">x_axis</span> <span class="o">!=</span> <span class="s2">&quot;year&quot;</span> <span class="ow">and</span> <span class="n">x_axis</span> <span class="o">!=</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span>
            <span class="n">x_axis</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Only enter year or age: &quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;age&#39;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">x_axis</span> <span class="o">=</span> <span class="s1">&#39;age&#39;</span>
    <span class="k">elif</span> <span class="s1">&#39;year&#39;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">x_axis</span> <span class="o">=</span> <span class="s1">&#39;year&#39;</span>        
    
    <span class="c1"># Get the values</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">timeseries</span><span class="p">[</span><span class="s1">&#39;paleoData_values&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span> 
    <span class="n">ts</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">checkXaxis</span><span class="p">(</span><span class="n">timeseries</span><span class="p">,</span> <span class="n">x_axis</span><span class="o">=</span><span class="n">x_axis</span><span class="p">)</span>
    
    <span class="c1"># remove NaNs</span>
    <span class="n">ys_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">ys</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ys_temp</span><span class="p">)]</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ys_temp</span><span class="p">)]</span>   

    <span class="c1">#segment the timeseries</span>
    <span class="n">seg_y</span><span class="p">,</span> <span class="n">seg_t</span><span class="p">,</span> <span class="n">n_segs</span> <span class="o">=</span> <span class="n">Timeseries</span><span class="o">.</span><span class="n">ts2segments</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">seg_y</span><span class="p">,</span> <span class="n">seg_t</span><span class="p">,</span> <span class="n">n_segs</span>        

<span class="c1">#&quot;&quot;&quot;</span>
<span class="c1"># Spectral Analysis</span>
<span class="c1">#&quot;&quot;&quot;</span>

<div class="viewcode-block" id="wwzTs"><a class="viewcode-back" href="../Main.html#pyleoclim.wwzTs">[docs]</a><span class="k">def</span> <span class="nf">wwzTs</span><span class="p">(</span><span class="n">timeseries</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">wwz</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">psd</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">wwz_default</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
          <span class="n">psd_default</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">wwaplot_default</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">psdplot_default</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
          <span class="n">fig</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">saveFig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="nb">dir</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;eps&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Weigthed wavelet Z-transform analysis</span>
<span class="sd">    </span>
<span class="sd">    Wavelet analysis for unevenly spaced data adapted from Foster et al. (1996)</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        timeseries (dict): A LiPD timeseries object (Optional, will prompt for one.)</span>
<span class="sd">        wwz (bool): If True, will perform wavelet analysis</span>
<span class="sd">        psd (bool): If True, will inform the power spectral density of the timeseries</span>
<span class="sd">        wwz_default: If True, will use the following default parameters:</span>
<span class="sd">            </span>
<span class="sd">            wwz_default = {&#39;tau&#39;:None,&#39;freqs&#39;:None,&#39;c&#39;:1/(8*np.pi**2),&#39;Neff&#39;:3,&#39;nMC&#39;:200,</span>
<span class="sd">                               &#39;nproc&#39;:8,&#39;detrend&#39;:&#39;no&#39;,&#39;method&#39;:&#39;Kirchner_f2py&#39;}.</span>
<span class="sd">                </span>
<span class="sd">            Modify the values for specific keys to change the default behavior.</span>
<span class="sd">                </span>
<span class="sd">        psd_default: If True, will use the following default parameters:</span>
<span class="sd">            </span>
<span class="sd">            psd_default = {&#39;tau&#39;:None,</span>
<span class="sd">                          &#39;freqs&#39;: None,</span>
<span class="sd">                          &#39;c&#39;:1e-3,</span>
<span class="sd">                          &#39;nproc&#39;:8,</span>
<span class="sd">                          &#39;nMC&#39;:200,</span>
<span class="sd">                          &#39;detrend&#39;:&#39;no&#39;,</span>
<span class="sd">                          &#39;Neff&#39;:3,</span>
<span class="sd">                          &#39;anti_alias&#39;:False,</span>
<span class="sd">                          &#39;avgs&#39;:2,</span>
<span class="sd">                          &#39;method&#39;:&#39;Kirchner_f2py&#39;}</span>
<span class="sd">            </span>
<span class="sd">            Modify the values for specific keys to change the default behavior.</span>
<span class="sd">            </span>
<span class="sd">        wwaplot_default: If True, will use the following default parameters:</span>
<span class="sd">            </span>
<span class="sd">            wwaplot_default={&#39;Neff&#39;:3,</span>
<span class="sd">                                 &#39;AR1_q&#39;:AR1_q,</span>
<span class="sd">                                 &#39;coi&#39;:coi,</span>
<span class="sd">                                 &#39;levels&#39;:None,</span>
<span class="sd">                                 &#39;tick_range&#39;:None,</span>
<span class="sd">                                 &#39;yticks&#39;:None,</span>
<span class="sd">                                 &#39;ylim&#39;:None,</span>
<span class="sd">                                 &#39;xticks&#39;:None,</span>
<span class="sd">                                 &#39;xlabels&#39;:None,</span>
<span class="sd">                                 &#39;figsize&#39;:[20,8],</span>
<span class="sd">                                 &#39;clr_map&#39;:&#39;OrRd&#39;,</span>
<span class="sd">                                 &#39;cbar_drawedges&#39;:False,</span>
<span class="sd">                                 &#39;cone_alpha&#39;:0.5,</span>
<span class="sd">                                 &#39;plot_signif&#39;:True,</span>
<span class="sd">                                 &#39;signif_style&#39;:&#39;contour&#39;,</span>
<span class="sd">                                 &#39;plot_cone&#39;:True}</span>
<span class="sd">            </span>
<span class="sd">            Modify the values for specific keys to change the default behavior.</span>
<span class="sd">        psdplot_default: If True, will use the following default parameters:</span>
<span class="sd">            </span>
<span class="sd">            psdplot_default={&#39;lmstyle&#39;:None,</span>
<span class="sd">                             &#39;linewidth&#39;:None,</span>
<span class="sd">                             &#39;xticks&#39;:None,</span>
<span class="sd">                             &#39;xlim&#39;:None,</span>
<span class="sd">                             &#39;ylim&#39;:None,</span>
<span class="sd">                             &#39;figsize&#39;:[20,8],</span>
<span class="sd">                             &#39;label&#39;:&#39;PSD&#39;,</span>
<span class="sd">                             &#39;plot_ar1&#39;:True,</span>
<span class="sd">                             &#39;psd_ar1_q95&#39;:psd_ar1_q95,</span>
<span class="sd">                             &#39;psd_ar1_color&#39;:sns.xkcd_rgb[&quot;pale red&quot;]}</span>
<span class="sd">            </span>
<span class="sd">            Modify the values for specific keys to change the default behavior.</span>
<span class="sd">            </span>
<span class="sd">        fig (bool): If True, plots the figure</span>
<span class="sd">        saveFig (bool): default is to not save the figure</span>
<span class="sd">        dir (str): the full path of the directory in which to save the figure.</span>
<span class="sd">            If not provided, creates a default folder called &#39;figures&#39; in the</span>
<span class="sd">            LiPD working directory (lipd.path).</span>
<span class="sd">        format (str): One of the file extensions supported by the active</span>
<span class="sd">            backend. Default is &quot;eps&quot;. Most backend support png, pdf, ps, eps,</span>
<span class="sd">            and svg.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        dict_out (dict): A dictionary of outputs. </span>
<span class="sd">            </span>
<span class="sd">            For wwz: </span>
<span class="sd">            </span>
<span class="sd">            - wwa (array): The weights wavelet amplitude </span>
<span class="sd">        </span>
<span class="sd">            - AR1_q (array): AR1 simulations </span>
<span class="sd">        </span>
<span class="sd">            - coi (array): cone of influence </span>
<span class="sd">        </span>
<span class="sd">            - freqs (array): vector for frequencies </span>
<span class="sd">        </span>
<span class="sd">            - tau (array): the evenly-spaced time points, namely the time </span>
<span class="sd">            shift for wavelet analysis. </span>
<span class="sd">        </span>
<span class="sd">            - Neffs (array): The matrix of effective number of points in the</span>
<span class="sd">            time-scale coordinates.</span>
<span class="sd">        </span>
<span class="sd">            - coeff (array): The wavelet transform coefficients</span>
<span class="sd">        </span>
<span class="sd">            For psd: </span>
<span class="sd">            </span>
<span class="sd">            - psd (array): power spectral density </span>
<span class="sd">        </span>
<span class="sd">            - freqs (array): vector of frequency </span>
<span class="sd">        </span>
<span class="sd">            - psd_ar1_q95 (array): the 95% quantile of the psds of AR1 processes </span>
<span class="sd">        </span>
<span class="sd">        fig: The figure</span>
<span class="sd">         </span>
<span class="sd">        References:</span>
<span class="sd">            Foster, G. (1996). Wavelets for period analysis of unevenly </span>
<span class="sd">            sampled time series. The Astronomical Journal, 112(4), 1709-1729.</span>
<span class="sd">        </span>
<span class="sd">        Examples:</span>
<span class="sd">            To run both wwz and psd: \n</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; dict_out, fig = pyleoclim.wwzTs(wwz=True)</span>
<span class="sd">            </span>
<span class="sd">            Note: This will return a single figure with wwa and psd \n</span>
<span class="sd">            </span>
<span class="sd">            To change a default behavior:\n</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; dict_out, fig = pyleoclim.wwzTs(psd_default = {&#39;nMC&#39;:1000}) </span>
<span class="sd">           </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Make sure there is something to compute</span>
    <span class="k">if</span> <span class="n">wwz</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">psd</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Set &#39;wwz&#39; and/or &#39;psd&#39; to True&quot;</span><span class="p">)</span>
    
    <span class="c1"># Get a timeseries</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">timeseries</span><span class="p">:</span> 
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;ts_list&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
            <span class="n">extractTs</span><span class="p">()</span>
        <span class="n">timeseries</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">getTs</span><span class="p">(</span><span class="n">ts_list</span><span class="p">)</span>
    
    <span class="c1"># Raise an error if age or year not in the keys</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;age&#39;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;year&#39;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;No time information available&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;age&#39;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;year&#39;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Both age and year information are available.&quot;</span><span class="p">)</span>
        <span class="n">x_axis</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Which one would you like to use? &quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">x_axis</span> <span class="o">!=</span> <span class="s2">&quot;year&quot;</span> <span class="ow">and</span> <span class="n">x_axis</span> <span class="o">!=</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span>
            <span class="n">x_axis</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Only enter year or age: &quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;age&#39;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">x_axis</span> <span class="o">=</span> <span class="s1">&#39;age&#39;</span>
    <span class="k">elif</span> <span class="s1">&#39;year&#39;</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">x_axis</span> <span class="o">=</span> <span class="s1">&#39;year&#39;</span>

    <span class="c1"># Set the defaults</span>
    <span class="c1">#Make sure the default have the proper type </span>
    <span class="k">if</span> <span class="n">psd_default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">psd_default</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;The default for the psd calculation should either be provided&#39;</span><span class="o">+</span>
                 <span class="s1">&#39; as a dictionary are set to True&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">psdplot_default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">psdplot_default</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;The default for the psd figure should either be provided&#39;</span><span class="o">+</span>
                 <span class="s1">&#39; as a dictionary are set to True&#39;</span><span class="p">)</span>  
    <span class="k">if</span> <span class="n">wwz_default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">wwz_default</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;The default for the wwz calculation should either be provided&#39;</span><span class="o">+</span>
                 <span class="s1">&#39; as a dictionary are set to True&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wwaplot_default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">wwaplot_default</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;The default for the wwa figure should either be provided&#39;</span><span class="o">+</span>
                 <span class="s1">&#39; as a dictionary are set to True&#39;</span><span class="p">)</span>

    <span class="c1"># Get the values</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">timeseries</span><span class="p">[</span><span class="s1">&#39;paleoData_values&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span> 
    <span class="n">ts</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">LipdUtils</span><span class="o">.</span><span class="n">checkXaxis</span><span class="p">(</span><span class="n">timeseries</span><span class="p">,</span> <span class="n">x_axis</span><span class="o">=</span><span class="n">x_axis</span><span class="p">)</span>
    
    <span class="c1"># remove NaNs</span>
    <span class="n">ys_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">ys</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ys_temp</span><span class="p">)]</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ys_temp</span><span class="p">)]</span>   
    
    <span class="c1">#Get the time units</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[</span><span class="n">label</span><span class="o">+</span><span class="s2">&quot;Units&quot;</span><span class="p">]</span>
    <span class="n">ageunits</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)]</span>  
    
    <span class="c1"># Perform the calculations</span>
    <span class="k">if</span> <span class="n">psd</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">wwz</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span> <span class="c1"># PSD only</span>
        
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">psd_default</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">dict_in</span> <span class="o">=</span> <span class="n">psd_default</span>
            
            <span class="n">psd_default</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tau&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                       <span class="s1">&#39;freqs&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mf">1e-3</span><span class="p">,</span>
                       <span class="s1">&#39;nproc&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span>
                       <span class="s1">&#39;nMC&#39;</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span>
                       <span class="s1">&#39;detrend&#39;</span><span class="p">:</span><span class="s1">&#39;no&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Neff&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                       <span class="s1">&#39;anti_alias&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
                       <span class="s1">&#39;avgs&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                       <span class="s1">&#39;method&#39;</span><span class="p">:</span><span class="s1">&#39;Kirchner_f2py&#39;</span><span class="p">,</span>
                       <span class="p">}</span>
            
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dict_in</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">psd_default</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">psd_default</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        
        <span class="k">else</span><span class="p">:</span>
          <span class="n">psd_default</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tau&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                       <span class="s1">&#39;freqs&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mf">1e-3</span><span class="p">,</span>
                       <span class="s1">&#39;nproc&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span>
                       <span class="s1">&#39;nMC&#39;</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span>
                       <span class="s1">&#39;detrend&#39;</span><span class="p">:</span><span class="s1">&#39;no&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Neff&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                       <span class="s1">&#39;anti_alias&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
                       <span class="s1">&#39;avgs&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                       <span class="s1">&#39;method&#39;</span><span class="p">:</span><span class="s1">&#39;Kirchner_f2py&#39;</span><span class="p">,</span>
                       <span class="p">}</span>
            
        <span class="c1"># Perform calculation</span>
        <span class="n">psd</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">psd_ar1_q95</span> <span class="o">=</span> <span class="n">Spectral</span><span class="o">.</span><span class="n">wwz_psd</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="o">**</span><span class="n">psd_default</span><span class="p">)</span>
        
        <span class="c1"># Wrap up the output dictionary</span>
        <span class="n">dict_out</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;psd&#39;</span><span class="p">:</span><span class="n">psd</span><span class="p">,</span>
               <span class="s1">&#39;freqs&#39;</span><span class="p">:</span><span class="n">freqs</span><span class="p">,</span>
               <span class="s1">&#39;psd_ar1_q95&#39;</span><span class="p">:</span><span class="n">psd_ar1_q95</span><span class="p">}</span>
        
        <span class="c1"># Plot if asked</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">psdplot_default</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="n">dict_in</span> <span class="o">=</span> <span class="n">psdplot_default</span>
                
                <span class="n">psdplot_default</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lmstyle&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;xticks&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;xlim&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;ylim&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;figsize&#39;</span><span class="p">:[</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
                                 <span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;PSD&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;plot_ar1&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="s1">&#39;psd_ar1_q95&#39;</span><span class="p">:</span><span class="n">psd_ar1_q95</span><span class="p">,</span>
                                 <span class="s1">&#39;psd_ar1_color&#39;</span><span class="p">:</span><span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s2">&quot;pale red&quot;</span><span class="p">],</span>
                                 <span class="s1">&#39;ax&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;xlabel&#39;</span><span class="p">:</span><span class="s1">&#39;Period (&#39;</span><span class="o">+</span><span class="n">ageunits</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;ylabel&#39;</span><span class="p">:</span><span class="s1">&#39;Spectral Density&#39;</span><span class="p">}</span>        
                                
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dict_in</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">psdplot_default</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">psdplot_default</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                        
            <span class="k">else</span><span class="p">:</span>
                   
               <span class="n">psdplot_default</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lmstyle&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;xticks&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;xlim&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;ylim&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;figsize&#39;</span><span class="p">:[</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
                                 <span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;PSD&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;plot_ar1&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="s1">&#39;psd_ar1_q95&#39;</span><span class="p">:</span><span class="n">psd_ar1_q95</span><span class="p">,</span>
                                 <span class="s1">&#39;psd_ar1_color&#39;</span><span class="p">:</span><span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s2">&quot;pale red&quot;</span><span class="p">],</span>
                                 <span class="s1">&#39;ax&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;xlabel&#39;</span><span class="p">:</span><span class="s1">&#39;Period (&#39;</span><span class="o">+</span><span class="n">ageunits</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;ylabel&#39;</span><span class="p">:</span><span class="s1">&#39;Spectral Density&#39;</span><span class="p">}</span>                 
                
            <span class="n">fig</span> <span class="o">=</span> <span class="n">Spectral</span><span class="o">.</span><span class="n">plot_psd</span><span class="p">(</span><span class="n">psd</span><span class="p">,</span><span class="n">freqs</span><span class="p">,</span><span class="o">**</span><span class="n">psdplot_default</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">saveFig</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">LipdUtils</span><span class="o">.</span><span class="n">saveFigure</span><span class="p">(</span><span class="n">timeseries</span><span class="p">[</span><span class="s1">&#39;dataSetName&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_PSDplot&#39;</span><span class="p">,</span><span class="nb">format</span><span class="p">,</span><span class="nb">dir</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span>               
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="kc">None</span>
             
    <span class="k">elif</span> <span class="n">psd</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">wwz</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span> <span class="c1">#WWZ only   </span>
        <span class="c1"># Set default </span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">wwz_default</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">dict_in</span> <span class="o">=</span> <span class="n">wwz_default</span>
            
            <span class="n">wwz_default</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tau&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                           <span class="s1">&#39;freqs&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                           <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
                           <span class="s1">&#39;Neff&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                           <span class="s1">&#39;nMC&#39;</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span>
                           <span class="s1">&#39;nproc&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span>
                           <span class="s1">&#39;detrend&#39;</span><span class="p">:</span><span class="s1">&#39;no&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;method&#39;</span><span class="p">:</span><span class="s1">&#39;Kirchner_f2py&#39;</span><span class="p">}</span>
            
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">dict_in</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">wwz_default</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">wwz_default</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
        
        <span class="k">else</span><span class="p">:</span>  
            
            <span class="n">wwz_default</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tau&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                           <span class="s1">&#39;freqs&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                           <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
                           <span class="s1">&#39;Neff&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                           <span class="s1">&#39;nMC&#39;</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span>
                           <span class="s1">&#39;nproc&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span>
                           <span class="s1">&#39;detrend&#39;</span><span class="p">:</span><span class="s1">&#39;no&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;method&#39;</span><span class="p">:</span><span class="s1">&#39;Kirchner_f2py&#39;</span><span class="p">}</span>
        
        <span class="c1">#Perform the calculation</span>
        <span class="n">wwa</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">AR1_q</span><span class="p">,</span> <span class="n">coi</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">Neffs</span><span class="p">,</span> <span class="n">coeff</span> <span class="o">=</span> <span class="n">Spectral</span><span class="o">.</span><span class="n">wwz</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span><span class="n">ts</span><span class="p">,</span> <span class="o">**</span><span class="n">wwz_default</span><span class="p">)</span>
        
        <span class="c1">#Wrap up the output dictionary</span>
        <span class="n">dict_out</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;wwa&#39;</span><span class="p">:</span><span class="n">wwa</span><span class="p">,</span>
                    <span class="s1">&#39;phase&#39;</span><span class="p">:</span><span class="n">phase</span><span class="p">,</span>
                    <span class="s1">&#39;AR1_q&#39;</span><span class="p">:</span><span class="n">AR1_q</span><span class="p">,</span>
                    <span class="s1">&#39;coi&#39;</span><span class="p">:</span><span class="n">coi</span><span class="p">,</span>
                    <span class="s1">&#39;freqs&#39;</span><span class="p">:</span><span class="n">freqs</span><span class="p">,</span>
                    <span class="s1">&#39;tau&#39;</span><span class="p">:</span><span class="n">tau</span><span class="p">,</span>
                    <span class="s1">&#39;Neffs&#39;</span><span class="p">:</span><span class="n">Neffs</span><span class="p">,</span>
                    <span class="s1">&#39;coeff&#39;</span><span class="p">:</span><span class="n">coeff</span><span class="p">}</span>
        
        <span class="c1">#PLot if asked</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># Set the plot default</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">wwaplot_default</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="n">dict_in</span> <span class="o">=</span> <span class="n">wwaplot_default</span>
                <span class="n">wwaplot_default</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Neff&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                                 <span class="s1">&#39;AR1_q&#39;</span><span class="p">:</span><span class="n">AR1_q</span><span class="p">,</span>
                                 <span class="s1">&#39;coi&#39;</span><span class="p">:</span><span class="n">coi</span><span class="p">,</span>
                                 <span class="s1">&#39;levels&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;tick_range&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;yticks&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;ylim&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;xticks&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;xlabels&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;figsize&#39;</span><span class="p">:[</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
                                 <span class="s1">&#39;clr_map&#39;</span><span class="p">:</span><span class="s1">&#39;OrRd&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;cbar_drawedges&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
                                 <span class="s1">&#39;cone_alpha&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span>
                                 <span class="s1">&#39;plot_signif&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="s1">&#39;signif_style&#39;</span><span class="p">:</span><span class="s1">&#39;contour&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;plot_cone&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="s1">&#39;ax&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;xlabel&#39;</span><span class="p">:</span> <span class="n">label</span><span class="o">.</span><span class="n">upper</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">label</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="s1">&#39;(&#39;</span><span class="o">+</span><span class="n">s</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;ylabel&#39;</span><span class="p">:</span> <span class="s1">&#39;Period (&#39;</span><span class="o">+</span><span class="n">ageunits</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">}</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dict_in</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">wwaplot_default</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">wwaplot_default</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wwaplot_default</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Neff&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                                 <span class="s1">&#39;AR1_q&#39;</span><span class="p">:</span><span class="n">AR1_q</span><span class="p">,</span>
                                 <span class="s1">&#39;coi&#39;</span><span class="p">:</span><span class="n">coi</span><span class="p">,</span>
                                 <span class="s1">&#39;levels&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;tick_range&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;yticks&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;ylim&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;xticks&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;xlabels&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;figsize&#39;</span><span class="p">:[</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
                                 <span class="s1">&#39;clr_map&#39;</span><span class="p">:</span><span class="s1">&#39;OrRd&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;cbar_drawedges&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
                                 <span class="s1">&#39;cone_alpha&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span>
                                 <span class="s1">&#39;plot_signif&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="s1">&#39;signif_style&#39;</span><span class="p">:</span><span class="s1">&#39;contour&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;plot_cone&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="s1">&#39;ax&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;xlabel&#39;</span><span class="p">:</span> <span class="n">label</span><span class="o">.</span><span class="n">upper</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">label</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="s1">&#39;(&#39;</span><span class="o">+</span><span class="n">s</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;ylabel&#39;</span><span class="p">:</span> <span class="s1">&#39;Period (&#39;</span><span class="o">+</span><span class="n">ageunits</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">}</span>
            
            <span class="n">fig</span> <span class="o">=</span> <span class="n">Spectral</span><span class="o">.</span><span class="n">plot_wwa</span><span class="p">(</span><span class="n">wwa</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="o">**</span><span class="n">wwaplot_default</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">saveFig</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">LipdUtils</span><span class="o">.</span><span class="n">saveFigure</span><span class="p">(</span><span class="n">timeseries</span><span class="p">[</span><span class="s1">&#39;dataSetName&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_PSDplot&#39;</span><span class="p">,</span><span class="nb">format</span><span class="p">,</span><span class="nb">dir</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span>               
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="k">elif</span> <span class="n">psd</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">wwz</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span> <span class="c1"># perform both</span>
    
        <span class="c1"># Set the defaults</span>
        
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">psd_default</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">dict_in</span> <span class="o">=</span> <span class="n">psd_default</span>
            
            <span class="n">psd_default</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tau&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                       <span class="s1">&#39;freqs&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mf">1e-3</span><span class="p">,</span>
                       <span class="s1">&#39;nproc&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span>
                       <span class="s1">&#39;nMC&#39;</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span>
                       <span class="s1">&#39;detrend&#39;</span><span class="p">:</span><span class="s1">&#39;no&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Neff&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                       <span class="s1">&#39;anti_alias&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
                       <span class="s1">&#39;avgs&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                       <span class="s1">&#39;method&#39;</span><span class="p">:</span><span class="s1">&#39;Kirchner_f2py&#39;</span><span class="p">,</span>
                       <span class="p">}</span>
            
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dict_in</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">psd_default</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">psd_default</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        
        <span class="k">else</span><span class="p">:</span>
          <span class="n">psd_default</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tau&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                       <span class="s1">&#39;freqs&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mf">1e-3</span><span class="p">,</span>
                       <span class="s1">&#39;nproc&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span>
                       <span class="s1">&#39;nMC&#39;</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span>
                       <span class="s1">&#39;detrend&#39;</span><span class="p">:</span><span class="s1">&#39;no&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Neff&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                       <span class="s1">&#39;anti_alias&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
                       <span class="s1">&#39;avgs&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                       <span class="s1">&#39;method&#39;</span><span class="p">:</span><span class="s1">&#39;Kirchner_f2py&#39;</span><span class="p">,</span>
                       <span class="p">}</span>
           
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">wwz_default</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">dict_in</span> <span class="o">=</span> <span class="n">wwz_default</span>
            
            <span class="n">wwz_default</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tau&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                           <span class="s1">&#39;freqs&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                           <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
                           <span class="s1">&#39;Neff&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                           <span class="s1">&#39;nMC&#39;</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span>
                           <span class="s1">&#39;nproc&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span>
                           <span class="s1">&#39;detrend&#39;</span><span class="p">:</span><span class="s1">&#39;no&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;method&#39;</span><span class="p">:</span><span class="s1">&#39;Kirchner_f2py&#39;</span><span class="p">}</span>
            
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">dict_in</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">wwz_default</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">wwz_default</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
        
        <span class="k">else</span><span class="p">:</span>  
            
            <span class="n">wwz_default</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tau&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                           <span class="s1">&#39;freqs&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                           <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
                           <span class="s1">&#39;Neff&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                           <span class="s1">&#39;nMC&#39;</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span>
                           <span class="s1">&#39;nproc&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span>
                           <span class="s1">&#39;detrend&#39;</span><span class="p">:</span><span class="s1">&#39;no&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;method&#39;</span><span class="p">:</span><span class="s1">&#39;Kirchner_f2py&#39;</span><span class="p">}</span>
            
        <span class="c1"># Perform the calculations</span>
        <span class="n">psd</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">psd_ar1_q95</span> <span class="o">=</span> <span class="n">Spectral</span><span class="o">.</span><span class="n">wwz_psd</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="o">**</span><span class="n">psd_default</span><span class="p">)</span>
        <span class="n">wwa</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">AR1_q</span><span class="p">,</span> <span class="n">coi</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">Neffs</span><span class="p">,</span> <span class="n">coeff</span> <span class="o">=</span> <span class="n">Spectral</span><span class="o">.</span><span class="n">wwz</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span><span class="n">ts</span><span class="p">,</span> <span class="o">**</span><span class="n">wwz_default</span><span class="p">)</span>
          
        <span class="c1">#Wrap up the output dictionary</span>
        <span class="n">dict_out</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;wwa&#39;</span><span class="p">:</span><span class="n">wwa</span><span class="p">,</span>
                    <span class="s1">&#39;phase&#39;</span><span class="p">:</span><span class="n">phase</span><span class="p">,</span>
                    <span class="s1">&#39;AR1_q&#39;</span><span class="p">:</span><span class="n">AR1_q</span><span class="p">,</span>
                    <span class="s1">&#39;coi&#39;</span><span class="p">:</span><span class="n">coi</span><span class="p">,</span>
                    <span class="s1">&#39;freqs&#39;</span><span class="p">:</span><span class="n">freqs</span><span class="p">,</span>
                    <span class="s1">&#39;tau&#39;</span><span class="p">:</span><span class="n">tau</span><span class="p">,</span>
                    <span class="s1">&#39;Neffs&#39;</span><span class="p">:</span><span class="n">Neffs</span><span class="p">,</span>
                    <span class="s1">&#39;coeff&#39;</span><span class="p">:</span><span class="n">coeff</span><span class="p">,</span>
                    <span class="s1">&#39;psd&#39;</span><span class="p">:</span><span class="n">psd</span><span class="p">,</span>
                    <span class="s1">&#39;psd_ar1_q95&#39;</span><span class="p">:</span><span class="n">psd_ar1_q95</span><span class="p">}</span>
        
        <span class="c1"># Make the plot if asked</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">wwaplot_default</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">psdplot_default</span><span class="p">)</span><span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;figsize&#39;</span> <span class="ow">in</span> <span class="n">wwaplot_default</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">figsize</span> <span class="o">=</span> <span class="n">wwaplot_default</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="s1">&#39;figsize&#39;</span> <span class="ow">in</span> <span class="n">psdplot_default</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">figsize</span> <span class="o">=</span> <span class="n">psdplot_default</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span>    
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">wwaplot_default</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;figsize&#39;</span> <span class="ow">in</span> <span class="n">wwaplot_default</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">figsize</span> <span class="o">=</span> <span class="n">wwaplot_default</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">figsize</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">psdplot_default</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;figsize&#39;</span> <span class="ow">in</span> <span class="n">psdplot_default</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">figsize</span> <span class="o">=</span> <span class="n">psdplot_default</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">figsize</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span>    
                    
            
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">)</span>
            <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span> <span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
            <span class="c1"># Set the plot default</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">wwaplot_default</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="n">dict_in</span> <span class="o">=</span> <span class="n">wwaplot_default</span>
                <span class="n">wwaplot_default</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Neff&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                                 <span class="s1">&#39;AR1_q&#39;</span><span class="p">:</span><span class="n">AR1_q</span><span class="p">,</span>
                                 <span class="s1">&#39;coi&#39;</span><span class="p">:</span><span class="n">coi</span><span class="p">,</span>
                                 <span class="s1">&#39;levels&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;tick_range&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;yticks&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;ylim&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;xticks&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;xlabels&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;figsize&#39;</span><span class="p">:</span><span class="n">figsize</span><span class="p">,</span>
                                 <span class="s1">&#39;clr_map&#39;</span><span class="p">:</span><span class="s1">&#39;OrRd&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;cbar_drawedges&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
                                 <span class="s1">&#39;cone_alpha&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span>
                                 <span class="s1">&#39;plot_signif&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="s1">&#39;signif_style&#39;</span><span class="p">:</span><span class="s1">&#39;contour&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;plot_cone&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="s1">&#39;ax&#39;</span><span class="p">:</span><span class="n">ax1</span><span class="p">,</span>
                                 <span class="s1">&#39;xlabel&#39;</span><span class="p">:</span> <span class="n">label</span><span class="o">.</span><span class="n">upper</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">label</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="s1">&#39;(&#39;</span><span class="o">+</span><span class="n">s</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;ylabel&#39;</span><span class="p">:</span> <span class="s1">&#39;Period (&#39;</span><span class="o">+</span><span class="n">ageunits</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">}</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dict_in</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">wwaplot_default</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">wwaplot_default</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wwaplot_default</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Neff&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                                 <span class="s1">&#39;AR1_q&#39;</span><span class="p">:</span><span class="n">AR1_q</span><span class="p">,</span>
                                 <span class="s1">&#39;coi&#39;</span><span class="p">:</span><span class="n">coi</span><span class="p">,</span>
                                 <span class="s1">&#39;levels&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;tick_range&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;yticks&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;ylim&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;xticks&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;xlabels&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;figsize&#39;</span><span class="p">:</span><span class="n">figsize</span><span class="p">,</span>
                                 <span class="s1">&#39;clr_map&#39;</span><span class="p">:</span><span class="s1">&#39;OrRd&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;cbar_drawedges&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
                                 <span class="s1">&#39;cone_alpha&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span>
                                 <span class="s1">&#39;plot_signif&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="s1">&#39;signif_style&#39;</span><span class="p">:</span><span class="s1">&#39;contour&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;plot_cone&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="s1">&#39;ax&#39;</span><span class="p">:</span><span class="n">ax1</span><span class="p">,</span>
                                 <span class="s1">&#39;xlabel&#39;</span><span class="p">:</span> <span class="n">label</span><span class="o">.</span><span class="n">upper</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">label</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="s1">&#39;(&#39;</span><span class="o">+</span><span class="n">s</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;ylabel&#39;</span><span class="p">:</span> <span class="s1">&#39;Period (&#39;</span><span class="o">+</span><span class="n">ageunits</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">}</span>
                
            <span class="n">Spectral</span><span class="o">.</span><span class="n">plot_wwa</span><span class="p">(</span><span class="n">wwa</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="o">**</span><span class="n">wwaplot_default</span><span class="p">)</span>    
            
            <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">psdplot_default</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="n">dict_in</span> <span class="o">=</span> <span class="n">psdplot_default</span>
                
                <span class="n">psdplot_default</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lmstyle&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;xticks&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;xlim&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;ylim&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;figsize&#39;</span><span class="p">:</span><span class="n">figsize</span><span class="p">,</span>
                                 <span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;PSD&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;plot_ar1&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="s1">&#39;psd_ar1_q95&#39;</span><span class="p">:</span><span class="n">psd_ar1_q95</span><span class="p">,</span>
                                 <span class="s1">&#39;psd_ar1_color&#39;</span><span class="p">:</span><span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s2">&quot;pale red&quot;</span><span class="p">],</span>
                                 <span class="s1">&#39;ax&#39;</span><span class="p">:</span><span class="n">ax2</span><span class="p">,</span>
                                 <span class="s1">&#39;xlabel&#39;</span><span class="p">:</span><span class="s1">&#39;Period (&#39;</span><span class="o">+</span><span class="n">ageunits</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;ylabel&#39;</span><span class="p">:</span><span class="s1">&#39;Spectral Density&#39;</span><span class="p">}</span>        
                                
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dict_in</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">psdplot_default</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">psdplot_default</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                        
            <span class="k">else</span><span class="p">:</span>
                   
               <span class="n">psdplot_default</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lmstyle&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;xticks&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;xlim&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;ylim&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;figsize&#39;</span><span class="p">:</span><span class="n">figsize</span><span class="p">,</span>
                                 <span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;PSD&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;plot_ar1&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="s1">&#39;psd_ar1_q95&#39;</span><span class="p">:</span><span class="n">psd_ar1_q95</span><span class="p">,</span>
                                 <span class="s1">&#39;psd_ar1_color&#39;</span><span class="p">:</span><span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s2">&quot;pale red&quot;</span><span class="p">],</span>
                                 <span class="s1">&#39;ax&#39;</span><span class="p">:</span><span class="n">ax2</span><span class="p">,</span>
                                 <span class="s1">&#39;xlabel&#39;</span><span class="p">:</span><span class="s1">&#39;Period (&#39;</span><span class="o">+</span><span class="n">ageunits</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;ylabel&#39;</span><span class="p">:</span><span class="s1">&#39;Spectral Density&#39;</span><span class="p">}</span> 
            
            <span class="n">Spectral</span><span class="o">.</span><span class="n">plot_psd</span><span class="p">(</span><span class="n">psd</span><span class="p">,</span><span class="n">freqs</span><span class="p">,</span><span class="o">**</span><span class="n">psdplot_default</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">saveFig</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">LipdUtils</span><span class="o">.</span><span class="n">saveFigure</span><span class="p">(</span><span class="n">timeseries</span><span class="p">[</span><span class="s1">&#39;dataSetName&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_PSDplot&#39;</span><span class="p">,</span><span class="nb">format</span><span class="p">,</span><span class="nb">dir</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span>               
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="kc">None</span>
                         
    <span class="k">return</span> <span class="n">dict_out</span><span class="p">,</span> <span class="n">fig</span>   </div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Pyleoclim</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Introduction.html">Pyleoclim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Main.html">Main Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Map.html">Mapping Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Plot.html">Plotting Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Stats.html">Statistics Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Timeseries.html">Timeseries Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LipdUtils.html">LiPD Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SummaryPlots.html">Summary Plots</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Spectral.html">Spectral Functions</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Deborah Khider, Julien Emile-Geay, Feng Zhu.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>